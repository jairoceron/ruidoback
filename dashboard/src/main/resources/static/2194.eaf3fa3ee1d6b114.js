"use strict";var Je=Object.defineProperty,Ge=Object.defineProperties,He=Object.getOwnPropertyDescriptors,xe=Object.getOwnPropertySymbols,$e=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable,Oe=(j,P,s)=>P in j?Je(j,P,{enumerable:!0,configurable:!0,writable:!0,value:s}):j[P]=s,de=(j,P)=>{for(var s in P||(P={}))$e.call(P,s)&&Oe(j,s,P[s]);if(xe)for(var s of xe(P))Qe.call(P,s)&&Oe(j,s,P[s]);return j},ve=(j,P)=>Ge(j,He(P));(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[2194,9453],{62008:(j,P,s)=>{function a(g,d){return d?"xoffset"in d&&d.xoffset?Math.max(g,Math.abs(d.xoffset)):"yoffset"in d&&d.yoffset?Math.max(g,Math.abs(d.yoffset||0)):g:g}function U(g,d){return"number"==typeof g?g:g&&g.stops&&g.stops.length?function(g){let d=0,R=0;for(let E=0;E<g.length;E++){const b=g[E].size;"number"==typeof b&&(d+=b,R++)}return d/R}(g.stops):d}function v(g){const d=g&&g.renderer,R="touch"===(g&&g.event&&g.event.pointerType)?9:6;if(!d)return R;const E="visualVariables"in d?function(g,d){if(!d)return g;const R=d.filter(T=>"size"===T.type).map(T=>{const{maxSize:F,minSize:A}=T;return(U(F,g)+U(A,g))/2});let E=0;const b=R.length;if(0===b)return g;for(let T=0;T<b;T++)E+=R[T];const I=Math.floor(E/b);return Math.max(I,g)}(R,d.visualVariables):R;if("simple"===d.type)return a(E,d.symbol);if("unique-value"===d.type){let b=E;return d.uniqueValueInfos.forEach(I=>{b=a(b,I.symbol)}),b}if("class-breaks"===d.type){let b=E;return d.classBreakInfos.forEach(I=>{b=a(b,I.symbol)}),b}return E}s.d(P,{k:()=>v})},96054:(j,P,s)=>{s.d(P,{a:()=>g});var a=s(22795),p=s(33870),U=s(38963),c=s(20547);const v=p.Z.getLogger("esri.views.2d.engine.webgl");function g(d){return(0,c.hj)(d.minDataValue)&&(0,c.hj)(d.maxDataValue)&&null!=d.minSize&&null!=d.maxSize?U.X.SIZE_MINMAX_VALUE:(d.expression&&"view.scale"===d.expression||d.valueExpression&&"$view.scale"===d.valueExpression)&&Array.isArray(d.stops)?U.X.SIZE_SCALE_STOPS:(null!=d.field||d.expression&&"view.scale"!==d.expression||d.valueExpression&&"$view.scale"!==d.valueExpression)&&(Array.isArray(d.stops)||"levels"in d&&d.levels)?U.X.SIZE_FIELD_STOPS:(null!=d.field||d.expression&&"view.scale"!==d.expression||d.valueExpression&&"$view.scale"!==d.valueExpression)&&null!=d.valueUnit?U.X.SIZE_UNIT_VALUE:(v.error(new a.Z("mapview-bad-type","Found invalid size VisualVariable",d)),U.X.NONE)}},88216:(j,P,s)=>{s.r(P),s.d(P,{default:()=>ze});var E,a=s(61921),p=s(60046),U=s(83459),c=s(9077),v=s(67474),d=(s(57025),s(33870)),R=s(42442);let b=E=class extends U.Z{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const r=this.sourceLayer&&this.sourceLayer.featureReduction;return r&&"popupTemplate"in r&&r.popupEnabled?r.popupTemplate:null}getObjectId(){return this.objectId}clone(){return new E(de({objectId:this.objectId},this.cloneProperties()))}};(0,p._)([(0,c.Cb)({type:Boolean})],b.prototype,"isAggregate",void 0),(0,p._)([(0,c.Cb)({type:Number,json:{read:!0}})],b.prototype,"objectId",void 0),b=E=(0,p._)([(0,R.j)("esri.AggregateGraphic")],b);var I=b,F=(s(73513),s(52690)),A=s(76011),O=s(22795),M=s(85071),y=s(60305),C=s(12523),V=s(97467),D=s(46701),z=s(62008),J=s(51201),k=s(57006),G=s(99155),te=s(70297),H=s(15691);function Q(){return(Q=(0,a.Z)(function*(e,r){if(!e)return null;switch(e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":return new((yield Promise.all([s.e(1092),s.e(730),s.e(4789),s.e(3304),s.e(8592),s.e(4954)]).then(s.bind(s,47075))).default)(r);case"heatmap":return new((yield Promise.all([s.e(1092),s.e(730),s.e(4789),s.e(8592),s.e(8292)]).then(s.bind(s,28292))).default)(r)}})).apply(this,arguments)}var ue=s(2967),se=s(54188),K=s(64859),W=s(50352);function w(e){return e.some(r=>r.globalId)}function $(e){return e.filter(r=>!r.error).map(r=>{var i;return null!=(i=r.objectId)?i:r.globalId})}function ne(e,r){const i=new Set(e);for(const o of r.values())i.add(o);return i}function oe(e,r){const i=new Set(e);for(const o of r.values())i.delete(o);return i}let ee=class extends K.Z{constructor(e){super(),this._hasGlobalIds=!1,this._queueProcessor=new W.e({concurrency:1,process:e.process})}destroy(){this._queueProcessor.clear()}get updating(){return this._queueProcessor.length>0}push(e){const r=this._queueProcessor,i=r.last();switch(e.type){case"update":case"refresh":if((null==i?void 0:i.type)===e.type)return;r.push(e).finally(()=>this.notifyChange("updating"));break;case"edit":{const o="processed-edit"===(null==i?void 0:i.type)?i:null;o&&r.popLast();const l=this._mergeEdits(o,e);for(const h of l)r.push(h).finally(()=>this.notifyChange("updating"));break}}this.notifyChange("updating")}_mergeEdits(e,r){var i,o;const{addedFeatures:l,deletedFeatures:h,updatedFeatures:u}=r.edits;if(this._hasGlobalIds=this._hasGlobalIds||w(l)||w(u)||w(h),this._hasGlobalIds)return[e,{type:"processed-edit",edits:{addOrModified:[...l,...u],removed:h}}];const m=new Set($(null!=(i=null==e?void 0:e.edits.addOrModified)?i:[])),f=new Set($(null!=(o=null==e?void 0:e.edits.removed)?o:[])),x=new Set([...$(l),...$(u)]),_=new Set($(h));return[{type:"processed-edit",edits:{addOrModified:Array.from(ne(oe(m,_),x)).map(S=>({objectId:S})),removed:Array.from(ne(oe(f,x),_)).map(S=>({objectId:S}))}}]}};(0,p._)([(0,c.Cb)({readOnly:!0})],ee.prototype,"updating",null),ee=(0,p._)([(0,R.j)("esri.views.2d.layers.support.FeatureCommandQueue")],ee);var he=ee,Ie=s(73763),Pe=s(5785);let le=class extends Ie.D{constructor(e){super(e),this._startupResolver=(0,C.hh)(),this.isReady=!1}initialize(){this._controller=(0,C.yi)(),this.addResolvingPromise(this._startWorker(this._controller.signal))}destroy(){this._controller.abort(),this._connection&&this._connection.close()}set tileRenderer(e){this.client.tileRenderer=e}get closed(){return this._connection.closed}startup(e,r,i,o){var l=this;return(0,a.Z)(function*(){yield l.when();const h=l._controller.signal,u=function(e){return Array.isArray(e)}(i.source)?{transferList:i.source,signal:h}:void 0,m={service:i,config:r,tileInfo:e.tileInfo.toJSON(),tiles:o};yield l._connection.invoke("startup",m,u),l._startupResolver.resolve(),l._set("isReady",!0)})()}updateTiles(e){var r=this;return(0,a.Z)(function*(){return yield r._startupResolver.promise,(0,C.R8)(r._connection.invoke("updateTiles",e))})()}update(e){var r=this;return(0,a.Z)(function*(){const i={config:e};return yield r._startupResolver.promise,r._connection.invoke("update",i)})()}applyUpdate(e){var r=this;return(0,a.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("applyUpdate",e)})()}setHighlight(e){var r=this;return(0,a.Z)(function*(){return yield r._startupResolver.promise,(0,C.R8)(r._connection.invoke("controller.setHighlight",e))})()}refresh(){var e=this;return(0,a.Z)(function*(){return yield e._startupResolver.promise,(0,C.R8)(e._connection.invoke("controller.refresh"))})()}querySummaryStatistics(e,r,i){var o=this;return(0,a.Z)(function*(){return yield o._startupResolver.promise,o._connection.invoke("controller.querySummaryStatistics",{query:e.toJSON(),params:r},i)})()}queryFeatures(e,r){var i=this;return(0,a.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.queryFeatures",e.toJSON(),r)})()}queryObjectIds(e,r){var i=this;return(0,a.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.queryObjectIds",e.toJSON(),r)})()}queryFeatureCount(e,r){var i=this;return(0,a.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.queryFeatureCount",e.toJSON(),r)})()}queryExtent(e,r){var i=this;return(0,a.Z)(function*(){return i._connection.invoke("controller.queryExtent",e.toJSON(),r)})()}queryLatestObservations(e,r){var i=this;return(0,a.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.queryLatestObservations",e.toJSON(),r)})()}queryStatistics(e){var r=this;return(0,a.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.queryStatistics",e)})()}getObjectId(e){var r=this;return(0,a.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.getObjectId",e)})()}getDisplayId(e){var r=this;return(0,a.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.getDisplayId",e)})()}getFeature(e){var r=this;return(0,a.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.getFeature",e)})()}getAggregate(e){var r=this;return(0,a.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.getAggregate",e)})()}getAggregates(){var e=this;return(0,a.Z)(function*(){return yield e._startupResolver.promise,e._connection.invoke("controller.getAggregates")})()}getAggregateValueRanges(){var e=this;return(0,a.Z)(function*(){return yield e._startupResolver.promise,e._connection.invoke("controller.getAggregateValueRanges")})()}mapValidDisplayIds(e){var r=this;return(0,a.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.mapValidDisplayIds",e)})()}onEdits(e){var r=this;return(0,a.Z)(function*(){return yield r._startupResolver.promise,(0,C.R8)(r._connection.invoke("controller.onEdits",e))})()}enableEvent(e,r){var i=this;return(0,a.Z)(function*(){return yield i._startupResolver.promise,(0,C.R8)(i._connection.invoke("controller.enableEvent",{name:e,value:r}))})()}_startWorker(e){var r=this;return(0,a.Z)(function*(){try{r._connection=yield(0,Pe.bA)("Pipeline",{client:r.client,strategy:"dedicated",signal:e})}catch(i){(0,C.H9)(i)}})()}};(0,p._)([(0,c.Cb)()],le.prototype,"isReady",void 0),(0,p._)([(0,c.Cb)()],le.prototype,"client",void 0),(0,p._)([(0,c.Cb)()],le.prototype,"tileRenderer",null),le=(0,p._)([(0,R.j)("esri.views.2d.layers.support.FeatureLayerProxy")],le);var Fe=le,ge=s(28621),Ue=s(83594),_e=s(6525);class Me{constructor(r){this._tiles=new Map,this.buffer=0,this.acquireTile=r.acquireTile,this.releaseTile=r.releaseTile,this.tileInfoView=r.tileInfoView,this.buffer=r.buffer}destroy(){}clear(){this._tiles.forEach(r=>this._releaseTile(r))}tileKeys(){const r=[];return this._tiles.forEach((i,o)=>r.push(o)),r}update(r){const i=this.tileInfoView.getTileCoverage(r.state,this.buffer,"closest"),{spans:o,lodInfo:l}=i,{level:h}=l,u=[],m=[],f=new Set,x=new Set;for(const{row:_,colFrom:S,colTo:L}of o)for(let N=S;N<=L;N++){const Y=_e.Z.getId(h,_,l.normalizeCol(N),l.getWorldForColumn(N)),X=this._getOrAcquireTile(u,Y);f.add(Y),X.isReady?X.visible=!0:x.add(X.key)}return x.forEach(_=>this._addPlaceholders(f,_)),this._tiles.forEach(_=>{f.has(_.key.id)||(m.push(_.key.id),this._releaseTile(_))}),Ue.Z.pool.release(i),{hasMissingTiles:x.size>0,added:u,removed:m}}_getOrAcquireTile(r,i){if(!this._tiles.has(i)){const o=this.acquireTile(new _e.Z(i));r.push(i),this._tiles.set(i,o),o.visible=!1}return this._tiles.get(i)}_getTile(r){return this._tiles.get(r)}_releaseTile(r){this._tiles.delete(r.key.id),this.releaseTile(r)}_addPlaceholders(r,i){const o=this._addPlaceholderChildren(r,i);Math.abs(1-o)<1e-6||this._addPlaceholderParent(r,i)||(this._getTile(i.id).visible=!0)}_addPlaceholderChildren(r,i){let o=0;return this._tiles.forEach(l=>{o+=this._addPlaceholderChild(r,l,i)}),o}_addPlaceholderChild(r,i,o){return i.key.level<=o.level||!i.hasData||!o.contains(i.key)?0:(i.visible=!0,r.add(i.key.id),1/(1<<2*(i.key.level-o.level)))}_addPlaceholderParent(r,i){let o=i.getParentKey(),l=0,h=null;for(;(0,y.pC)(o);){if(r.has(o.id))return!0;const u=this._getTile(o.id);if(null!=u&&u.isReady)return u.visible=!0,r.add(u.key.id),!0;null!=u&&u.hasData&&u.patchCount>l&&(l=u.patchCount,h=u),o=o.getParentKey()}return!!h&&(h.visible=!0,r.add(h.key.id),!0)}}var fe,De=s(99737),Z=s(76009),we=s(8982),je=s(54792),pe=s(24669);let ie=fe=class extends je.wq{constructor(){super(...arguments),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}clone(){return new fe({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,p._)([(0,c.Cb)({type:pe.Z,json:{write:!0}})],ie.prototype,"filter",void 0),(0,p._)([(0,c.Cb)({json:{write:!0}})],ie.prototype,"includedEffect",void 0),(0,p._)([(0,c.Cb)({json:{write:!0}})],ie.prototype,"excludedEffect",void 0),(0,p._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],ie.prototype,"excludedLabelsVisible",void 0),ie=fe=(0,p._)([(0,R.j)("esri.views.layers.support.FeatureEffect")],ie);var me=ie,ce=s(72501),Ee=s(19453);const Re=d.Z.getLogger("esri.views.layers.FeatureLayerView"),Le=e=>{let r=class extends e{constructor(...i){super(...i),this._updatingRequiredFieldsPromise=null,this.effect=null,this.filter=null,this.timeExtent=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){(0,V.S1)(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","effect","layer.timeInfo","layer.floorInfo","timeExtent"],()=>this._handleRequiredFieldsChange(),!0),(0,V.on)(this,"view.floors","change",()=>this._handleRequiredFieldsChange()),(0,V.on)(this,"layer.sublayer","change",()=>this._handleRequiredFieldsChange())}get availableFields(){const{layer:i,layer:{fieldsIndex:o},requiredFields:l}=this;return(0,Z.Q0)(o,"outFields"in i&&i.outFields?[...(0,Z.Lk)(o,i.outFields),...l]:l)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(i){Re.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(i){throw new Error("missing implementation")}createQuery(){const i={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},o=(0,y.pC)(this.filter)?this.filter.createQuery(i):new k.Z(i);if("feature"===this.layer.type){const l=(0,Ee.cx)(this);(0,y.pC)(l)&&(o.where=o.where?`(${o.where}) AND (${l})`:l)}return(0,y.pC)(this.timeExtent)&&(o.timeExtent=(0,y.pC)(o.timeExtent)?o.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),o}queryFeatures(i,o){throw new Error("missing implementation")}queryObjectIds(i,o){throw new Error("missing implementation")}queryFeatureCount(i,o){throw new Error("missing implementation")}queryExtent(i,o){throw new Error("missing implementation")}_loadArcadeModules(i){if(i.get("expressionInfos.length"))return(0,we.LC)()}_handleRequiredFieldsChange(){const i=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",i),i.then(()=>{this._updatingRequiredFieldsPromise===i&&this._set("_updatingRequiredFieldsPromise",null)})}_updateRequiredFields(){var i=this;return(0,a.Z)(function*(){if(!i.layer||!i.view)return;const o="3d"===i.view.type,{layer:l,layer:{fieldsIndex:h,objectIdField:u}}=i,m="renderer"in l&&l.renderer,f="orderBy"in l&&l.orderBy,x=l.featureReduction,_=new Set,S=yield(0,C.as)([m?m.collectRequiredFields(_,h):null,(0,Z.Mu)(_,l),o?(0,Z.vl)(_,l):null,(0,y.pC)(i.filter)?(0,Z.Ll)(_,l,i.filter):null,i.effect?(0,Z.Ll)(_,l,i.effect.filter):null,x?(0,Z.ZV)(_,l,x):null,f?(0,Z.Qj)(_,l,f):null]);if(l.timeInfo&&i.timeExtent&&(0,Z.gd)(_,l.fieldsIndex,[l.timeInfo.startField,l.timeInfo.endField]),"feature"===l.type&&l.floorInfo&&(0,Z.gd)(_,l.fieldsIndex,[l.floorInfo.floorField]),"subtype-group"===l.type){(0,Z.AB)(_,h,l.subtypeField);const N=l.sublayers.map(Y=>{var X;return Promise.all([null==(X=Y.renderer)?void 0:X.collectRequiredFields(_,h),(0,Z.Mu)(_,Y)])});yield(0,C.as)(N)}for(const N of S)N.error&&Re.error(N.error);(0,Z.AB)(_,h,u),o&&"displayField"in l&&l.displayField&&(0,Z.AB)(_,h,l.displayField);const L=Array.from(_).sort();i._set("requiredFields",L)})()}validateFetchPopupFeatures(i){if((0,y.Wi)(i))return null;for(const o of i.clientGraphics){const l=o.layer;if("popupEnabled"in l&&!l.popupEnabled)return new O.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:l});if("popupTemplate"in l&&!(0,ce.V)(l,i))return new O.Z("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:l})}}fetchClientPopupFeatures(i){var o=this;return(0,a.Z)(function*(){const l=(0,y.pC)(i)?i.clientGraphics:null;if(!l||0===l.length)return Promise.resolve([]);const h=[],u=[],m=yield o.createPopupQuery(i);for(const f of l){const{layer:x}=f;if(!("popupEnabled"in x))continue;const _=(0,Z.Lk)(o.layer.fieldsIndex,m.outFields),S=(0,ce.V)(x,i);if(!(0,y.pC)(S))continue;const L=yield o._loadArcadeModules(S);L&&L.arcadeUtils.hasGeometryOperations(S)||!(0,Z.R9)(_,f)?u.push(f):h.push(f)}return"stream"===o.layer.type||0===u.length?Promise.resolve(h):(m.objectIds=u.map(f=>f.attributes[o.layer.objectIdField]),o.layer.queryFeatures(m).then(f=>h.concat(f.features)).catch(()=>u))})()}createPopupQuery(i){var o=this;return(0,a.Z)(function*(){const l=o.layer.createQuery(),h=new Set;let u=!1;const m=(0,y.pC)(i)&&i.clientGraphics?i.clientGraphics.map(f=>f.layer):[o.layer];for(const f of m){if(!("popupEnabled"in f))continue;const x=(0,ce.V)(f,i);if(!(0,y.pC)(x))continue;const _=yield o._loadArcadeModules(x),S=_&&_.arcadeUtils.hasGeometryOperations(x);u=!("point"!==o.layer.geometryType&&!S);const L=yield(0,ce.e)(o.layer,x);for(const N of L)h.add(N)}if(l.returnGeometry=u,l.returnZ=u,l.returnM=u,l.outFields=Array.from(h),l.outSpatialReference=o.view.spatialReference,"feature"===o.layer.type){const f=(0,Ee.cx)(o);(0,y.pC)(f)&&(l.where=l.where?`(${l.where}) AND (${f})`:f)}return l})()}canResume(){return!(!super.canResume()||(0,y.pC)(this.timeExtent)&&this.timeExtent.isEmpty)}};return(0,p._)([(0,c.Cb)()],r.prototype,"_updatingRequiredFieldsPromise",void 0),(0,p._)([(0,c.Cb)({readOnly:!0})],r.prototype,"availableFields",null),(0,p._)([(0,c.Cb)({type:me})],r.prototype,"effect",void 0),(0,p._)([(0,c.Cb)({type:pe.Z})],r.prototype,"filter",void 0),(0,p._)([(0,c.Cb)(De.qG)],r.prototype,"timeExtent",void 0),(0,p._)([(0,c.Cb)()],r.prototype,"layer",void 0),(0,p._)([(0,c.Cb)({type:Number})],r.prototype,"maximumNumberOfFeatures",null),(0,p._)([(0,c.Cb)({readOnly:!0,type:Boolean})],r.prototype,"maximumNumberOfFeaturesExceeded",null),(0,p._)([(0,c.Cb)({readOnly:!0})],r.prototype,"requiredFields",void 0),(0,p._)([(0,c.Cb)()],r.prototype,"suspended",void 0),(0,p._)([(0,c.Cb)()],r.prototype,"view",void 0),r=(0,p._)([(0,R.j)("esri.views.layers.FeatureLayerView")],r),r};var Ae=s(59989),Ze=s(72619),Be=s(16204),Ce=s(68121),Ve=s(82059);function be(e){return e&&"openPorts"in e}const ae=d.Z.getLogger("esri.views.2d.layers.FeatureLayerView2D");let B=class extends(Le((0,Ze.y)((0,te.y)(Ae.Z)))){constructor(){var e;super(...arguments),e=this,this._pipelineIsUpdating=!0,this._commandsQueue=new he({process:r=>{switch(r.type){case"processed-edit":return this._doEdit(r);case"refresh":return this._doRefresh();case"update":return this._doUpdate()}}}),this._visibilityOverrides=new Set,this._effect=null,this._highlightIds=new Map,this._lastPixelBuffer=0,this._updateHighlight=(0,C.Ds)((0,a.Z)(function*(){return e._proxy.setHighlight(Array.from(e._highlightIds.keys()))})),this._uploadsLocked=!1,this._needsClusterSizeUpdate=!1,this.filter=null,this.effectLists={included:new D.ZP,excluded:new D.ZP}}destroy(){var e,r;(0,y.Po)(this._updateClusterSizeTask,i=>i.remove()),null==(e=this._proxy)||e.destroy(),null==(r=this.tileRenderer)||r.destroy(),this._commandsQueue.destroy()}initialize(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.handles.add([this.on("valueRangesChanged",e=>{this._set("_aggregateValueRanges",e.valueRanges)}),(0,V.S1)(this,"effect",e=>{this.effectLists.included.effect=null==e?void 0:e.includedEffect}),(0,V.S1)(this,"effect",e=>{this.effectLists.excluded.effect=null==e?void 0:e.excludedEffect})])}_initProxy(){var e=this;return(0,a.Z)(function*(){if("isTable"in e.layer&&e.layer.isTable)throw new O.Z("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:e.layer});e._proxy&&e._proxy.destroy();const r=e._createClientOptions();return e._set("_proxy",new Fe({client:r})),e._proxy.when()})()}_initServiceOptions(){var e=this;return(0,a.Z)(function*(){e._set("_serviceOptions",yield e._createServiceOptions())})()}get orderByFields(){return"stream"!==this._serviceOptions.type&&this._serviceOptions.orderByFields}get labelsVisible(){return!this.suspended&&("subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer]).some(r=>r.labelingInfo&&r.labelsVisible)}get effect(){return(0,y.Pt)(this._effect,null)}set effect(e){const r=this._effect;(0,y.pC)(r)&&(0,y.pC)(r.filter)&&r.filter.enabled&&(0,y.pC)(e)&&(0,y.pC)(e.filter)&&e.filter.enable(),this._effect=e,this.notifyChange("effect")}get effects(){return this.effect&&[this.effect]||[]}get queryMode(){return this._serviceOptions.type}get renderingConfigHash(){if(!this.layer)return null;const e=this.availableFields,r=this.layer,i=this.view.floors,{definitionExpression:o}=r,l="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,h="renderer"in r&&r.renderer,u="feature"===r.type?r.gdbVersion:void 0,m="feature"===r.type&&r.historicMoment?r.historicMoment.getTime():void 0,{timeExtent:f}=this,x="customParameters"in r?JSON.stringify(r.customParameters):void 0,_="apiKey"in r?r.apiKey:void 0,S="stream"===r.type?`${JSON.stringify(r.geometryDefinition)}${r.definitionExpression}`:null,L=JSON.stringify(this.clips),N=r.featureReduction&&r.featureReduction.toJSON(),Y="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),X="sublayers"in this.layer&&this.layer.sublayers.items.reduce((ye,q)=>ye+`${q.visible?1:0}.${JSON.stringify(q.renderer)}.${q.labelsVisible}\n.${JSON.stringify(q.labelingInfo)}`,"");return JSON.stringify({orderBy:Y,sublayerHash:X,filterHash:(0,y.pC)(this.filter)&&this.filter.toJSON(),effectHash:(0,y.pC)(this.effect)&&this.effect.toJSON(),streamFilter:S,gdbVersion:u,definitionExpression:o,historicMoment:m,availableFields:e,renderer:h,labelingInfo:l,timeExtent:f,floors:i,clipsHash:L,featureReduction:N,customParameters:x,apiKey:_})}get hasEffects(){return this.effectLists.included.hasEffects||this.effectLists.excluded.hasEffects}highlight(e){let r;return e instanceof U.Z?r=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?r=[e]:A.Z.isCollection(e)?r=e.map(i=>i&&i.getAttribute(this.layer.objectIdField)).toArray():Array.isArray(e)&&e.length>0&&(r="number"==typeof e[0]||"string"==typeof e[0]?e:e.map(i=>i&&i.getAttribute(this.layer.objectIdField))),r&&r.length?(r=r.filter(i=>null!=i),this._addHighlight(r),{remove:()=>this._removeHighlight(r)}):{remove:()=>{}}}hasHighlight(){return!!this._highlightIds.size}hitTest(e,r){return this._hitTest(e,r)}queryAggregates(){var e=this;return(0,a.Z)(function*(){return(yield e._proxy.getAggregates()).map(r=>I.fromJSON(r))})()}queryStatistics(){return this._proxy.queryStatistics()}querySummaryStatistics(e,r,i){var o=this;return(0,a.Z)(function*(){const l=de({},r);var h;return r.valueExpression&&(l.viewInfoParams={viewingMode:"map",scale:o.view.scale,spatialReference:null==(h=o.view.spatialReference)?void 0:h.toJSON()}),o._proxy.querySummaryStatistics(o._cleanUpQuery(e),l,i)})()}queryFeatures(e,r){return this.queryFeaturesJSON(e,r).then(i=>{const o=J.default.fromJSON(i);return o.features.forEach(l=>this._setLayersForFeature(l)),o})}queryFeaturesJSON(e,r){return this._proxy.queryFeatures(this._cleanUpQuery(e),r)}queryObjectIds(e,r){return this._proxy.queryObjectIds(this._cleanUpQuery(e),r)}queryFeatureCount(e,r){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),r)}queryExtent(e,r){return this._proxy.queryExtent(this._cleanUpQuery(e),r).then(i=>({count:i.count,extent:Ve.Z.fromJSON(i.extent)}))}setVisibility(e,r){r?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}update(e){if(!this._tileStrategy||!this.tileRenderer)return;const{hasMissingTiles:r,added:i,removed:o}=this._tileStrategy.update(e);(i.length||o.length)&&this._proxy.updateTiles({added:i,removed:o}),r&&this.requestUpdate(),this.notifyChange("updating")}attach(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this._tileStrategy=new Me({acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add((0,V.S1)(this,"renderingConfigHash",()=>this._update()),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",e=>this._edit(e)),"attach")}detach(){this.container.removeAllChildren(),this.handles.remove("attach"),this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}fetchPopupFeatures(e,r){var i=this;return(0,a.Z)(function*(){if((0,y.pC)(r)&&r.clientGraphics.length){const u=r.clientGraphics[0];if(u instanceof I)return[u];r.clientGraphics=r.clientGraphics.filter(m=>{const{layer:f}=m;return"popupEnabled"in f&&f.popupEnabled&&("popupTemplate"in f&&f.popupTemplate||i.view.popup.defaultPopupTemplateEnabled)})}const o=i.validateFetchPopupFeatures(r);if(o)throw o;if((0,y.pC)(r)&&0===r.clientGraphics.length)return[];const l=i.fetchClientPopupFeatures(r);if(!e)return l;const h=i._fetchServicePopupFeatures(e,r);return(0,C.WW)([l,h]).then(F.xH)})()}_fetchServicePopupFeatures(e,r){var i=this;return(0,a.Z)(function*(){if("stream"===i.layer.type||"ogc-feature"===i.layer.type)return[];const o=yield i.createPopupQuery(r),{layer:l}=i,h="renderer"in l&&l.renderer,u=(0,y.pC)(r)?r.event:null,m=(0,z.k)({renderer:h,event:u});o.geometry=i.createFetchPopupFeaturesQueryGeometry(e,m);const f=new Set,{objectIdField:x}=l,_=(0,y.pC)(r)?r.clientGraphics:null;if(_)for(const S of _)f.add(S.attributes[x]);return l.queryFeatures(o).then(S=>S.features.filter(L=>!f.has(L.attributes[x])))})()}createFetchPopupFeaturesQueryGeometry(e,r){return(0,Be.K)(e,r,this.view)}isUpdating(){var e;const r="renderer"in this.layer&&null!=this.layer.renderer,i=this._commandsQueue.updating,o=null!=this._updatingRequiredFieldsPromise,l=!this._proxy||!this._proxy.isReady,h=this._pipelineIsUpdating,u=null===this.tileRenderer||(null==(e=this.tileRenderer)?void 0:e.updating),m=r&&(i||o||l||h||u);return(0,v.Z)("esri-2d-log-updating")&&console.log(`Updating FLV2D: ${m}\n  -> hasRenderer ${r}\n  -> hasPendingCommand ${i}\n  -> updatingRequiredFields ${o}\n  -> updatingProxy ${l}\n  -> updatingPipeline ${h}\n  -> updatingTileRenderer ${u}\n`),m}_createClientOptions(){return{setUpdating:e=>{this._set("_pipelineIsUpdating",e)},emitEvent:e=>{this.emit(e.name,e.event)}}}_detectQueryMode(e){var r=this;return(0,a.Z)(function*(){if("path"in e&&("feature"===r.layer.type||"subtype-group"===r.layer.type)&&"point"===r.layer.geometryType&&r.layer.capabilities.query.supportsPagination&&!r.layer.capabilities.operations.supportsEditing&&(0,v.Z)("featurelayer-snapshot-enabled"))try{const i=yield r.layer.queryFeatureCount();if(i<=(0,v.Z)("featurelayer-snapshot-point-min-threshold"))return{mode:"snapshot",featureCount:i};const o=(0,v.Z)("featurelayer-snapshot-point-max-threshold"),l=(0,v.Z)("featurelayer-snapshot-point-coverage"),h=r.view.extent,u=r.layer.fullExtent,m=null==u?void 0:u.clone().intersection(h),f=(0,y.pC)(m)?m.width*m.height:0,x=(null==u?void 0:u.width)*(null==u?void 0:u.height),_=0===x?0:f/x;if(i<=o&&_>=l)return{mode:"snapshot",featureCount:i}}catch(i){ae.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:i})}return{mode:"on-demand"}})()}_createServiceOptions(){var e=this;return(0,a.Z)(function*(){var r;const i=e.layer;if("stream"===i.type)return null;const{capabilities:o,objectIdField:l}=i,h=i.fields.map(q=>q.toJSON()),u=i.fullExtent&&i.fullExtent.toJSON(),m=(0,ge.o)(i.geometryType),f=i.timeInfo&&i.timeInfo.toJSON()||null,x=i.spatialReference?i.spatialReference.toJSON():null,_="feature"===i.type?i.globalIdField:null;let S;"ogc-feature"===i.type?S=i.source.getFeatureDefinition():be(i.source)?S=yield i.source.openPorts():i.parsedUrl&&(S=(0,M.d9)(i.parsedUrl),"dynamicDataSource"in i&&i.dynamicDataSource&&(S.query={layer:JSON.stringify({source:i.dynamicDataSource})}));const L="datesInUnknownTimezone"in e.layer&&e.layer.datesInUnknownTimezone,N=null!=(r="subtypeField"in e.layer&&e.layer.subtypeField)?r:null,{mode:Y,featureCount:X}=yield e._detectQueryMode(S);let ye=e.layer.objectIdField;if("feature"===e.layer.type&&(0,y.pC)(e.layer.orderBy)&&e.layer.orderBy.length){const q=!e.layer.orderBy[0].valueExpression&&e.layer.orderBy[0].field;q&&(ye=q)}return{type:Y,timeReferenceUnknownClient:L,subtypeField:N,featureCount:X,globalIdField:_,maxRecordCount:o.query.maxRecordCount,tileMaxRecordCount:o.query.tileMaxRecordCount,capabilities:o,fields:h,fullExtent:u,geometryType:m,objectIdField:l,source:S,timeInfo:f,spatialReference:x,orderByFields:ye}})()}_createMemoryServiceOptions(e){var r=this;return(0,a.Z)(function*(){const i=yield e.openPorts();return ve(de({},r._createServiceOptions()),{type:"memory",source:i})})()}_cleanUpQuery(e){const r=k.Z.from(e)||this.createQuery();return r.outSpatialReference||(r.outSpatialReference=this.view.spatialReference),r}_update(){var e=this;return(0,a.Z)(function*(){return e._commandsQueue.push({type:"update"})})()}_edit(e){var r=this;return(0,a.Z)(function*(){if(r._validateEdit(e))return r._commandsQueue.push({type:"edit",edits:e})})()}doRefresh(){var e=this;return(0,a.Z)(function*(){return e._commandsQueue.push({type:"refresh"})})()}_validateEdit(e){const r="globalIdField"in this.layer&&this.layer.globalIdField,i=e.deletedFeatures.some(l=>-1===l.objectId||!l.objectId),o=r&&this.availableFields.includes(r);return i&&!o?(ae.error(new O.Z("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${r} to be included the layer's outFields for updates to be reflected on the map`)),null):e}_doUpdate(){var e=this;return(0,a.Z)(function*(){try{if(e.destroyed||!e._hasRequiredSupport(e.layer)||!e._tileStrategy)return;const{effect:r,filter:i}=e;yield e._updateRequiredFields();const{renderer:o}=e._getEffectiveRenderer();e._set("_effectiveRenderer",o);const l=e._createSchemaConfig(),h=(0,ge.o)(e.layer.geometryType),u=yield(0,ue.G)(o,h,e.layer.featureReduction),m=e._createConfiguration(l,i,r);e._lastPixelBuffer=0===u?0:Math.max(u,e._lastPixelBuffer),m.schema.source.pixelBuffer=e._lastPixelBuffer;const f=e._createTileRendererHash(o);if(f!==e._tileRendererHash){yield e._initTileRenderer(o);const x=e._serviceOptions;e.effects.forEach(L=>(0,y.pC)(L)&&(0,y.pC)(L.filter)&&L.filter.enable()),e.tileRenderer.onConfigUpdate(o);const _={added:e._tileStrategy.tileKeys(),removed:[]},S=e.layer;"stream"!==S.type&&be(S.source)&&(x.source=yield S.source.openPorts()),"stream"===S.type&&(yield e._initServiceOptions()),yield e._proxy.startup(e.view.featuresTilingScheme,m,x,_),e.hasHighlight()&&(yield e._proxy.setHighlight(Array.from(e._highlightIds.keys()))),yield e._onceTilesUpdated(),e.tileRenderer.onConfigUpdate(o)}else{const x=yield e._proxy.update(m);(x.mesh||x.targets.aggregate)&&e._lockGPUUploads();try{yield e._proxy.applyUpdate(x)}catch(_){(0,C.D_)(_)||ae.error(_)}(x.mesh||x.targets.aggregate)&&e._unlockGPUUploads(),e.effects.forEach(_=>(0,y.pC)(_)&&(0,y.pC)(_.filter)&&_.filter.enable()),e.tileRenderer.onConfigUpdate(o),e._updateClusterSizeVariable(),e._forceAttributeTextureUpload()}e._tileRendererHash=f,e.tileRenderer.invalidateLabels(),e.requestUpdate()}catch(r){}})()}_doEdit(e){var r=this;return(0,a.Z)(function*(){try{yield r._proxy.onEdits(e)}catch(i){(0,C.D_)(i)}})()}_doRefresh(){var e=this;return(0,a.Z)(function*(){e._lockGPUUploads();try{yield e._proxy.refresh()}catch(r){(0,C.D_)(r)}e._unlockGPUUploads()})()}_updateClusterSizeVariable(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)}_createUpdateClusterSizeTask(e,r){var i=this;return this.watch("_aggregateValueRanges",function(){var o=(0,a.Z)(function*(l){i._updateClusterEffectiveRendererSizeVariable(e,r,l),i._needsClusterSizeUpdate=!0,i._uploadsLocked||i._updateClusterSizeVariable()});return function(l){return o.apply(this,arguments)}}())}_updateClusterEffectiveRendererSizeVariable(e,r,i){var o=this;return(0,a.Z)(function*(){if(e.dynamicClusterSize&&"visualVariables"in e&&e.visualVariables){const l=(0,se.os)(e.visualVariables);if((0,y.pC)(l)&&"cluster_count"===l.field){const h=e.visualVariables.indexOf(l);e.visualVariables[h]=(0,se.aV)(r,i);const u=e.clone();u.dynamicClusterSize=!0,o._set("_effectiveRenderer",u)}}})()}_getEffectiveRenderer(){const e="renderer"in this.layer&&this.layer.renderer,r=this.layer.featureReduction;if((0,y.pC)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),r&&"cluster"===r.type&&(0,se.yR)(e)){const i=r,o=[],l=(0,se.S1)(o,e,i,this._aggregateValueRanges);return(0,y.Po)(this._updateClusterSizeTask,h=>h.remove()),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(l,i),{renderer:l,aggregateFields:o,featureReduction:r}}return{renderer:e,aggregateFields:[],featureReduction:null}}_acquireTile(e){const r=this.tileRenderer.acquireTile(e);return r.once("attach",()=>{this.requestUpdate()}),r}_releaseTile(e){this.tileRenderer.releaseTile(e)}_initTileRenderer(e){var r=this;return(0,a.Z)(function*(){const i=yield function(e,r){return Q.apply(this,arguments)}(e,{layerView:r,tileInfoView:r.view.featuresTilingScheme,layer:r.layer});return r.tileRenderer&&(r._tileStrategy.clear(),r.tileRenderer.uninstall(r.container),r.tileRenderer.destroy(),r.tileRenderer=null),r.destroyed?null:(r._proxy.tileRenderer=i,r._set("tileRenderer",i),r.tileRenderer.install(r.container),r.tileRenderer.onConfigUpdate(e),r.requestUpdate(),r.tileRenderer)})()}_createTileRendererHash(e){return`${"heatmap"===e.type?"heatmap":"symbol"}.${"dot-density"===e.type}`}_createFeatureDataHash(e,r,i){const o=e.getAttributeHash(),l=JSON.stringify(r),h=(0,y.pC)(i)&&JSON.stringify(i.filter),u=JSON.stringify(this.timeExtent);let m="";return this._visibilityOverrides.forEach(f=>m+=f),`${o}.${l}.${h}.${u}.${m}`}get hasFilter(){return!!(this.filter||"floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length||this._visibilityOverrides.size||this.timeExtent)}_injectOverrides(e){const r=(0,y.pC)(e)?e.timeExtent:null,i=(0,y.pC)(this.timeExtent)&&(0,y.pC)(r)?this.timeExtent.intersection(r):this.timeExtent||r;let o=null;const l="floorInfo"in this.layer&&this.layer.floorInfo;if(l){const u=(0,y.pC)(e)&&e.where;o=this._addFloorFilterClause(u)}if(!this._visibilityOverrides.size&&!i&&!l)return e;const h=(0,y.pC)(e)&&e.clone()||new pe.Z;return h.hiddenIds=this._visibilityOverrides,h.timeExtent=i,o&&(h.where=o),h}_addFloorFilterClause(e){const r=this.layer;let i=e||"";if("floorInfo"in r&&r.floorInfo){var o;let l=this.view.floors;if(!l||!l.length)return i;null!=(o=r.floorInfo.viewAllLevelIds)&&o.length&&(l=r.floorInfo.viewAllLevelIds);const h=l.filter(f=>""!==f).map(f=>"'"+f+"'");h.push("''");const u=r.floorInfo.floorField;let m="("+u+" IN ({ids}) OR "+u+" IS NULL)";if(m=m.replace("{ids}",h.join(", ")),(0,y.pC)(i)&&i.includes(u)){let f=new RegExp("AND \\("+u+".*NULL\\)","g");i=i.replace(f,""),f=new RegExp("\\("+u+".*NULL\\)","g"),i=i.replace(f,""),i=i.replace(/\s+/g," ").trim()}i=""!==i?"("+i+") AND "+m:m}return""!==i?i:null}_createConfiguration(e,r,i){const o="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,l="feature"===this.layer.type?this.layer.gdbVersion:void 0,h=new Array(G.m4),u=this._injectOverrides(r);h[0]=(0,y.pC)(u)?u.toJSON():null,h[1]=(0,y.pC)(i)&&i.filter?i.filter.toJSON():null;const m=(0,H.Ew)(e);if((0,y.Wi)(m))return null;const f=(0,Ce.Z)();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:l,historicMoment:o,devicePixelRatio:window.devicePixelRatio||1,filters:h,schema:m,supportsTextureFloat:f.supportsTextureFloat,maxTextureSize:f.maxTextureSize}}_hasRequiredSupport(e){var r;return!("renderer"in e&&"dot-density"===(null==(r=e.renderer)?void 0:r.type)&&!(0,Ce.Z)().supportsTextureFloat&&(ae.error(new O.Z("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))}_onceTilesUpdated(){return this.requestUpdate(),(0,V.OY)(this,"_pipelineIsUpdating",!1)}_lockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())}_unlockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())}_forceAttributeTextureUpload(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}_createSchemaConfig(){return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:"feature"===this.layer.type?this.layer.historicMoment:null,labelsVisible:"labelsVisible"in this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,effect:this.effect,filter:this.filter,gdbVersion:"feature"===this.layer.type?this.layer.gdbVersion:null,pixelBuffer:0,orderBy:"orderBy"in this.layer&&this.layer.orderBy?this.layer.orderBy:null,customParameters:ve(de({},"customParameters"in this.layer?this.layer.customParameters:void 0),{token:"apiKey"in this.layer?this.layer.apiKey:void 0})}}_addHighlight(e){for(const r of e)if(this._highlightIds.has(r)){const i=this._highlightIds.get(r);this._highlightIds.set(r,i+1)}else this._highlightIds.set(r,1);this._updateHighlight().catch(r=>{(0,C.D_)(r)||ae.error(r)})}_removeHighlight(e){for(const r of e)if(this._highlightIds.has(r)){const i=this._highlightIds.get(r)-1;0===i?this._highlightIds.delete(r):this._highlightIds.set(r,i)}this._updateHighlight().catch(r=>{(0,C.D_)(r)||ae.error(r)})}_setLayersForFeature(e){const r=this.layer;e.layer=r,e.sourceLayer=r}_createHittestResult(e){return this._setLayersForFeature(e),(0,y.pC)(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}_hitTest(e,r){var i=this;return(0,a.Z)(function*(){if(i.suspended||!i.tileRenderer)return null;const o=yield i.tileRenderer.hitTest(e,r);if(0===o.length)return yield(0,C.e4)(1),null;const l=o[0];if(!(e=>(2147483648&e)>>>31==1)(l)){const u=yield i._proxy.getFeature(l);return(0,y.Po)(u,m=>i._createHittestResult(U.Z.fromJSON(m)))}const h=yield i._proxy.getAggregate(l);if((0,y.Wi)(h))return null;if((0,y.pC)(h.referenceId)){const u=yield i._proxy.getFeature(h.referenceId);return(0,y.Po)(u,m=>i._createHittestResult(U.Z.fromJSON(m)))}return i._createHittestResult(I.fromJSON(h))})()}};(0,p._)([(0,c.Cb)()],B.prototype,"_serviceOptions",void 0),(0,p._)([(0,c.Cb)()],B.prototype,"_proxy",void 0),(0,p._)([(0,c.Cb)()],B.prototype,"_pipelineIsUpdating",void 0),(0,p._)([(0,c.Cb)()],B.prototype,"_effectiveRenderer",void 0),(0,p._)([(0,c.Cb)()],B.prototype,"_aggregateValueRanges",void 0),(0,p._)([(0,c.Cb)()],B.prototype,"_commandsQueue",void 0),(0,p._)([(0,c.Cb)()],B.prototype,"labelsVisible",null),(0,p._)([(0,c.Cb)({type:pe.Z})],B.prototype,"filter",void 0),(0,p._)([(0,c.Cb)({type:me})],B.prototype,"effect",null),(0,p._)([(0,c.Cb)({readOnly:!0})],B.prototype,"effects",null),(0,p._)([(0,c.Cb)({readOnly:!0})],B.prototype,"queryMode",null),(0,p._)([(0,c.Cb)()],B.prototype,"renderingConfigHash",null),(0,p._)([(0,c.Cb)()],B.prototype,"tileRenderer",void 0),(0,p._)([(0,c.Cb)()],B.prototype,"updating",void 0),B=(0,p._)([(0,R.j)("esri.views.2d.layers.FeatureLayerView2D")],B);var ze=B},70297:(j,P,s)=>{s.d(P,{y:()=>ue});var a=s(60046),p=s(76011),U=s(55208),c=s(97467),v=s(9077),E=(s(67474),s(57025),s(33870),s(42442)),b=s(29729),I=s(54792);let T=class extends I.wq{};T=(0,a._)([(0,E.j)("esri.views.layers.support.ClipArea")],T);var A,F=T;let O=A=class extends F{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new A({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};(0,a._)([(0,v.Cb)({type:[Number,String],json:{write:!0}})],O.prototype,"left",void 0),(0,a._)([(0,v.Cb)({type:[Number,String],json:{write:!0}})],O.prototype,"right",void 0),(0,a._)([(0,v.Cb)({type:[Number,String],json:{write:!0}})],O.prototype,"top",void 0),(0,a._)([(0,v.Cb)({type:[Number,String],json:{write:!0}})],O.prototype,"bottom",void 0),(0,a._)([(0,v.Cb)({readOnly:!0})],O.prototype,"version",null),O=A=(0,a._)([(0,E.j)("esri.views.layers.support.ClipRect")],O);var J,M=O,C=(s(73513),s(40485)),V=s(52917),D=s(82059),z=s(70393);const k={base:C.Z,key:"type",typeMap:{extent:D.Z,polygon:z.Z}};let G=J=class extends F{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new J({geometry:this.geometry.clone()})}};(0,a._)([(0,v.Cb)({types:k,json:{read:V.im,write:!0}})],G.prototype,"geometry",void 0),(0,a._)([(0,v.Cb)({readOnly:!0})],G.prototype,"version",null),G=J=(0,a._)([(0,E.j)("esri.views.layers.support.Geometry")],G);var te=G;let H=class extends F{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};(0,a._)([(0,v.Cb)({type:[[[Number]]],json:{write:!0}})],H.prototype,"path",void 0),(0,a._)([(0,v.Cb)({readOnly:!0})],H.prototype,"version",null),H=(0,a._)([(0,E.j)("esri.views.layers.support.Path")],H);const Q=p.Z.ofType({key:"type",base:F,typeMap:{rect:M,path:H,geometry:te}}),ue=se=>{let K=class extends se{constructor(){super(...arguments),this.clips=new Q,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var W;this.container||(this.container=new b.W),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([(0,c.S1)(this,"suspended",w=>{this.container&&(this.container.visible=!w),this.view&&!w&&this.updateRequested&&this.view.requestUpdate()},!0),(0,c.S1)(this,["layer.opacity","container"],()=>{var w,$;this.container&&(this.container.opacity=null!=(w=null==($=this.layer)?void 0:$.opacity)?w:1)},!0),(0,c.S1)(this,["layer.blendMode"],w=>{this.container&&(this.container.blendMode=w)},!0),(0,c.S1)(this,["layer.effect"],w=>{this.container&&(this.container.effect=w)},!0),this.clips.on("change",()=>{this.container.clips=this.clips,this.notifyChange("clips")})]),null!=(W=this.view)&&W.whenLayerView?this.view.whenLayerView(this.layer).then(w=>{w!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(W){let w=!0;const $=this.layer,ne=$.minScale,oe=$.maxScale;if(null!=ne&&null!=oe){let ee=!ne,he=!oe;!ee&&W<=ne&&(ee=!0),!he&&W>=oe&&(he=!0),w=ee&&he}return w}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(W){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",W),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(W))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return(0,a._)([(0,v.Cb)({type:Q,set(W){const w=(0,U.Z)(W,this._get("clips"),Q);this._set("clips",w)}})],K.prototype,"clips",void 0),(0,a._)([(0,v.Cb)()],K.prototype,"moving",void 0),(0,a._)([(0,v.Cb)()],K.prototype,"attached",void 0),(0,a._)([(0,v.Cb)()],K.prototype,"container",void 0),(0,a._)([(0,v.Cb)()],K.prototype,"suspended",void 0),(0,a._)([(0,v.Cb)({readOnly:!0})],K.prototype,"updateParameters",void 0),(0,a._)([(0,v.Cb)()],K.prototype,"updateRequested",void 0),(0,a._)([(0,v.Cb)()],K.prototype,"updating",null),(0,a._)([(0,v.Cb)()],K.prototype,"view",void 0),K=(0,a._)([(0,E.j)("esri.views.2d.layers.LayerView2D")],K),K}},59989:(j,P,s)=>{s.d(P,{Z:()=>A});var a=s(60046),p=s(64859),U=s(77624),c=s(10882),v=s(21511),g=s(33870),d=s(60305),R=s(73763),E=s(9077),T=(s(67474),s(57025),s(42442));let F=class extends((0,c.p)((0,v.I)((0,R.v)(U.Z.EventedMixin(p.Z))))){constructor(O){super(O),this.layer=null,this.parent=null}initialize(){this.when().catch(O=>{if("layerview:create-error"!==O.name){const M=this.layer&&this.layer.id||"no id",y=this.layer&&this.layer.title||"no title";throw g.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${y}', id: '${M}')`,O),O}})}get fullOpacity(){return(0,d.Pt)(this.get("layer.opacity"),1)*(0,d.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.get("layer.visible")}set visible(O){void 0!==O?this._override("visible",O):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const O=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(O.viewNotReady=!0),this.layer&&this.layer.loaded||(O.layerNotLoaded=!0),this.visible||(O.layerInvisible=!0),O}isUpdating(){return!1}};(0,a._)([(0,E.Cb)()],F.prototype,"fullOpacity",null),(0,a._)([(0,E.Cb)()],F.prototype,"layer",void 0),(0,a._)([(0,E.Cb)()],F.prototype,"parent",void 0),(0,a._)([(0,E.Cb)({readOnly:!0})],F.prototype,"suspended",null),(0,a._)([(0,E.Cb)({readOnly:!0})],F.prototype,"suspendInfo",null),(0,a._)([(0,E.Cb)({readOnly:!0})],F.prototype,"legendEnabled",null),(0,a._)([(0,E.Cb)({type:Boolean,readOnly:!0})],F.prototype,"updating",null),(0,a._)([(0,E.Cb)({readOnly:!0})],F.prototype,"updatingProgress",null),(0,a._)([(0,E.Cb)()],F.prototype,"visible",null),F=(0,a._)([(0,T.j)("esri.views.layers.LayerView")],F);var A=F},72619:(j,P,s)=>{s.d(P,{y:()=>E});var a=s(60046),p=s(33870),U=s(12523),c=s(97467),v=s(9077),R=(s(67474),s(57025),s(42442));const E=b=>{let I=class extends b{initialize(){this.handles.add((0,c.on)(this,"layer","refresh",()=>{this.doRefresh().catch(T=>{(0,U.D_)(T)||p.Z.getLogger(this.declaredClass).error(T)})}),"RefreshableLayerView")}};return(0,a._)([(0,v.Cb)()],I.prototype,"layer",void 0),I=(0,a._)([(0,R.j)("esri.layers.mixins.RefreshableLayerView")],I),I}},24669:(j,P,s)=>{s.d(P,{Z:()=>V});var O,a=s(60046),p=s(73513),U=s(78053),c=s(9836),v=s(54792),g=s(85071),d=s(9077),I=(s(57025),s(67474),s(33870),s(42442)),T=s(43190),F=s(52917),A=s(57006);const M=new c.Xn({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),y=new c.Xn({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let C=O=class extends v.wq{constructor(D){super(D),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.hiddenIds=new Set,this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null,this.enabled=!1}writeWhere(D,z){z.where=D||"1=1"}enable(){this._set("enabled",!0)}createQuery(D={}){const{where:z,geometry:J,spatialRelationship:k,timeExtent:G,objectIds:te,units:H,distance:re}=this;return new A.Z(de({geometry:(0,g.d9)(J),objectIds:(0,g.d9)(te),spatialRelationship:k,timeExtent:(0,g.d9)(G),where:z,units:H,distance:re},D))}clone(){const{where:D,geometry:z,spatialRelationship:J,hiddenIds:k,timeExtent:G,objectIds:te,units:H,distance:re}=this,Q=new Set;return k.forEach(ue=>Q.add(ue)),new O({geometry:(0,g.d9)(z),hiddenIds:Q,objectIds:(0,g.d9)(te),spatialRelationship:J,timeExtent:(0,g.d9)(G),where:D,units:H,distance:re})}};(0,a._)([(0,d.Cb)({type:String})],C.prototype,"where",void 0),(0,a._)([(0,T.c)("where")],C.prototype,"writeWhere",null),(0,a._)([(0,d.Cb)({types:p.qM,json:{read:F.im,write:!0}})],C.prototype,"geometry",void 0),(0,a._)([(0,d.Cb)({type:String,json:{read:{source:"spatialRel",reader:M.read},write:{target:"spatialRel",writer:M.write}}})],C.prototype,"spatialRelationship",void 0),(0,a._)([(0,d.Cb)({json:{write:(D,z,J)=>z[J]=Array.from(D),read:D=>new Set(D)}})],C.prototype,"hiddenIds",void 0),(0,a._)([(0,d.Cb)({type:Number,json:{write:{overridePolicy:D=>({enabled:D>0})}}})],C.prototype,"distance",void 0),(0,a._)([(0,d.Cb)({type:[Number],json:{write:!0}})],C.prototype,"objectIds",void 0),(0,a._)([(0,d.Cb)({type:String,json:{read:y.read,write:{writer:y.write,overridePolicy(D){return{enabled:D&&this.distance>0}}}}})],C.prototype,"units",void 0),(0,a._)([(0,d.Cb)({type:U.Z,json:{write:!0}})],C.prototype,"timeExtent",void 0),(0,a._)([(0,d.Cb)({readOnly:!0})],C.prototype,"enabled",void 0),C=O=(0,a._)([(0,I.j)("esri.views.layers.support.FeatureFilter")],C);var V=C},72501:(j,P,s)=>{s.d(P,{V:()=>g,e:()=>c});var a=s(61921),p=s(60305),U=s(76009);function c(d){return v.apply(this,arguments)}function v(){return(v=(0,a.Z)(function*(d,R=d.popupTemplate){if(!(0,p.pC)(R))return[];const E=yield R.getRequiredFields(d.fieldsIndex),{lastEditInfoEnabled:b}=R,{objectIdField:I,typeIdField:T,globalIdField:F,relationships:A}=d;if(E.includes("*"))return["*"];const O=b?yield(0,U.CH)(d):[],M=(0,U.Q0)(d.fieldsIndex,[...E,...O]);return T&&M.push(T),M&&I&&d.fieldsIndex.has(I)&&-1===M.indexOf(I)&&M.push(I),M&&F&&d.fieldsIndex.has(F)&&-1===M.indexOf(F)&&M.push(F),A&&A.forEach(y=>{const{keyField:C}=y;M&&C&&d.fieldsIndex.has(C)&&-1===M.indexOf(C)&&M.push(C)}),M})).apply(this,arguments)}function g(d,R){return d.popupTemplate?d.popupTemplate:(0,p.pC)(R)&&R.defaultPopupTemplateEnabled&&(0,p.pC)(d.defaultPopupTemplate)?d.defaultPopupTemplate:null}},16204:(j,P,s)=>{s.d(P,{K:()=>v}),s(73513);var p=s(60305),U=s(4820),c=s(82059);function v(R,E,b,I=new c.Z){let T;if("2d"===b.type)T=E*b.resolution;else if("3d"===b.type){const C=b.overlayPixelSizeInMapUnits(R),V=b.basemapSpatialReference;T=(0,p.pC)(V)&&!V.equals(b.spatialReference)?(0,U.c9)(V)/(0,U.c9)(b.spatialReference):E*C}const F=R.x-T,A=R.y-T,O=R.x+T,M=R.y+T,{spatialReference:y}=b;return I.xmin=Math.min(F,O),I.ymin=Math.min(A,M),I.xmax=Math.max(F,O),I.ymax=Math.max(A,M),I.spatialReference=y,I}new c.Z},19453:(j,P,s)=>{function a(v){var g;const d=v.layer;return"floorInfo"in d&&null!=(g=d.floorInfo)&&g.floorField&&"floors"in v.view?c(v.view.floors,d.floorInfo.floorField):null}function p(v,g){var d;return"floorInfo"in g&&null!=(d=g.floorInfo)&&d.floorField?c(v,g.floorInfo.floorField):null}function U(v,g){const{definitionExpression:d}=g;return v?d?`(${d}) AND (${v})`:v:d}function c(v,g){if(null==v||!v.length)return null;const d=v.filter(R=>""!==R).map(R=>`'${R}'`);return d.push("''"),`${g} IN (${d.join(",")}) OR ${g} IS NULL`}s.d(P,{Hp:()=>U,cx:()=>a,ff:()=>p})}}]);