"use strict";var Pe=Math.pow;(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[89],{95848:(ve,ae,g)=>{g.d(ae,{vF:()=>p,_D:()=>se,Qp:()=>ye,P_:()=>me,Hq:()=>de,zD:()=>re,tB:()=>pe,nF:()=>$,VO:()=>J,kZ:()=>ge,kr:()=>l});var q=g(61921),L=(g(73513),g(22795)),C=g(60305),N=g(4820),W=g(62733),T=g(87337),F=g(82059),A=g(27640);const H=5e-4,G=function(e,t){const s=(e.isWGS84||e.isWebMercator)&&(t.isWGS84||t.isWebMercator);return!(e.equals(t)||s)},K={3395:20037508.342789244,3410:17334193.943686873,3832:3339584.723798206,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,8858:7396237.374497803,8859:2465412.4581659334,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53025:7276828.3848298555,53031:10384677.558821043,53034:20015086.79602057,53036:7389443.187332862,53037:2463147.729110953,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54025:7311399.09166516,54031:10396310.810074743,54034:20037508.342789244,54050:808820.9223376509,54053:1920897.3915568967,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244,102038:4297258.582585486,102299:5013965.117483125};function re(){return Z.apply(this,arguments)}function Z(){return(Z=(0,q.Z)(function*(){if((0,W.kR)()||!(0,W.Gb)())return null;yield(0,W.zD)()})).apply(this,arguments)}function se(e,t,s){if(!G(e.spatialReference,t))return null;if(!(0,W.kR)())throw new L.Z("rasterprojectionhelper-projectResolution","projection engine is not loaded");return s?(0,W.rS)(t,e.spatialReference,e):(0,W.rS)(e.spatialReference,t,e)}function J(e,t,s,n=null){if(e.spatialReference.equals(t))return e;const d=G(e.spatialReference,t);if(d&&!(0,W.kR)())throw new L.Z("rasterprojectionhelper-projectResolution","projection engine is not loaded");const h=s.center,f=new F.Z({xmin:h.x-e.x/2,xmax:h.x+e.x/2,ymin:h.y-e.y/2,ymax:h.y+e.y/2,spatialReference:e.spatialReference}),a=d?(0,W.iV)(f,t,n):(0,T.iV)(f,t);return(0,C.Wi)(a)?null:{x:a.xmax-a.xmin,y:a.ymax-a.ymin}}function O(e,t=.01){return(0,N.c9)(e)?t/(0,N.c9)(e):0}function $(e,t,s=null,n=!0){const d=e.spatialReference;if(d.equals(t))return e;let h=(0,T.iV)(e,t);if((0,C.Wi)(h)){if(!(0,W.kR)())throw new L.Z("rasterprojectionhelper-projectResolution","projection engine is not loaded");h=(0,W.iV)(e,t,s)}if(n&&t.isGeographic){const[f,a]=k(d,!0),u=O(d);u&&null!=f&&null!=a&&(Math.abs(e.x-f)<u&&Math.abs(180-h.x)<H?h.x-=360:Math.abs(e.x-a)<u&&Math.abs(180+h.x)<H&&(h.x+=360))}return h}function he(e){const t=te(e[0].spatialReference);if(e.length<2||!(0,C.pC)(t))return e[0];let{xmin:s,xmax:n,ymin:d,ymax:h}=e[0];for(let f=1;f<e.length;f++){const a=e[f];n=a.xmax+t*f,d=Math.min(d,a.ymin),h=Math.max(h,a.ymax)}return new F.Z({xmin:s,xmax:n,ymin:d,ymax:h,spatialReference:e[0].spatialReference})}function pe(e,t,s=null,n=!0){if(e.spatialReference.equals(t))return e;const d=de(e),h=te(e.spatialReference,!0);return(0,C.pC)(h)&&0!==d?he(e.clone().normalize().map(f=>X(f,t,s,n))):X(e,t,s,n)}function X(e,t,s=null,n=!0){const d=e.spatialReference;if(d.equals(t))return e;if(G(d,t)&&!(0,W.kR)())throw new L.Z("rasterprojectionhelper-projectExtent","projection engine is not loaded");let h=(0,T.iV)(e,t);(0,C.Wi)(h)&&(h=(0,W.iV)(e,t,s));let[f,a]=k(d,!0);if(h&&n&&d.isWebMercator&&t.isGeographic&&null!=f&&null!=a){const m=.001,x=1e3;if(Math.abs(e.xmin-f)<m&&Math.abs(a-e.xmax)>x&&Math.abs(180-h.xmax)<H){h.xmin=-180;const i=[];i.push(new A.Z(e.xmax,e.ymin,d)),i.push(new A.Z(e.xmax,(e.ymin+e.ymax)/2,d)),i.push(new A.Z(e.xmax,e.ymax,d));const r=i.map(o=>$(o,t,s)).filter(o=>!isNaN(null==o?void 0:o.x)).map(o=>o.x);h.xmax=Math.max.apply(null,r)}if(Math.abs(e.xmax-a)<m&&Math.abs(f-e.xmin)>x&&Math.abs(180+h.xmin)<H){h.xmax=180;const i=[];i.push(new A.Z(e.xmin,e.ymin,d)),i.push(new A.Z(e.xmin,(e.ymin+e.ymax)/2,d)),i.push(new A.Z(e.xmin,e.ymax,d));const r=i.map(o=>$(o,t,s)).filter(o=>!isNaN(null==o?void 0:o.x)).map(o=>o.x);h.xmin=Math.min.apply(null,r)}}[f,a]=k(t,!0);const u=O(t);return u&&null!=f&&null!=a&&(Math.abs(h.xmin-f)<u&&(h.xmin=f),Math.abs(h.xmax-a)<u&&(h.xmax=a)),h}function te(e,t=!1){return e.isWebMercator?2*(t?20037508.342787:20037508.342788905):e.wkid&&e.isGeographic?360:2*K[e.wkid]||null}function k(e,t=!1){const s=[],n=te(e,t);return(0,C.pC)(n)&&(s.push(-n/2),s.push(n/2)),s}function ne(e,t,s,n){let d=(e-t)/s;return d-Math.floor(d)!=0?d=Math.floor(d):n&&(d-=1),d}function de(e,t=!1){const s=te(e.spatialReference);if(!(0,C.pC)(s))return 0;const n=t?0:-s/2;return ne(e.xmax,n,s,!0)-ne(e.xmin,n,s,!1)}function me(e){const t=e.storageInfo.origin.x,s=te(e.spatialReference,!0);if(!(0,C.pC)(s))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const n=s/2,{nativePixelSize:d,storageInfo:h,extent:f}=e,{maximumPyramidLevel:a,blockWidth:u,pyramidScalingFactor:m}=h;let x=d.x;const i=[],r=(0,C.pC)(e.transform)&&"gcs-shift"===e.transform.type,o=t+n,y=r?s-t:n-t;for(let c=0;c<=a;c++){const P=(f.xmax-t)/x/u,w=P-Math.floor(P)==0?P:Math.ceil(P),v=(s/2-t)/x/u,M=v-Math.floor(v)==0?v:Math.ceil(v),R=Math.floor(o/x/u),E=Math.round(o/x)%u,I=(u-Math.round(y/x)%u)%u;i.push({resolutionX:x,blockWidth:u,datsetColumnCount:w,worldColumnCountFromOrigin:M,leftMargin:E,rightPadding:I,originColumnOffset:R}),x*=m}return{originX:t,halfWorldWidth:n,pyramidsInfo:i,hasGCSSShiftTransform:r}}function ye(e,t,s,n=null,d=null,h=!1,f=[32,32]){if(G(e.spatialReference,t.spatialReference)&&!(0,W.kR)())throw new L.Z("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(e&&t&&s))return null;const{xmin:a,ymin:u,xmax:m,ymax:x}=e,i=e.spatialReference,r=t.spatialReference,o=te(r);h=h||"gcs-shift"===(null==d?void 0:d.type);const y={x:f[0]*s.x,y:f[1]*s.y},c={cols:Math.ceil((m-a)/y.x-.1/f[0])+1,rows:Math.ceil((x-u)/y.y-.1/f[1])+1},P=y.x,w=y.y,v=[];let M,R=!1;for(let V=0;V<c.cols;V++){const S=[];for(let U=0;U<c.rows;U++){let j=$(new A.Z({x:a+P*V,y:x-w*U,spatialReference:i}),r,n);d&&(j=d.inverseTransform(j)),S.push(j),V>0&&h&&j&&M[U]&&(0,C.pC)(o)&&j.x<M[U].x&&(j.x+=o),j?(v.push((j.x-t.xmin)/(t.xmax-t.xmin)),v.push((t.ymax-j.y)/(t.ymax-t.ymin))):(v.push(NaN),v.push(NaN),R=!0)}M=S}const E=function(e,t){const n=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4;return[Math.abs((e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4-e[2*t.rows+2]),Math.abs(n-e[2*t.rows+3])]}(v,c),I=new Float32Array((c.cols-1)*(c.rows-1)*2*6),b=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),D=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let V=0;V<c.cols-1;V++){for(let S=0;S<c.rows-1;S++){let U=V*c.rows*2+2*S;const j=v[U],Q=v[U+1],oe=v[U+2],le=v[U+3];U+=2*c.rows;const ue=v[U],xe=v[U+1],fe=v[U+2],ie=v[U+3];let B=0,ce=12*(S*(c.cols-1)+V);for(let z=0;z<3;z++)I[ce++]=b[B++]*j+b[B++]*oe+b[B++]*fe;B=0;for(let z=0;z<3;z++)I[ce++]=b[B++]*Q+b[B++]*le+b[B++]*ie;B=0;for(let z=0;z<3;z++)I[ce++]=D[B++]*j+D[B++]*ue+D[B++]*fe;B=0;for(let z=0;z<3;z++)I[ce++]=D[B++]*Q+D[B++]*xe+D[B++]*ie}if(R)for(let S=0;S<I.length;S++)isNaN(I[S])&&(I[S]=-1)}return{offsets:v,error:E,coefficients:I,spacing:f,size:[c.cols-1,c.rows-1]}}function ge(e){const t=e.clone().normalize();return 1===t.length?t[0]:he(t)}function l(e,t,s){const{storageInfo:n,pixelSize:d}=t;let h,f=!1;const{pyramidResolutions:a}=n;if((0,C.pC)(a)&&a.length){const r=(e.x+e.y)/2,o=a[a.length-1],y=(o.x+o.y)/2,c=(d.x+d.y)/2;if(r<=c)h=0;else if(r>=y)h=a.length,f=r/y>8;else{let w,v=c;for(let M=1;M<=a.length;M++){if(w=(a[M-1].x+a[M-1].y)/2,r<=w){r===w?h=M:"down"===s?(h=M-1,f=r/v>8):h="up"===s||r-v>w-r||r/v>2?M:M-1;break}v=w}}const P=0===h?d:a[h-1];return{pyramidLevel:h,pyramidResolution:new A.Z({x:P.x,y:P.y,spatialReference:t.spatialReference}),excessiveReading:f}}const u=Math.log(e.x/d.x)/Math.LN2,m=Math.log(e.y/d.y)/Math.LN2,x=t.storageInfo.maximumPyramidLevel||0;h="down"===s?Math.floor(Math.min(u,m)):"up"===s?Math.ceil(Math.max(u,m)):Math.round((u+m)/2),h<0?h=0:h>x&&(f=h>x+3,h=x);const i=Pe(2,h);return{pyramidLevel:h,pyramidResolution:new A.Z({x:i*t.nativePixelSize.x,y:i*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:f}}function p(e,t,s=512,n=!0){const{extent:d,spatialReference:h,pixelSize:f}=e,a=J(new A.Z({x:f.x,y:f.y,spatialReference:h}),t,d);if(null==a)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(a.x+a.y)/2,m=(0,N.c9)(t),x=u*m*96*39.37,i=t.isGeographic?256/s*295828763.7958547:256/s*591657527.591555;let r="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const o=pe(d,t);r||n&&(t.isGeographic||t.isWebMercator)&&(r=o.xmin*o.xmax<0);let y,c=x;const P=1.001;if(r){c=i;const E=t.isGeographic?1341104507446289e-21:.29858214164761665,I=E*(96*m*39.37);y=J(new A.Z({x:E,y:E,spatialReference:{wkid:t.isGeographic?4326:3857}}),h,o),y.x*=c/I,y.y*=c/I}else{y={x:f.x,y:f.y};const E=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let I=0;for(;c<i*(P/2)&&I<E;)I++,c*=2,y.x*=2,y.y*=2;Math.max(c,i)/Math.min(c,i)<=P&&(c=i)}const w=[c],v=[{x:y.x,y:y.y}],R=Math.min(70.5310735,x)/P;for(;c>=R;)c/=2,y.x/=2,y.y/=2,w.push(c),v.push({x:y.x,y:y.y});return{projectedPixelSize:a,scales:w,srcResolutions:v,isCustomTilingScheme:!r}}},6200:(ve,ae,g)=>{g.d(ae,{KC:()=>K,QI:()=>Y,wF:()=>ye,K:()=>me,Yx:()=>A,nb:()=>ge,BH:()=>re,NL:()=>F,Tg:()=>G});var q=g(9836),_=g(60305),L=g(82657),C=g(21092);const N=new Map;N.set("meter-per-second",1),N.set("kilometer-per-hour",.277778),N.set("knots",.514444),N.set("feet-per-second",.3048),N.set("mile-per-hour",.44704);const W=180/Math.PI,F=new q.Xn({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function A(l,p){return N.get(l)/N.get(p)||1}function H(l){return(450-l)%360}function G(l,p="geographic"){const[e,t]=l,s=Math.sqrt(e*e+t*t);let n=Math.atan2(t,e)*W;return n=(360+n)%360,"geographic"===p&&(n=H(n)),[s,n]}function ee(l,p="geographic"){let e=l[1];"geographic"===p&&(e=H(e)),e%=360;const t=l[0];return[t*Math.cos(e/W),t*Math.sin(e/W)]}function K(l,p,e="geographic",t=1){if(!(0,C.nk)(l))return l;const{pixels:s,width:n,height:d}=l,h=n*d,f=s[0],a=s[1],u=L.Z.createEmptyBand(l.pixelType,h),m=L.Z.createEmptyBand(l.pixelType,h);let x=0;for(let r=0;r<d;r++)for(let o=0;o<n;o++)"vector-uv"===p?([u[x],m[x]]=G([f[x],a[x]],e),u[x]*=t):([u[x],m[x]]=ee([f[x],a[x]],e),u[x]*=t,m[x]*=t),x++;const i=new L.Z({pixelType:l.pixelType,width:l.width,height:l.height,mask:l.mask,validPixelCount:l.validPixelCount,maskIsAlpha:l.maskIsAlpha,pixels:[u,m]});return i.updateStatistics(),i}function Y(l,p,e=1){if(1===e||!(0,C.nk)(l))return l;const t=l.clone(),{pixels:s,width:n,height:d}=t,h=s[0],f=s[1];let a=0;for(let u=0;u<d;u++)for(let m=0;m<n;m++)"vector-uv"===p?(h[a]*=e,f[a]*=e):h[a]*=e,a++;return t.updateStatistics(),t}function re(l,p,e,t,s){if(!(0,_.pC)(s)||!s.spatialReference.equals(l.spatialReference))return{extent:l,width:p,height:e,resolution:l.width/p};const n=s.xmin,d=s.ymax;t=Math.max(t||0,30);const h=Math.ceil(p*(1/t)),f=Math.ceil(e*(1/t)),a=((l.xmax-l.xmin)/h+(l.ymax-l.ymin)/f)/2;return l.xmin=n+Math.floor((l.xmin-n)/a)*a,l.xmax=n+Math.ceil((l.xmax-n)/a)*a,l.ymin=d+Math.floor((l.ymin-d)/a)*a,l.ymax=d+Math.ceil((l.ymax-d)/a)*a,{extent:l,width:Math.round(l.width/a),height:Math.round(l.height/a),resolution:a}}const Z=function(l=0,p=0,e=Math.PI,t=!0){t&&(e=(2*Math.PI-e)%(2*Math.PI));const s=t?-1:1,n=13*s,d=-7*s,h=-2*s,f=-16*s,a=29,[u,m]=O(0,p+n,e,a),[x,i]=O(l-5.5,p+d,e,a),[r,o]=O(l+5.5,p+d,e,a),[y,c]=O(l-1.5,p+h,e,a),[P,w]=O(l+1.5,p+h,e,a),[v,M]=O(l-1.5,p+f,e,a),[R,E]=O(l+1.5,p+f,e,a);return[u,m,x,i,y,c,P,w,r,o,v,M,R,E]}(0,0,0);function J(l=0,p=Math.PI,e=!0){e&&(p=(2*Math.PI-p)%(2*Math.PI));const s=e?-1:1,n=5*s,d=20*s,h=25*s,f=45,i=2*s;let[r,o]=[5,0-d],[y,c]=[r+2,o],[P,w]=[y-0,c+i],[v,M]=[-5,0-h],[R,E]=[v+0,M-i],I=Math.ceil(l/5),b=Math.floor(I/10);I-=8*b;const D=[],V=[];for(let ie=0;ie<I/2;ie++,b--){b<=0&&I%2==1&&ie===(I-1)/2&&(v=0,R=v+0,M=(M+o)/2,E=M-i);const[B,ce]=O(v,M,p,f);if(b>0){const[z,we]=O(y,M,p,f),[Me,Re]=O(r,o,p,f);D.push(z),D.push(we),D.push(B),D.push(ce),D.push(Me),D.push(Re)}else{const[z,we]=O(y,c,p,f),[Me,Re]=O(P,w,p,f),[be,Ee]=O(R,E,p,f);V.push(B),V.push(ce),V.push(be),V.push(Ee),V.push(Me),V.push(Re),V.push(z),V.push(we)}M+=n,o+=n,c+=n,w+=n,E+=n}const[S,U]=O(5,0+d,p,f),[Q,oe]=O(7,0+d,p,f),[le,ue]=O(5,0-h,p,f),[xe,fe]=O(7,0-h,p,f);return{pennants:D,barbs:V,shaft:[S,U,Q,oe,le,ue,xe,fe]}}function O(l,p,e,t=1){const s=Math.sqrt(l*l+p*p)/t,n=(2*Math.PI+Math.atan2(p,l))%(2*Math.PI);return[s,(2*Math.PI+n-e)%(2*Math.PI)]}const $=[0,1,3,6,10,16,21,27,33,40,47,55,63],he=[0,.5,1,1.5,2],pe=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function X(l,p,e,t){const s=A(t||"knots",e);let n;for(n=1;n<p.length;n++)if(n===p.length-1){if(l<p[n]*s)break}else if(l<=p[n]*s)break;return Math.min(n-1,p.length-2)}function te(l,p,e,t,s){let n=0;switch(p){case"beaufort_kn":n=X(l,$,"knots",e);break;case"beaufort_km":n=X(l,$,"kilometer-per-hour",e);break;case"beaufort_ft":n=X(l,$,"feet-per-second",e);break;case"beaufort_m":n=X(l,$,"meter-per-second",e);break;case"classified_arrow":n=X(l,s,t,e);break;case"ocean_current_m":n=X(l,he,"meter-per-second",e);break;case"ocean_current_kn":n=X(l,pe,"knots",e)}return n}const ne=[];function me(l,p){let t=0,s=0;const{width:n,height:d,mask:h}=l,f=l.pixels[0],a=[],u=[],m="wind_speed"===p.style?5:Number.MAX_VALUE;for(let x=0;x<d;x++)for(let i=0;i<n;i++){const r=x*n+i;if((!h||h[x*n+i])&&f[r]<m){for(let y=0;y<4;y++)a[t++]=(i+.5)/n,a[t++]=(x+.5)/d,a[t++]=y<2?-.5:.5,a[t++]=y%2==0?-.5:.5,a[t++]=0,a[t++]=f[r];const o=4*(t/24-1);u[s++]=o,u[s++]=o+1,u[s++]=o+2,u[s++]=o+1,u[s++]=o+2,u[s++]=o+3}}return{vertexData:new Float32Array(a),indexData:new Uint32Array(u)}}function ye(l,p){return"simple_scalar"===p.style?me(l,p):"wind_speed"===p.style?function(l,p){if(0===ne.length)for(let r=0;r<30;r++)ne.push(J(5*r,0));const e=A(F.fromJSON(p.inputUnit),"knots"),{width:t,height:s,mask:n}=l,d=l.pixels[0],h=l.pixels[1],a=[],u=[];let m=0,x=0;for(let r=0;r<s;r++)for(let o=0;o<t;o++){const y=r*t+o,c=d[y]*e;if((!n||n[r*t+o])&&c>=5){var i;const P=null!=(i=(h[y]+360)%360/180*Math.PI)?i:2*Math.PI*Math.random(),{pennants:w,barbs:v,shaft:M}=ne[Math.min(Math.floor(c/5),29)];if(w.length+v.length===0)continue;let R=a.length/6;const E=(o+.5)/t,I=(r+.5)/s;for(let b=0;b<w.length;b+=2)a[m++]=E,a[m++]=I,a[m++]=w[b],a[m++]=w[b+1]+P,a[m++]=0,a[m++]=c;for(let b=0;b<v.length;b+=2)a[m++]=E,a[m++]=I,a[m++]=v[b],a[m++]=v[b+1]+P,a[m++]=0,a[m++]=c;for(let b=0;b<M.length;b+=2)a[m++]=E,a[m++]=I,a[m++]=M[b],a[m++]=M[b+1]+P,a[m++]=0,a[m++]=c;for(let b=0;b<w.length/6;b++)u[x++]=R,u[x++]=R+1,u[x++]=R+2,R+=3;for(let b=0;b<v.length/8;b++)u[x++]=R,u[x++]=R+1,u[x++]=R+2,u[x++]=R+1,u[x++]=R+2,u[x++]=R+3,R+=4;u[x++]=R+0,u[x++]=R+1,u[x++]=R+2,u[x++]=R+1,u[x++]=R+3,u[x++]=R+2,R+=4}}return{vertexData:new Float32Array(a),indexData:new Uint32Array(u)}}(l,p):function(l,p){const{style:e,inputUnit:t,outputUnit:s,breakValues:n}=p,d=F.fromJSON(t),h=F.fromJSON(s);let u=0,m=0;const{width:x,height:i,mask:r}=l,o=l.pixels[0],y=l.pixels[1],c=r?r.filter(M=>M>0).length:x*i,P=new Float32Array(42*c),w=new Uint32Array(15*c);for(let M=0;M<i;M++)for(let R=0;R<x;R++){const E=M*x+R;if(!r||r[M*x+R]){var v;const I=null!=(v=(y[E]+360)%360/180*Math.PI)?v:2*Math.PI*Math.random(),b=te(o[E],e,d,h,n);for(let V=0;V<Z.length;V+=2)P[u++]=(R+.5)/x,P[u++]=(M+.5)/i,P[u++]=Z[V],P[u++]=Z[V+1]+I,P[u++]=b,P[u++]=o[E];const D=7*(u/42-1);w[m++]=D,w[m++]=D+1,w[m++]=D+2,w[m++]=D+0,w[m++]=D+4,w[m++]=D+3,w[m++]=D+0,w[m++]=D+2,w[m++]=D+3,w[m++]=D+2,w[m++]=D+5,w[m++]=D+3,w[m++]=D+5,w[m++]=D+6,w[m++]=D+3}}return{vertexData:P,indexData:w}}(l,p)}function ge(l,p,e,t=[0,0],s=.5){const{width:n,height:d,mask:h}=l,[f,a]=l.pixels,[u,m]=t,x=Math.round((n-u)/e),i=Math.round((d-m)/e),r=x*i,o=new Float32Array(r),y=new Float32Array(r),c=new Uint8Array(r),P="vector-uv"===p;for(let v=0;v<i;v++)for(let M=0;M<x;M++){let R=0;const E=v*x+M,I=Math.max(0,v*e+m),b=Math.max(0,M*e+u),D=Math.min(d,I+e),V=Math.min(n,b+e);for(let S=I;S<D;S++)for(let U=b;U<V;U++){const j=S*n+U;if(!h||h[j]){R++;const Q=P?[f[j],a[j]]:[f[j],(360+a[j])%360],[oe,le]=P?Q:ee(Q);o[E]+=oe,y[E]+=le}}if(R>=(D-I)*(V-b)*(1-s)){c[E]=1;const[S,U]=G([o[E]/R,y[E]/R]);o[E]=S,y[E]=U}else c[E]=0,o[E]=0,y[E]=0}const w=new L.Z({width:x,height:i,pixels:[o,y],mask:c});return w.updateStatistics(),w}},70089:(ve,ae,g)=>{g.r(ae),g.d(ae,{default:()=>x});var q=g(61921),_=g(60046),L=g(97467),C=g(9077),T=(g(67474),g(57025),g(33870)),F=g(42442),A=g(70297),H=g(83459),G=g(40662),ee=g(64859),K=g(60305),Y=g(12523),re=g(12788),Z=g(13637),se=g(82059),J=g(95848),O=g(6200),$=g(12794),he=g(29729),pe=g(561),X=g(8940);const te=T.Z.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D");let k=class extends ee.Z{constructor(){var i;super(...arguments),i=this,this.attached=!1,this.container=new he.W,this.updateRequested=!1,this._graphicsView=null,this._projectFullExtentPromise=null,this._dataParameters={exportParametersVersion:0,extents:[],tileResolution:0,time:""},this.type="Graphics",this._graphics=new $.ZP,this._updateGraphics=(0,Y.Ds)(function(){var r=(0,q.Z)(function*(o,y){if(!o.stationary)return;const c=o.state,P=new se.Z({xmin:c.extent.xmin,ymin:c.extent.ymin,xmax:c.extent.xmax,ymax:c.extent.ymax,spatialReference:c.spatialReference}),[w,v]=o.state.size,M={};M.timeExtent=i.timeExtent,M.requestAsImageElement=!1,M.signal=y,null==i._projectFullExtentPromise&&(i._projectFullExtentPromise=i._getProjectedFullExtent(P.spatialReference));const R="vector-field"===i.layer.renderer.type?i.layer.renderer.symbolTileSize:50,E=yield i._projectFullExtentPromise,{extent:I,resolution:b,width:D,height:V}=(0,O.BH)(P,w,v,R,E),S=yield i.layer.fetchImage(I,D,V,M),U=i.layer.renderer;if("vector-field"===U.type){const j=S.pixelData.pixelBlock,Q=U.sizeVariables[0];!(0,K.pC)(j)||Q.minDataValue&&Q.maxDataValue||(Q.minDataValue=j.statistics[0].minValue,Q.maxDataValue=j.statistics[0].maxValue),i._pixelData={extent:I,pixelBlock:j};const oe=I.clone().normalize(),le={exportParametersVersion:i.layer.exportImageServiceParameters.version,extents:oe,tileResolution:b,time:JSON.stringify(i.timeExtent||"")},ue=i._canReuseVectorFieldData(le)?i._dataParameters.extents:[],xe=yield U.getGraphicsFromPixelData(S.pixelData,"vector-uv"===i.layer.rasterInfo.dataType,ue);if(ue.length){const fe=i._graphics.items.filter(ie=>(0,K.pC)(ie.geometry)&&ue.some(B=>B.intersects(ie.geometry))&&!oe.some(B=>B.intersects(ie.geometry)));i._graphics.removeMany(fe),i._graphics.addMany(xe)}else i._graphics.set("items",xe);i._graphicsView.update(o),i._dataParameters=le}});return function(o,y){return r.apply(this,arguments)}}())}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(i){this._updateGraphics(i).catch(r=>{(0,Y.D_)(r)||te.error(r)})}hitTest(i,r){const o=this.view.toMap((0,re.vW)(i,r));return Promise.resolve(new H.Z({attributes:{},geometry:o,layer:this.layer}))}attach(){this._graphicsView=new X.Z({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new pe.Z(this.view.featuresTilingScheme)}),this.attached=!0}detach(){this._graphics.destroy(),this._graphicsView.destroy(),this.container.removeChild(this._graphicsView.container),this._graphicsView=null}install(i){this.container.addChild(this._graphicsView.container),i.addChild(this.container)}uninstall(i){this.container.removeChild(this._graphicsView.container),i.removeChild(this.container)}isUpdating(){return this._graphicsView.updating||this.updateRequested}getPixelData(){return this.updating?null:this._pixelData}redraw(){}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}_getProjectedFullExtent(i){var r=this;return(0,q.Z)(function*(){try{return yield(0,J.tB)(r.layer.fullExtent,i)}catch(o){try{const y=(yield(0,G.default)(r.layer.url,{query:{option:"footprints",outSR:i.wkid||JSON.stringify(i.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return y?se.Z.fromJSON(y):null}catch(y){return null}}})()}_canReuseVectorFieldData(i){const r=this._dataParameters.exportParametersVersion===i.exportParametersVersion,o=this._dataParameters.time===i.time,y=Math.abs(this._dataParameters.tileResolution-i.tileResolution)/i.tileResolution<.01,c=this._dataParameters.extents.some(P=>i.extents.some(w=>P.intersects(w)));return r&&o&&y&&c}};(0,_._)([(0,C.Cb)()],k.prototype,"attached",void 0),(0,_._)([(0,C.Cb)()],k.prototype,"container",void 0),(0,_._)([(0,C.Cb)()],k.prototype,"layer",void 0),(0,_._)([(0,C.Cb)()],k.prototype,"timeExtent",void 0),(0,_._)([(0,C.Cb)()],k.prototype,"view",void 0),(0,_._)([(0,C.Cb)()],k.prototype,"updateRequested",void 0),(0,_._)([(0,C.Cb)()],k.prototype,"updating",null),(0,_._)([(0,Z.J)({graphics:"Graphics"})],k.prototype,"type",void 0),k=(0,_._)([(0,F.j)("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],k);var ne=k,de=g(21092),me=g(7109),ye=g(28644),ge=g(79821);const l=T.Z.getLogger("esri.views.2d.layers.imagery.ImageryView2D");let p=class extends ee.Z{constructor(){super(...arguments),this.attached=!1,this.container=new he.W,this.updateRequested=!1,this.type="Imagery",this._bitmapView=null}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(i){this.strategy.update(i).catch(r=>{(0,Y.D_)(r)||l.error(r)})}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren()}hitTest(i,r){const o=this.view.toMap((0,re.vW)(i,r));return Promise.resolve(new H.Z({attributes:{},geometry:o,layer:this.layer}))}attach(){const i=this.layer.version>=10,r=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,o=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this._bitmapView=new me.c,this.strategy=new ge.Z({container:this._bitmapView,imageNormalizationSupported:i,imageMaxHeight:r,imageMaxWidth:o,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()}),this.attached=!0}install(i){this.container.addChild(this._bitmapView),i.addChild(this.container)}uninstall(i){this.container.removeChild(this._bitmapView),i.removeChild(this.container)}redraw(){this.strategy.updateExports(i=>{i.source instanceof HTMLImageElement?i.requestRender():this.layer.applyRenderer({pixelBlock:i.source.pixelBlock}).then(r=>{const o=i.source;o.pixelBlock=r.pixelBlock,o.filter=y=>this.layer.applyFilter(y),this.container.requestRender()})})}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const i=this.strategy.bitmaps;if(1===i.length&&i[0].source)return{extent:i[0].source.extent,pixelBlock:i[0].source.originalPixelBlock};if(i.length>1){const r=this.view.extent,o=i.map(c=>c.source).filter(c=>c.extent&&c.extent.intersects(r)).map(c=>({extent:c.extent,pixelBlock:c.originalPixelBlock})),y=(0,de.Kh)(o,r);return(0,K.pC)(y)?{extent:y.extent,pixelBlock:y.pixelBlock}:null}return null}_fetchImage(i,r,o,y){return(y=y||{}).timeExtent=this.timeExtent,y.requestAsImageElement=!0,this.layer.fetchImage(i,r,o,y).then(c=>c.imageElement?c.imageElement:this.layer.applyRenderer(c.pixelData,{signal:y.signal}).then(P=>{const w=new ye.Z(P.pixelBlock,P.extent.clone(),c.pixelData.pixelBlock);return w.filter=v=>this.layer.applyFilter(v),w}))}};(0,_._)([(0,C.Cb)()],p.prototype,"attached",void 0),(0,_._)([(0,C.Cb)()],p.prototype,"container",void 0),(0,_._)([(0,C.Cb)()],p.prototype,"layer",void 0),(0,_._)([(0,C.Cb)()],p.prototype,"strategy",void 0),(0,_._)([(0,C.Cb)()],p.prototype,"timeExtent",void 0),(0,_._)([(0,C.Cb)()],p.prototype,"view",void 0),(0,_._)([(0,C.Cb)()],p.prototype,"updateRequested",void 0),(0,_._)([(0,C.Cb)()],p.prototype,"updating",null),(0,_._)([(0,Z.J)({imagery:"Imagery"})],p.prototype,"type",void 0),p=(0,_._)([(0,F.j)("esri.views.2d.layers.imagery.ImageryView2D")],p);var e=p,t=g(22795),s=g(27640),n=g(99737),d=g(57006),h=g(72501);const f=i=>{let r=class extends i{constructor(){super(...arguments),this.view=null}fetchPopupFeatures(o,y){var c=this;return(0,q.Z)(function*(){const{layer:P}=c;if(!o)throw new t.Z("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:P});const{popupEnabled:w}=P,v=(0,h.V)(P,y);if(!w||!(0,K.pC)(v))throw new t.Z("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:w,popupTemplate:v});const M=yield v.getRequiredFields(),R=new d.Z;R.timeExtent=c.timeExtent,R.geometry=o,R.outFields=M,R.outSpatialReference=o.spatialReference;const E=c.view.resolution,I="2d"===c.view.type?new s.Z(E,E,c.view.spatialReference):new s.Z(.5*E,.5*E,c.view.spatialReference),{returnTopmostRaster:b,showNoDataRecords:D}=v.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},V={returnDomainValues:!0,returnTopmostRaster:b,pixelSize:I,showNoDataRecords:D,signal:(0,K.pC)(y)?y.signal:null};return P.queryVisibleRasters(R,V).then(S=>S)})()}canResume(){var o;return!(!super.canResume()||null!=(o=this.timeExtent)&&o.isEmpty)}};return(0,_._)([(0,C.Cb)()],r.prototype,"layer",void 0),(0,_._)([(0,C.Cb)()],r.prototype,"suspended",void 0),(0,_._)([(0,C.Cb)(n.qG)],r.prototype,"timeExtent",void 0),(0,_._)([(0,C.Cb)()],r.prototype,"view",void 0),r=(0,_._)([(0,F.j)("esri.views.layers.ImageryLayerView")],r),r};var a=g(59989),u=g(72619);let m=class extends(f((0,u.y)((0,A.y)(a.Z)))){constructor(){super(...arguments),this._exportImageVersion=-1}initialize(){this.handles.add([(0,L.S1)(this,["layer.blendMode","layer.effects"],i=>{this.subview&&(this.subview.container.blendMode=i)},!0),(0,L.S1)(this,["layer.effect"],i=>{this.subview&&(this.subview.container.effect=i)},!0)])}get pixelData(){return this.updating?null:this.subview.getPixelData()}get updating(){return!(this.subview&&!this.subview.updating)}hitTest(i,r){return this.suspended||!this.subview?Promise.resolve(null):this.subview.hitTest(i,r)}update(i){var r;null==(r=this.subview)||r.update(i)}attach(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.handles.add([(0,L.S1)(this,"layer.exportImageServiceParameters.version",i=>{this._exportImageVersion!==i&&(this._exportImageVersion=i,this.requestUpdate())}),this.watch("timeExtent",()=>{this.subview.timeExtent=this.timeExtent,this.requestUpdate()}),this.layer.on("redraw",()=>this.subview.redraw()),(0,L.YP)(this.layer,"renderer",()=>this._setSubView())],"imagerylayerview-update")}detach(){this.layer.decreaseRasterJobHandlerUsage(),this.subview.destroy(),this.handles.remove("imagerylayerview-update"),this._exportImageVersion=-1}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}doRefresh(){var i=this;return(0,q.Z)(function*(){i.requestUpdate()})()}isUpdating(){return!this.subview||!this.suspended&&this.subview.isUpdating()}_setSubView(){var i;let r="Imagery";var o,y;"vector-field"===(null==(i=this.layer.renderer)?void 0:i.type)&&"lerc"===this.layer.format&&(r="Graphics"),this.subview&&this.subview.type===r||(null==(o=this.subview)||o.uninstall(this.container),null==(y=this.subview)||y.destroy(),this.subview="Imagery"===r?new e({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new ne({layer:this.layer,view:this.view,timeExtent:this.timeExtent}),this.subview.attach(),this.subview.install(this.container),this.subview.container.blendMode=this.layer.blendMode,this.subview.container.effect=this.layer.effect),this.requestUpdate()}};(0,_._)([(0,C.Cb)()],m.prototype,"pixelData",null),(0,_._)([(0,C.Cb)({readOnly:!0})],m.prototype,"updating",null),(0,_._)([(0,C.Cb)()],m.prototype,"subview",void 0),m=(0,_._)([(0,F.j)("esri.views.2d.layers.ImageryLayerView2D")],m);var x=m},72501:(ve,ae,g)=>{g.d(ae,{V:()=>W,e:()=>C});var q=g(61921),_=g(60305),L=g(76009);function C(T){return N.apply(this,arguments)}function N(){return(N=(0,q.Z)(function*(T,F=T.popupTemplate){if(!(0,_.pC)(F))return[];const A=yield F.getRequiredFields(T.fieldsIndex),{lastEditInfoEnabled:H}=F,{objectIdField:G,typeIdField:ee,globalIdField:K,relationships:Y}=T;if(A.includes("*"))return["*"];const re=H?yield(0,L.CH)(T):[],Z=(0,L.Q0)(T.fieldsIndex,[...A,...re]);return ee&&Z.push(ee),Z&&G&&T.fieldsIndex.has(G)&&-1===Z.indexOf(G)&&Z.push(G),Z&&K&&T.fieldsIndex.has(K)&&-1===Z.indexOf(K)&&Z.push(K),Y&&Y.forEach(se=>{const{keyField:J}=se;Z&&J&&T.fieldsIndex.has(J)&&-1===Z.indexOf(J)&&Z.push(J)}),Z})).apply(this,arguments)}function W(T,F){return T.popupTemplate?T.popupTemplate:(0,_.pC)(F)&&F.defaultPopupTemplateEnabled&&(0,_.pC)(T.defaultPopupTemplate)?T.defaultPopupTemplate:null}}}]);