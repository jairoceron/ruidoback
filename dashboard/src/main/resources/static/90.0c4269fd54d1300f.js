"use strict";(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[90],{6200:(ge,ie,r)=>{r.d(ie,{KC:()=>U,QI:()=>ae,wF:()=>De,K:()=>_e,Yx:()=>f,nb:()=>Ee,BH:()=>D,NL:()=>M,Tg:()=>w});var g=r(9836),x=r(60305),$=r(82657),J=r(21092);const T=new Map;T.set("meter-per-second",1),T.set("kilometer-per-hour",.277778),T.set("knots",.514444),T.set("feet-per-second",.3048),T.set("mile-per-hour",.44704);const O=180/Math.PI,M=new g.Xn({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function f(o,c){return T.get(o)/T.get(c)||1}function m(o){return(450-o)%360}function w(o,c="geographic"){const[u,p]=o,C=Math.sqrt(u*u+p*p);let y=Math.atan2(p,u)*O;return y=(360+y)%360,"geographic"===c&&(y=m(y)),[C,y]}function N(o,c="geographic"){let u=o[1];"geographic"===c&&(u=m(u)),u%=360;const p=o[0];return[p*Math.cos(u/O),p*Math.sin(u/O)]}function U(o,c,u="geographic",p=1){if(!(0,J.nk)(o))return o;const{pixels:C,width:y,height:B}=o,F=y*B,A=C[0],d=C[1],b=$.Z.createEmptyBand(o.pixelType,F),_=$.Z.createEmptyBand(o.pixelType,F);let P=0;for(let j=0;j<B;j++)for(let L=0;L<y;L++)"vector-uv"===c?([b[P],_[P]]=w([A[P],d[P]],u),b[P]*=p):([b[P],_[P]]=N([A[P],d[P]],u),b[P]*=p,_[P]*=p),P++;const K=new $.Z({pixelType:o.pixelType,width:o.width,height:o.height,mask:o.mask,validPixelCount:o.validPixelCount,maskIsAlpha:o.maskIsAlpha,pixels:[b,_]});return K.updateStatistics(),K}function ae(o,c,u=1){if(1===u||!(0,J.nk)(o))return o;const p=o.clone(),{pixels:C,width:y,height:B}=p,F=C[0],A=C[1];let d=0;for(let b=0;b<B;b++)for(let _=0;_<y;_++)"vector-uv"===c?(F[d]*=u,A[d]*=u):F[d]*=u,d++;return p.updateStatistics(),p}function D(o,c,u,p,C){if(!(0,x.pC)(C)||!C.spatialReference.equals(o.spatialReference))return{extent:o,width:c,height:u,resolution:o.width/c};const y=C.xmin,B=C.ymax;p=Math.max(p||0,30);const F=Math.ceil(c*(1/p)),A=Math.ceil(u*(1/p)),d=((o.xmax-o.xmin)/F+(o.ymax-o.ymin)/A)/2;return o.xmin=y+Math.floor((o.xmin-y)/d)*d,o.xmax=y+Math.ceil((o.xmax-y)/d)*d,o.ymin=B+Math.floor((o.ymin-B)/d)*d,o.ymax=B+Math.ceil((o.ymax-B)/d)*d,{extent:o,width:Math.round(o.width/d),height:Math.round(o.height/d),resolution:d}}const G=function(o=0,c=0,u=Math.PI,p=!0){p&&(u=(2*Math.PI-u)%(2*Math.PI));const C=p?-1:1,y=13*C,B=-7*C,F=-2*C,A=-16*C,d=29,[b,_]=Q(0,c+y,u,d),[P,K]=Q(o-5.5,c+B,u,d),[j,L]=Q(o+5.5,c+B,u,d),[X,q]=Q(o-1.5,c+F,u,d),[ee,R]=Q(o+1.5,c+F,u,d),[Y,W]=Q(o-1.5,c+A,u,d),[E,k]=Q(o+1.5,c+A,u,d);return[b,_,P,K,X,q,ee,R,j,L,Y,W,E,k]}(0,0,0);function le(o=0,c=Math.PI,u=!0){u&&(c=(2*Math.PI-c)%(2*Math.PI));const C=u?-1:1,y=5*C,B=20*C,F=25*C,A=45,K=2*C;let[j,L]=[5,0-B],[X,q]=[j+2,L],[ee,R]=[X-0,q+K],[Y,W]=[-5,0-F],[E,k]=[Y+0,W-K],te=Math.ceil(o/5),V=Math.floor(te/10);te-=8*V;const Z=[],se=[];for(let i=0;i<te/2;i++,V--){V<=0&&te%2==1&&i===(te-1)/2&&(Y=0,E=Y+0,W=(W+L)/2,k=W-K);const[e,s]=Q(Y,W,c,A);if(V>0){const[a,l]=Q(X,W,c,A),[h,v]=Q(j,L,c,A);Z.push(a),Z.push(l),Z.push(e),Z.push(s),Z.push(h),Z.push(v)}else{const[a,l]=Q(X,q,c,A),[h,v]=Q(ee,R,c,A),[S,z]=Q(E,k,c,A);se.push(e),se.push(s),se.push(S),se.push(z),se.push(h),se.push(v),se.push(a),se.push(l)}W+=y,L+=y,q+=y,R+=y,k+=y}const[ye,me]=Q(5,0+B,c,A),[Re,Se]=Q(7,0+B,c,A),[xe,Ve]=Q(5,0-F,c,A),[Pe,ze]=Q(7,0-F,c,A);return{pennants:Z,barbs:se,shaft:[ye,me,Re,Se,xe,Ve,Pe,ze]}}function Q(o,c,u,p=1){const C=Math.sqrt(o*o+c*c)/p,y=(2*Math.PI+Math.atan2(c,o))%(2*Math.PI);return[C,(2*Math.PI+y-u)%(2*Math.PI)]}const be=[0,1,3,6,10,16,21,27,33,40,47,55,63],Me=[0,.5,1,1.5,2],he=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function ce(o,c,u,p){const C=f(p||"knots",u);let y;for(y=1;y<c.length;y++)if(y===c.length-1){if(o<c[y]*C)break}else if(o<=c[y]*C)break;return Math.min(y-1,c.length-2)}function de(o,c,u,p,C){let y=0;switch(c){case"beaufort_kn":y=ce(o,be,"knots",u);break;case"beaufort_km":y=ce(o,be,"kilometer-per-hour",u);break;case"beaufort_ft":y=ce(o,be,"feet-per-second",u);break;case"beaufort_m":y=ce(o,be,"meter-per-second",u);break;case"classified_arrow":y=ce(o,C,p,u);break;case"ocean_current_m":y=ce(o,Me,"meter-per-second",u);break;case"ocean_current_kn":y=ce(o,he,"knots",u)}return y}const oe=[];function _e(o,c){let p=0,C=0;const{width:y,height:B,mask:F}=o,A=o.pixels[0],d=[],b=[],_="wind_speed"===c.style?5:Number.MAX_VALUE;for(let P=0;P<B;P++)for(let K=0;K<y;K++){const j=P*y+K;if((!F||F[P*y+K])&&A[j]<_){for(let X=0;X<4;X++)d[p++]=(K+.5)/y,d[p++]=(P+.5)/B,d[p++]=X<2?-.5:.5,d[p++]=X%2==0?-.5:.5,d[p++]=0,d[p++]=A[j];const L=4*(p/24-1);b[C++]=L,b[C++]=L+1,b[C++]=L+2,b[C++]=L+1,b[C++]=L+2,b[C++]=L+3}}return{vertexData:new Float32Array(d),indexData:new Uint32Array(b)}}function De(o,c){return"simple_scalar"===c.style?_e(o,c):"wind_speed"===c.style?function(o,c){if(0===oe.length)for(let j=0;j<30;j++)oe.push(le(5*j,0));const u=f(M.fromJSON(c.inputUnit),"knots"),{width:p,height:C,mask:y}=o,B=o.pixels[0],F=o.pixels[1],d=[],b=[];let _=0,P=0;for(let j=0;j<C;j++)for(let L=0;L<p;L++){const X=j*p+L,q=B[X]*u;if((!y||y[j*p+L])&&q>=5){var K;const ee=null!=(K=(F[X]+360)%360/180*Math.PI)?K:2*Math.PI*Math.random(),{pennants:R,barbs:Y,shaft:W}=oe[Math.min(Math.floor(q/5),29)];if(R.length+Y.length===0)continue;let E=d.length/6;const k=(L+.5)/p,te=(j+.5)/C;for(let V=0;V<R.length;V+=2)d[_++]=k,d[_++]=te,d[_++]=R[V],d[_++]=R[V+1]+ee,d[_++]=0,d[_++]=q;for(let V=0;V<Y.length;V+=2)d[_++]=k,d[_++]=te,d[_++]=Y[V],d[_++]=Y[V+1]+ee,d[_++]=0,d[_++]=q;for(let V=0;V<W.length;V+=2)d[_++]=k,d[_++]=te,d[_++]=W[V],d[_++]=W[V+1]+ee,d[_++]=0,d[_++]=q;for(let V=0;V<R.length/6;V++)b[P++]=E,b[P++]=E+1,b[P++]=E+2,E+=3;for(let V=0;V<Y.length/8;V++)b[P++]=E,b[P++]=E+1,b[P++]=E+2,b[P++]=E+1,b[P++]=E+2,b[P++]=E+3,E+=4;b[P++]=E+0,b[P++]=E+1,b[P++]=E+2,b[P++]=E+1,b[P++]=E+3,b[P++]=E+2,E+=4}}return{vertexData:new Float32Array(d),indexData:new Uint32Array(b)}}(o,c):function(o,c){const{style:u,inputUnit:p,outputUnit:C,breakValues:y}=c,B=M.fromJSON(p),F=M.fromJSON(C);let b=0,_=0;const{width:P,height:K,mask:j}=o,L=o.pixels[0],X=o.pixels[1],q=j?j.filter(W=>W>0).length:P*K,ee=new Float32Array(42*q),R=new Uint32Array(15*q);for(let W=0;W<K;W++)for(let E=0;E<P;E++){const k=W*P+E;if(!j||j[W*P+E]){var Y;const te=null!=(Y=(X[k]+360)%360/180*Math.PI)?Y:2*Math.PI*Math.random(),V=de(L[k],u,B,F,y);for(let se=0;se<G.length;se+=2)ee[b++]=(E+.5)/P,ee[b++]=(W+.5)/K,ee[b++]=G[se],ee[b++]=G[se+1]+te,ee[b++]=V,ee[b++]=L[k];const Z=7*(b/42-1);R[_++]=Z,R[_++]=Z+1,R[_++]=Z+2,R[_++]=Z+0,R[_++]=Z+4,R[_++]=Z+3,R[_++]=Z+0,R[_++]=Z+2,R[_++]=Z+3,R[_++]=Z+2,R[_++]=Z+5,R[_++]=Z+3,R[_++]=Z+5,R[_++]=Z+6,R[_++]=Z+3}}return{vertexData:ee,indexData:R}}(o,c)}function Ee(o,c,u,p=[0,0],C=.5){const{width:y,height:B,mask:F}=o,[A,d]=o.pixels,[b,_]=p,P=Math.round((y-b)/u),K=Math.round((B-_)/u),j=P*K,L=new Float32Array(j),X=new Float32Array(j),q=new Uint8Array(j),ee="vector-uv"===c;for(let Y=0;Y<K;Y++)for(let W=0;W<P;W++){let E=0;const k=Y*P+W,te=Math.max(0,Y*u+_),V=Math.max(0,W*u+b),Z=Math.min(B,te+u),se=Math.min(y,V+u);for(let ye=te;ye<Z;ye++)for(let me=V;me<se;me++){const pe=ye*y+me;if(!F||F[pe]){E++;const Re=ee?[A[pe],d[pe]]:[A[pe],(360+d[pe])%360],[Se,xe]=ee?Re:N(Re);L[k]+=Se,X[k]+=xe}}if(E>=(Z-te)*(se-V)*(1-C)){q[k]=1;const[ye,me]=w([L[k]/E,X[k]/E]);L[k]=ye,X[k]=me}else q[k]=0,L[k]=0,X[k]=0}const R=new $.Z({width:P,height:K,pixels:[L,X],mask:q});return R.updateStatistics(),R}},79337:(ge,ie,r)=>{r.d(ie,{Z:()=>I});var g=r(67474),x=r(38963),$=r(91099),J=r(86932),T=r(3953);const O=(M,f)=>M.key.level-f.key.level!=0?M.key.level-f.key.level:M.key.row-f.key.row!=0?M.key.row-f.key.row:M.key.col-f.key.col;class I extends $.Z{constructor(f){super(),this._tileInfoView=f}get requiresDedicatedFBO(){return!1}renderChildren(f){this.sortChildren(O),this.setStencilReference(),super.renderChildren(f)}createRenderParams(f){const{state:m}=f,w=super.createRenderParams(f);return w.requiredLevel=this._tileInfoView.getClosestInfoForScale(m.scale).level,w.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(m.scale),w}prepareRenderPasses(f){const m=super.prepareRenderPasses(f);return m.push(f.registerRenderPass({name:"stencil",brushes:[T.Z],drawPhase:x.jx.DEBUG|x.jx.MAP|x.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,g.Z)("esri-tiles-debug")&&m.push(f.registerRenderPass({name:"tileInfo",brushes:[J.Z],drawPhase:x.jx.DEBUG,target:()=>this.children})),m}getStencilTarget(){return this.children}updateTransforms(f){for(const m of this.children){const w=this._tileInfoView.getTileResolution(m.key);m.setTransform(f,w)}}setStencilReference(){let f=1;for(const m of this.children)m.stencilRef=f++}}},96620:(ge,ie,r)=>{r.d(ie,{I:()=>J});var g=r(19554),x=r(66505),$=r(6525);class J extends x.s{constructor(O,I,M,f,m,w=f,N=m){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new $.Z(O),this.x=I,this.y=M,this.width=f,this.height=m,this.rangeX=w,this.rangeY=N}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(O,I){const M=I/(O.resolution*O.pixelRatio),f=this.transforms.tileMat3,[m,w]=O.toScreenNoRotation([0,0],[this.x,this.y]);(0,g.s)(f,this.width/this.rangeX*M,0,0,0,this.height/this.rangeY*M,0,m,w,1),(0,g.m)(this.transforms.dvs,O.displayViewMat3,f)}}},10090:(ge,ie,r)=>{r.r(ie),r.d(ie,{default:()=>ze});var g=r(61921),x=r(60046),J=(r(73513),r(83459)),T=r(33870),O=r(60305),I=r(12523),M=r(12788),f=r(97467),m=r(9077),U=(r(67474),r(57025),r(42442)),ae=r(31818),D=r(52791),G=r(21092),ne=r(95848),le=r(70297),Q=r(13638),be=r(963),Me=r(56109),he=r(61274),ce=r(27477),de=r(96620);class we extends de.I{constructor(e,s,a,l,h,v=null){super(e,s,a,l,h),this.bitmap=new ce.br(v,null,null),this.bitmap.coordScale=[l,h],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}setTransform(e,s){super.setTransform(e,s),this.bitmap.transforms.dvs=this.transforms.dvs}_createTransforms(){return{dvs:(0,he.c)(),tileMat3:(0,he.c)()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}var oe=r(38963),Ie=r(79337);class _e extends Ie.Z{constructor(){super(...arguments),this.isCustomTilingScheme=!1}createTile(e){const s=this._getTileBounds(e),[a,l]=this._tileInfoView.tileInfo.size;return new we(e,s[0],s[3],a,l)}destroyTile(){}prepareRenderPasses(e){const s=e.registerRenderPass({name:"imagery (tile)",brushes:[Me.U.raster],target:()=>this.children.map(a=>a.bitmap),drawPhase:oe.jx.MAP});return[...super.prepareRenderPasses(e),s]}doRender(e){this.visible&&e.drawPhase===oe.jx.MAP&&super.doRender(e)}_getTileBounds(e){const s=this._tileInfoView.getTileBounds((0,Q.Ue)(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:a}=this._tileInfoView,l=(0,be.ut)(a.spatialReference);if(l){const{resolution:h}=a.lodAt(e.level),v=l/h%a.size[0],S=v?(a.size[0]-v)*h:0;s[0]-=S*e.world,s[2]-=S*e.world}}return s}}var De=r(64859),Ee=r(82657);let o=class extends De.Z{constructor(){super(...arguments),this._emptyTilePixelBlock=null,this.container=null,this.layer=null,this.tileSize=null,this.useWebGLForProcessing=!0}fetchTile(i,e){return this.layer.fetchTile(i.level,i.row,i.col,e)}createEmptyTilePixelBlock(i=null){const e=null==i||i.join(",")===this.tileSize.join(",");if(e&&(0,O.pC)(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;i=i||this.tileSize;const[s,a]=i,l=new Ee.Z({width:s,height:a,pixels:[new Uint8Array(s*a)],mask:new Uint8Array(s*a),pixelType:"u8"});return e&&(this._emptyTilePixelBlock=l),l}};(0,x._)([(0,m.Cb)()],o.prototype,"container",void 0),(0,x._)([(0,m.Cb)()],o.prototype,"layer",void 0),(0,x._)([(0,m.Cb)()],o.prototype,"tileSize",void 0),(0,x._)([(0,m.Cb)()],o.prototype,"type",void 0),(0,x._)([(0,m.Cb)()],o.prototype,"useWebGLForProcessing",void 0),o=(0,x._)([(0,U.j)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],o);let c=class extends o{constructor(){super(...arguments),this.container=null,this.layer=null,this.tileSize=null,this.type="raster",this.useWebGLForProcessing=!0}canUseWebGLForProcessing(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())}fetchTile(i,e){return this.layer.fetchTile(i.level,i.row,i.col,e)}updateTileSource(i,e){var s=this;return(0,g.Z)(function*(){const{bandIds:a}=s.layer,l=s._getLayerInterpolation(),h=s.canUseWebGLForProcessing(),{source:v,symbolizerParams:S,globalSymbolizerParams:z,suspended:re,coords:ue,resolution:Te}=e,{bitmap:H}=i;if([H.x,H.y]=ue,H.resolution=Te,v&&(0,O.pC)(v)&&(0,O.pC)(v.pixelBlock)){const fe={extent:v.extent,pixelBlock:v.pixelBlock};if(H.rawPixelData=fe,h)H.source=v.pixelBlock,H.isRendereredSource=!1;else{const ve=yield s.layer.applyRenderer(fe,"stretch"===(null==z?void 0:z.type)?z:null);H.source=ve,H.isRendereredSource=!0}H.symbolizerParameters=h?S:null,h?H.transformGrid||(H.transformGrid=v.transformGrid):H.transformGrid=null}else{const fe=s.createEmptyTilePixelBlock();H.source=fe,H.symbolizerParameters=h?S:null,H.transformGrid=null}H.bandIds=h?a:null,H.width=s.tileSize[0],H.height=s.tileSize[1],H.interpolation=l,H.suspended=re,H.invalidateTexture()})()}updateTileSymbolizerParameters(i,e){var s=this;return(0,g.Z)(function*(){const{local:a,global:l}=e,{bandIds:h}=s.layer,v=s._getLayerInterpolation(),S=s.canUseWebGLForProcessing(),{bitmap:z}=i,{rawPixelData:re}=z;!S&&(0,O.pC)(re)?(z.source=yield s.layer.applyRenderer(re,"stretch"===(null==l?void 0:l.type)?l:null),z.isRendereredSource=!0):(z.isRendereredSource&&(0,O.pC)(re)&&(z.source=re.pixelBlock),z.isRendereredSource=!1),z.symbolizerParameters=S?l||a:null,z.bandIds=S?h:null,z.interpolation=v,z.suspended=!1})()}install(i,e){this.container=new _e(e.tileInfoView),this.container.isCustomTilingScheme=e.isCustomTilingScheme,i.addChild(this.container)}uninstall(){this.container.removeAllChildren(),this.container.remove()}_canUseMajorityInterpolationOnDataSource(){const{bandCount:i,attributeTable:e,colormap:s,pixelType:a}=this.layer.rasterInfo;return 1===i&&(null!=e||null!=s||"u8"===a||"s8"===a)}_getLayerInterpolation(){const i=this.layer.renderer.type;if("raster-colormap"===i||"unique-value"===i||"class-breaks"===i)return"nearest";const{interpolation:e}=this.layer,{renderer:s}=this.layer;return"raster-stretch"===s.type&&null!=s.colorRamp?"bilinear"===e||"cubic"===e?"bilinear":"nearest":e}};(0,x._)([(0,m.Cb)()],c.prototype,"container",void 0),(0,x._)([(0,m.Cb)()],c.prototype,"layer",void 0),(0,x._)([(0,m.Cb)()],c.prototype,"tileSize",void 0),(0,x._)([(0,m.Cb)()],c.prototype,"type",void 0),(0,x._)([(0,m.Cb)()],c.prototype,"useWebGLForProcessing",void 0),c=(0,x._)([(0,U.j)("esri.views.2d.layers.imagery.ImageryTileView2D")],c);var u=c,p=r(6200),C=r(19554),y=r(26436),P=(r(27001),r(36320),r(40150),r(94345),r(82705),r(13006),r(48082)),K=r(66505),j=r(20547);class L extends K.s{constructor(e=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.stencilRef=0,this.rawPixelData=null,this.width=null,this.source=e}destroy(){var e,s;(0,O.pC)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(s=this.vaoData.scalar)||s.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}get source(){return this._source}set source(e){this._source=e,this.invalidateVAO()}invalidateVAO(){var e,s;!this._vaoInvalidated&&(0,O.pC)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(s=this.vaoData.scalar)||s.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,(0,O.pC)(this.source)&&!(0,O.pC)(this.vaoData)){const{style:s}=this.symbolizerParameters;switch(s){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const a=(0,p.wF)(this.source,this.symbolizerParameters),l=this._createVectorFieldVAO(e.context,a);this.vaoData={magdir:l}}break;case"simple_scalar":{const a=(0,p.K)(this.source,this.symbolizerParameters),l=this._createVectorFieldVAO(e.context,a);this.vaoData={scalar:l}}break;case"wind_speed":{const a=(0,p.wF)(this.source,this.symbolizerParameters),l=this._createVectorFieldVAO(e.context,a),h=(0,p.K)(this.source,this.symbolizerParameters),v=this._createVectorFieldVAO(e.context,h);this.vaoData={magdir:l,scalar:v}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:(0,he.c)()}}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(e,s){const{vertexData:a,indexData:l}=s,h=y.Z.createVertex(e,35044,new Float32Array(a)),v=y.Z.createIndex(e,35044,new Uint32Array(l)),S=(0,j.cM)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:5126,normalized:!1},{location:1,name:"a_offset",count:2,type:5126,normalized:!1},{location:2,name:"a_vv",count:2,type:5126,normalized:!1}]});return{vao:new P.Z(e,S.attributes,S.bufferLayouts,{geometry:h},v),elementCount:l.length}}}class X extends de.I{constructor(e,s,a,l,h,v=null){super(e,s,a,l,h),this.tileData=new L(v),this.tileData.coordScale=[l,h],this.tileData.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(e){this.tileData.stencilRef=e}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{dvs:(0,he.c)(),tileMat3:(0,he.c)()}}setTransform(e,s){super.setTransform(e,s);const a=s/(e.resolution*e.pixelRatio),l=this.transforms.tileMat3,[h,v]=this.tileData.offset,S=[this.x+h*s,this.y-v*s],[z,re]=e.toScreenNoRotation([0,0],S),{symbolTileSize:ue}=this.tileData.symbolizerParameters,Te=Math.round((this.width-this.tileData.offset[0])/ue)*ue,H=Math.round((this.height-this.tileData.offset[1])/ue)*ue;(0,C.s)(l,Te/this.rangeX*a,0,0,0,H/this.rangeY*a,0,z,re,1),(0,C.m)(this.transforms.dvs,e.displayViewMat3,l),this.tileData.transforms.dvs=this.transforms.dvs}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}var q=r(40085);class ee extends Ie.Z{constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}createTile(e){const s=this._tileInfoView.getTileBounds((0,Q.Ue)(),e),[a,l]=this._tileInfoView.tileInfo.size;return new X(e,s[0],s[3],a,l)}destroyTile(){}prepareRenderPasses(e){const s=e.registerRenderPass({name:"imagery (vf tile)",brushes:[q.Z],target:()=>this.children.map(a=>a.tileData),drawPhase:oe.jx.MAP});return[...super.prepareRenderPasses(e),s]}doRender(e){this.visible&&e.drawPhase===oe.jx.MAP&&this.symbolTypes.forEach(s=>{e.renderPass=s,super.doRender(e)})}}let R=class extends o{constructor(){super(...arguments),this._handle=null,this.container=null,this.layer=null,this.tileSize=null,this.type="rasterVF",this.useWebGLForProcessing=!0}canUseWebGLForProcessing(){return!1}fetchTile(i,e){var s=this;return(0,g.Z)(function*(){const a=yield s.layer.fetchTile(i.level,i.row,i.col,e);return"vector-magdir"===s.layer.rasterInfo.dataType&&null!=a&&a.pixelBlock&&(a.pixelBlock=yield s.layer.convertVectorFieldData(a.pixelBlock,e)),a})()}updateTileSource(i,e){const s=e.symbolizerParams,{tileData:a}=i;a.key=i.key,a.width=this.tileSize[0],a.height=this.tileSize[1];const{symbolTileSize:l}=s,{source:h}=e;if(a.offset=this._getTileSymbolOffset(a.key,l),(0,O.pC)(h)&&(0,O.pC)(h.pixelBlock))a.rawPixelData={extent:h.extent,pixelBlock:h.pixelBlock},a.source=this._sampleVectorFieldData(h.pixelBlock,s,a.offset),a.symbolizerParameters=s;else{const v=[Math.round((this.tileSize[0]-a.offset[0])/l),Math.round((this.tileSize[1]-a.offset[1])/l)],S=this.createEmptyTilePixelBlock(v);a.source=S,a.symbolizerParameters=s}return a.invalidateVAO(),Promise.resolve(null)}updateTileSymbolizerParameters(i,e){var s;const a=e.local,{symbolTileSize:l}=a,{tileData:h}=i;h.offset=this._getTileSymbolOffset(h.key,l);const v=h.symbolizerParameters.symbolTileSize;return h.symbolizerParameters=a,(0,O.pC)(null==(s=h.rawPixelData)?void 0:s.pixelBlock)&&v!==l&&(h.source=this._sampleVectorFieldData(h.rawPixelData.pixelBlock,h.symbolizerParameters,h.offset)),Promise.resolve(null)}install(i,e){this.container=new ee(e.tileInfoView),this.container.isCustomTilingScheme=e.isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=this.layer.watch("renderer",s=>this._updateSymbolType(s)),i.addChild(this.container)}uninstall(){this.container.removeAllChildren(),this._handle.remove(),this._handle=null,this.container.remove()}_getTileSymbolOffset(i,e){const s=i.col*this.tileSize[0]%e,a=i.row*this.tileSize[1]%e;return[s>e/2?e-s:-s,a>e/2?e-a:-a]}_sampleVectorFieldData(i,e,s){const{symbolTileSize:a}=e;return(0,p.nb)(i,"vector-uv",a,s)}_updateSymbolType(i){"vector-field"===i.type&&(this.container.symbolTypes="wind-barb"===i.style?["scalar","triangle"]:"simple-scalar"===i.style?["scalar"]:["triangle"])}};(0,x._)([(0,m.Cb)()],R.prototype,"container",void 0),(0,x._)([(0,m.Cb)()],R.prototype,"layer",void 0),(0,x._)([(0,m.Cb)()],R.prototype,"tileSize",void 0),(0,x._)([(0,m.Cb)()],R.prototype,"type",void 0),(0,x._)([(0,m.Cb)()],R.prototype,"useWebGLForProcessing",void 0),R=(0,x._)([(0,U.j)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],R);var Y=R,W=r(54231),E=r(71079),k=r(59868),te=r(22795),V=r(72501);const Z=i=>{let e=class extends i{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.fullExtent=null,this.tileInfo=null,this.datumTransformation=null}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}fetchPopupFeatures(s,a){var l=this;return(0,g.Z)(function*(){const{layer:h}=l;if(!s)return Promise.reject(new te.Z("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:h}));const{popupEnabled:v}=h,S=(0,V.V)(h,a);if(!v||!(0,O.pC)(S))throw new te.Z("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:v,popupTemplate:S});const z=[],{value:re,magdirValue:ue}=yield h.identify(s);let Te="";if(re&&re.length){var H,fe;Te="imagery-tile"===h.type&&h.hasStandardTime()&&null!=re[0]?re.map(Le=>h.getStandardTimeValue(Le)).join(", "):re.join(", ");const ve={ObjectId:0},Be="Raster.ServicePixelValue";ve[Be]=l._formatAttributeValue(Te,Be);const Ae=null==(H=h.rasterInfo)||null==(fe=H.attributeTable)?void 0:fe.features;if(Ae&&Ae.length>0){const Le=Ae.filter(Ce=>String(Ce.attributes.value||Ce.attributes.Value||Ce.attributes.VALUE)===Te);if(Le.length>0){const Ce=Le[0];if(Ce)for(const Oe in Ce.attributes)if(Ce.attributes.hasOwnProperty(Oe)){const Fe=l._rasterFieldPrefix+Oe;ve[Fe]=l._formatAttributeValue(Ce.attributes[Oe],Fe)}}}const je=h.rasterInfo.dataType;"vector-magdir"!==je&&"vector-uv"!==je||(ve["Raster.Magnitude"]=null==ue?void 0:ue[0],ve["Raster.Direction"]=null==ue?void 0:ue[1]);const Ue=new J.Z(l.fullExtent.clone(),null,ve);Ue.layer=h,Ue.sourceLayer=Ue.layer,z.push(Ue)}return z})()}updateFullExtent(){const s=this.layer.tileInfo;let a;s&&s.spatialReference||(a=new te.Z("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));const l=(0,ne._D)(this.layer.fullExtent,this.view.spatialReference,!1),h=(0,ne.tB)(this.layer.fullExtent,this.view.spatialReference,l);return null==h&&(a=new te.Z("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})),this._set("fullExtent",h),this.datumTransformation||(this.datumTransformation=(0,ne._D)(this.layer.fullExtent,this.view.spatialReference,!0)),a?Promise.reject(a):Promise.resolve()}_formatAttributeValue(s,a){if("string"==typeof s){const h=this._getFieldInfo(this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,a),v=h&&h.format;if(v){let S,z;return s.trim().indexOf(",")>-1?(S=",",z=S+" ",this._formatDelimitedString(s,S,z,v)):s.trim().indexOf(" ")>-1?(S=z=" ",this._formatDelimitedString(s,S,z,v)):this._formatNumberFromString(s,v)}}return s}_getFieldInfo(s,a){if(!s||!s.length||!a)return;const l=a.toLowerCase();let h;return s.some(v=>!(!v.fieldName||v.fieldName.toLowerCase()!==l&&v.fieldName.toLowerCase()!==l.replace(/ /g,"_")||(h=v,0))),h}_formatDelimitedString(s,a,l,h){return s&&a&&l&&h?s.trim().split(a).map(v=>this._formatNumberFromString(v,h)).join(l):s}_formatNumberFromString(s,a){if(!s||!a)return s;const l=Number(s);return isNaN(l)?s:a.format(l)}};return(0,x._)([(0,m.Cb)()],e.prototype,"layer",void 0),(0,x._)([(0,m.Cb)()],e.prototype,"view",void 0),(0,x._)([(0,m.Cb)()],e.prototype,"fullExtent",void 0),(0,x._)([(0,m.Cb)()],e.prototype,"tileInfo",void 0),(0,x._)([(0,m.Cb)({readOnly:!0})],e.prototype,"hasTilingEffects",null),e=(0,x._)([(0,U.j)("esri.views.layers.ImageryTileLayerView")],e),e};var se=r(59989),ye=r(72619),me=r(16204),pe=r(68121),Re=r(82059),Se=r(27640);const xe=T.Z.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),Ve=[0,0];let Pe=class extends(Z((0,ye.y)((0,le.y)(se.Z)))){constructor(){super(...arguments),this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=null,this._previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._globalUpdateRequested=!1,this._isCustomTilingScheme=!1,this.subview=null,this._redrawOrRefetch=(0,I.Ds)((i,e)=>i?this.doRefresh():this._redrawImage(e))}initialize(){const i=this.updateFullExtent();this.addResolvingPromise(i)}get useWebGLForProcessing(){var i;return null==(i=this._get("useWebGLForProcessing"))||i}set useWebGLForProcessing(i){this.subview&&(this.subview.useWebGLForProcessing=i),this._set("useWebGLForProcessing",i)}get useProgressiveUpdate(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")}set useProgressiveUpdate(i){if(this._tileStrategy&&this.useProgressiveUpdate!==i){var e;this._tileStrategy.destroy(),null==(e=this.subview)||e.container.removeAllChildren();const s=this._getCacheSize(i);this._tileStrategy=new k.Z({cachePolicy:"purge",acquireTile:a=>this.acquireTile(a),releaseTile:a=>this.releaseTile(a),cacheSize:s,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",i),this.requestUpdate()}}hitTest(i,e){if(this.suspended)return Promise.resolve(null);const s=this.view.toMap((0,M.vW)(i,e));return Promise.resolve(new J.Z({attributes:{},geometry:s}))}update(i){this._fetchQueue.pause(),this._fetchQueue.state=i.state,this._tileStrategy.update(i),this._fetchQueue.resume();const{extent:e,resolution:s,scale:a}=i.state,l=this._tileInfoView.getClosestInfoForScale(a);if(this.layer.raster){var h;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const v=this._srcResolutions[l.level],S=e.toJSON?e:Re.Z.fromJSON(e);(0,D.Vx)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,S,s,v,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(h=this._previousLOD)?void 0:h.level)!==l.level&&(this._previousLOD=l,null==this._symbolizerParams||this.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}this.notifyChange("updating")}attach(){this.layer.increaseRasterJobHandlerUsage(),(0,pe.Z)().supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new W.Z(this.tileInfo,this.fullExtent);const i=this._computeFetchConcurrency();this._fetchQueue=new E.Z({tileInfoView:this._tileInfoView,concurrency:i,process:(s,a)=>this.fetchTile(s,a)});const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new k.Z({cachePolicy:"purge",acquireTile:s=>this.acquireTile(s),releaseTile:s=>this.releaseTile(s),cacheSize:e,tileInfoView:this._tileInfoView}),this._updatesubview(),this.handles.add([(0,f.YP)(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(s,a,l)=>{const h="multidimensionalDefinition"===l,v="interpolation"===l&&("majority"===s||"majority"===a)&&this._canUseMajorityInterpolationOnDataSource(),S="renderer"===l&&"vector-field"===a.type!=("vector-field"===a.type);S&&this._updatesubview(),this._redrawOrRefetch(h||v||S).catch(re=>{(0,I.D_)(re)||xe.error(re)})}),(0,f.S1)(this,["layer.blendMode"],s=>{this.subview&&(this.subview.container.blendMode=s)},!0),(0,f.S1)(this,["layer.effect"],s=>{this.subview&&(this.subview.container.effect=s)},!0)],"attach"),this._updateBlockCacheRegistry()}detach(){var i;this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),null==(i=this.subview)||i.uninstall(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,D.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){!this.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=(0,I.yi)(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1,this.requestUpdate()}));const i=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(i),this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(i,e){return(0,me.K)(i,e,this.view)}doRefresh(){var i=this;return(0,g.Z)(function*(){if(i.suspended)return;yield i.layer.updateRenderer(),i._updateSymbolizerParams(),i._updateBlockCacheRegistry(!0),i._fetchQueue.reset();const e=[];i._tileStrategy.tiles.forEach(s=>e.push(i._enqueueTileFetch(s))),yield(0,I.as)(e),i.notifyChange("updating")})()}isUpdating(){return this._fetchQueue.length>0||this._globalUpdateRequested}acquireTile(i){const e=this.subview.container.createTile(i);return this._enqueueTileFetch(e),this.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate,e}releaseTile(i){var e;this._fetchQueue.abort(i.key.id),null==(e=this.subview)||e.container.removeChild(i),i.once("detach",()=>{i.destroy(),this.requestUpdate()}),this.requestUpdate()}fetchTile(i,e){const s=!(0,O.Wi)(e)&&e.signal,a=this.subview.canUseWebGLForProcessing(),l={allowPartialFill:!0,tileInfo:this.tileInfo,signal:(0,O.Wg)(s),registryId:this._blockCacheRegistryId,requestRawData:a,srcResolution:this._srcResolutions[i.level],datumTransformation:this.datumTransformation,interpolation:a?"nearest":this.layer.interpolation};return this.subview.fetchTile(i,l)}_updatesubview(){const i=this._isVectorField()?"rasterVF":"raster";if(this.subview){if(this.subview.type===i)return;this.subview.uninstall()}const{layer:e}=this,s=new("rasterVF"===i?Y:u)({layer:e,tileSize:this.tileInfo.size,useWebGLForProcessing:this.useWebGLForProcessing});s.install(this.container,{tileInfoView:this._tileInfoView,isCustomTilingScheme:this._isCustomTilingScheme}),s.container.blendMode=e.blendMode,s.container.effect=e.effect,this.subview=s}_isVectorField(){return"vector-field"===this.layer.renderer.type}_getCacheSize(i){return i?40:0}_initializeTileInfo(){const i=this.view.spatialReference,e=new Se.Z({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:i}),{scales:s,srcResolutions:a,isCustomTilingScheme:l}=(0,ne.vF)(this.layer.rasterInfo,i),h=ae.Z.create({spatialReference:i,size:512,scales:s});(0===h.origin.x||h.origin.x>e.x)&&(h.origin=e),this._isCustomTilingScheme=l,this._set("tileInfo",h),this._srcResolutions=null!=a?a:[]}_computeFetchConcurrency(){const{blockBoundary:i}=this.layer.rasterInfo.storageInfo,e=i[i.length-1];return(e.maxCol-e.minCol+1)*(e.maxRow-e.minRow+1)>64?2:10}_enqueueTileFetch(i,e){var s=this;return(0,g.Z)(function*(){if(!s._fetchQueue.has(i.key.id)){try{const a=yield s._fetchQueue.push(i.key),{bandIds:l}=s.layer;let h=!s.useProgressiveUpdate||s.hasTilingEffects&&!s._globalSymbolizerParams;if(s._globalUpdateRequested&&!s.moving&&0===s._fetchQueue.length){h=!1;try{yield s._redrawImage(s._abortController&&s._abortController.signal)}catch(z){(0,I.D_)(z)&&xe.error(z)}s._globalUpdateRequested=!1}!s.subview.canUseWebGLForProcessing()&&!s._isVectorField()||s.hasTilingEffects||null!=s._symbolizerParams||s._updateSymbolizerParams();const v=s._tileInfoView.getTileCoords(Ve,i.key),S=s._tileInfoView.getTileResolution(i.key);yield s.subview.updateTileSource(i,{source:a,symbolizerParams:s._symbolizerParams,globalSymbolizerParams:s._globalSymbolizerParams,suspended:h,bandIds:l,coords:v,resolution:S}),i.once("attach",()=>s.requestUpdate()),s.subview.container.addChild(i)}catch(a){(0,I.D_)(a)||xe.error(a)}s.requestUpdate()}})()}_redrawImage(i){var e=this;return(0,g.Z)(function*(){if(0===e.subview.container.children.length)return;yield e.layer.updateRenderer(),e.hasTilingEffects?yield e._updateGlobalSymbolizerParams(i):(e._updateSymbolizerParams(),e._globalSymbolizerParams=null);const s=e.subview.container.children.map(function(){var a=(0,g.Z)(function*(l){return e.subview.updateTileSymbolizerParameters(l,{local:e._symbolizerParams,global:e._globalSymbolizerParams})});return function(l){return a.apply(this,arguments)}}());yield(0,I.as)(s),e.container.requestRender()})()}_updateGlobalSymbolizerParams(i){var e=this;return(0,g.Z)(function*(){const s={srcResolution:e._srcResolutions[e._previousLOD.level],registryId:e._blockCacheRegistryId,signal:i},a=yield e.layer.fetchPixels(e.view.extent,e.view.width,e.view.height,s);if(!a||!a.pixelBlock)return;const l=e.layer.symbolizer.generateWebGLParameters({pixelBlock:(0,G.qF)(a.pixelBlock,e.layer.bandIds),isGCS:e.view.spatialReference.isGeographic,resolution:{x:e._previousLOD.resolution,y:e._previousLOD.resolution},bandIds:e.layer.bandIds});!e.subview.canUseWebGLForProcessing()&&l&&"stretch"===l.type&&e.layer.renderer&&"raster-stretch"===e.layer.renderer.type&&(l.factor=l.factor.map(h=>255*h),l.outMin=Math.round(255*l.outMin),l.outMax=Math.round(255*l.outMax)),e._globalSymbolizerParams=l})()}_updateSymbolizerParams(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds})}_updateBlockCacheRegistry(i=!1){const{url:e,rasterInfo:s,multidimensionalDefinition:a,raster:l}=this.layer,h=null!=s&&s.multidimensionalInfo?l.getSliceIndex(a):null,v=(0,D.Rq)(e,h);if(v!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,D.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,D.z2)(v,this.layer.raster.rasterInfo),i){const S=this._tileInfoView.getClosestInfoForScale(this.view.scale);(0,D.Vx)(v,this._blockCacheRegistryId,this.view.extent,this.view.resolution,this._srcResolutions[S.level],this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=v}}_canUseMajorityInterpolationOnDataSource(){const{bandCount:i,attributeTable:e,colormap:s,pixelType:a}=this.layer.rasterInfo;return 1===i&&(null!=e||null!=s||"u8"===a||"s8"===a)}};(0,x._)([(0,m.Cb)()],Pe.prototype,"subview",void 0),(0,x._)([(0,m.Cb)()],Pe.prototype,"useWebGLForProcessing",null),(0,x._)([(0,m.Cb)()],Pe.prototype,"useProgressiveUpdate",null),Pe=(0,x._)([(0,U.j)("esri.views.2d.layers.ImageryTileLayerView2D")],Pe);var ze=Pe},70297:(ge,ie,r)=>{r.d(ie,{y:()=>De});var g=r(60046),x=r(76011),$=r(55208),J=r(97467),T=r(9077),f=(r(67474),r(57025),r(33870),r(42442)),m=r(29729),w=r(54792);let N=class extends w.wq{};N=(0,g._)([(0,f.j)("esri.views.layers.support.ClipArea")],N);var ae,U=N;let D=ae=class extends U{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new ae({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};(0,g._)([(0,T.Cb)({type:[Number,String],json:{write:!0}})],D.prototype,"left",void 0),(0,g._)([(0,T.Cb)({type:[Number,String],json:{write:!0}})],D.prototype,"right",void 0),(0,g._)([(0,T.Cb)({type:[Number,String],json:{write:!0}})],D.prototype,"top",void 0),(0,g._)([(0,T.Cb)({type:[Number,String],json:{write:!0}})],D.prototype,"bottom",void 0),(0,g._)([(0,T.Cb)({readOnly:!0})],D.prototype,"version",null),D=ae=(0,g._)([(0,f.j)("esri.views.layers.support.ClipRect")],D);var he,G=D,le=(r(73513),r(40485)),Q=r(52917),be=r(82059),Me=r(70393);const ce={base:le.Z,key:"type",typeMap:{extent:be.Z,polygon:Me.Z}};let de=he=class extends U{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new he({geometry:this.geometry.clone()})}};(0,g._)([(0,T.Cb)({types:ce,json:{read:Q.im,write:!0}})],de.prototype,"geometry",void 0),(0,g._)([(0,T.Cb)({readOnly:!0})],de.prototype,"version",null),de=he=(0,g._)([(0,f.j)("esri.views.layers.support.Geometry")],de);var we=de;let oe=class extends U{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};(0,g._)([(0,T.Cb)({type:[[[Number]]],json:{write:!0}})],oe.prototype,"path",void 0),(0,g._)([(0,T.Cb)({readOnly:!0})],oe.prototype,"version",null),oe=(0,g._)([(0,f.j)("esri.views.layers.support.Path")],oe);const _e=x.Z.ofType({key:"type",base:U,typeMap:{rect:G,path:oe,geometry:we}}),De=Ee=>{let o=class extends Ee{constructor(){super(...arguments),this.clips=new _e,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var c;this.container||(this.container=new m.W),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([(0,J.S1)(this,"suspended",u=>{this.container&&(this.container.visible=!u),this.view&&!u&&this.updateRequested&&this.view.requestUpdate()},!0),(0,J.S1)(this,["layer.opacity","container"],()=>{var u,p;this.container&&(this.container.opacity=null!=(u=null==(p=this.layer)?void 0:p.opacity)?u:1)},!0),(0,J.S1)(this,["layer.blendMode"],u=>{this.container&&(this.container.blendMode=u)},!0),(0,J.S1)(this,["layer.effect"],u=>{this.container&&(this.container.effect=u)},!0),this.clips.on("change",()=>{this.container.clips=this.clips,this.notifyChange("clips")})]),null!=(c=this.view)&&c.whenLayerView?this.view.whenLayerView(this.layer).then(u=>{u!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(c){let u=!0;const p=this.layer,C=p.minScale,y=p.maxScale;if(null!=C&&null!=y){let B=!C,F=!y;!B&&c<=C&&(B=!0),!F&&c>=y&&(F=!0),u=B&&F}return u}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(c){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",c),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(c))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return(0,g._)([(0,T.Cb)({type:_e,set(c){const u=(0,$.Z)(c,this._get("clips"),_e);this._set("clips",u)}})],o.prototype,"clips",void 0),(0,g._)([(0,T.Cb)()],o.prototype,"moving",void 0),(0,g._)([(0,T.Cb)()],o.prototype,"attached",void 0),(0,g._)([(0,T.Cb)()],o.prototype,"container",void 0),(0,g._)([(0,T.Cb)()],o.prototype,"suspended",void 0),(0,g._)([(0,T.Cb)({readOnly:!0})],o.prototype,"updateParameters",void 0),(0,g._)([(0,T.Cb)()],o.prototype,"updateRequested",void 0),(0,g._)([(0,T.Cb)()],o.prototype,"updating",null),(0,g._)([(0,T.Cb)()],o.prototype,"view",void 0),o=(0,g._)([(0,f.j)("esri.views.2d.layers.LayerView2D")],o),o}},59989:(ge,ie,r)=>{r.d(ie,{Z:()=>ae});var g=r(60046),x=r(64859),$=r(77624),J=r(10882),T=r(21511),O=r(33870),I=r(60305),M=r(73763),f=r(9077),N=(r(67474),r(57025),r(42442));let U=class extends((0,J.p)((0,T.I)((0,M.v)($.Z.EventedMixin(x.Z))))){constructor(D){super(D),this.layer=null,this.parent=null}initialize(){this.when().catch(D=>{if("layerview:create-error"!==D.name){const G=this.layer&&this.layer.id||"no id",ne=this.layer&&this.layer.title||"no title";throw O.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${ne}', id: '${G}')`,D),D}})}get fullOpacity(){return(0,I.Pt)(this.get("layer.opacity"),1)*(0,I.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.get("layer.visible")}set visible(D){void 0!==D?this._override("visible",D):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const D=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(D.viewNotReady=!0),this.layer&&this.layer.loaded||(D.layerNotLoaded=!0),this.visible||(D.layerInvisible=!0),D}isUpdating(){return!1}};(0,g._)([(0,f.Cb)()],U.prototype,"fullOpacity",null),(0,g._)([(0,f.Cb)()],U.prototype,"layer",void 0),(0,g._)([(0,f.Cb)()],U.prototype,"parent",void 0),(0,g._)([(0,f.Cb)({readOnly:!0})],U.prototype,"suspended",null),(0,g._)([(0,f.Cb)({readOnly:!0})],U.prototype,"suspendInfo",null),(0,g._)([(0,f.Cb)({readOnly:!0})],U.prototype,"legendEnabled",null),(0,g._)([(0,f.Cb)({type:Boolean,readOnly:!0})],U.prototype,"updating",null),(0,g._)([(0,f.Cb)({readOnly:!0})],U.prototype,"updatingProgress",null),(0,g._)([(0,f.Cb)()],U.prototype,"visible",null),U=(0,g._)([(0,N.j)("esri.views.layers.LayerView")],U);var ae=U},72619:(ge,ie,r)=>{r.d(ie,{y:()=>f});var g=r(60046),x=r(33870),$=r(12523),J=r(97467),T=r(9077),M=(r(67474),r(57025),r(42442));const f=m=>{let w=class extends m{initialize(){this.handles.add((0,J.on)(this,"layer","refresh",()=>{this.doRefresh().catch(N=>{(0,$.D_)(N)||x.Z.getLogger(this.declaredClass).error(N)})}),"RefreshableLayerView")}};return(0,g._)([(0,T.Cb)()],w.prototype,"layer",void 0),w=(0,g._)([(0,M.j)("esri.layers.mixins.RefreshableLayerView")],w),w}},72501:(ge,ie,r)=>{r.d(ie,{V:()=>O,e:()=>J});var g=r(61921),x=r(60305),$=r(76009);function J(I){return T.apply(this,arguments)}function T(){return(T=(0,g.Z)(function*(I,M=I.popupTemplate){if(!(0,x.pC)(M))return[];const f=yield M.getRequiredFields(I.fieldsIndex),{lastEditInfoEnabled:m}=M,{objectIdField:w,typeIdField:N,globalIdField:U,relationships:ae}=I;if(f.includes("*"))return["*"];const D=m?yield(0,$.CH)(I):[],G=(0,$.Q0)(I.fieldsIndex,[...f,...D]);return N&&G.push(N),G&&w&&I.fieldsIndex.has(w)&&-1===G.indexOf(w)&&G.push(w),G&&U&&I.fieldsIndex.has(U)&&-1===G.indexOf(U)&&G.push(U),ae&&ae.forEach(ne=>{const{keyField:le}=ne;G&&le&&I.fieldsIndex.has(le)&&-1===G.indexOf(le)&&G.push(le)}),G})).apply(this,arguments)}function O(I,M){return I.popupTemplate?I.popupTemplate:(0,x.pC)(M)&&M.defaultPopupTemplateEnabled&&(0,x.pC)(I.defaultPopupTemplate)?I.defaultPopupTemplate:null}},16204:(ge,ie,r)=>{r.d(ie,{K:()=>T}),r(73513);var x=r(60305),$=r(4820),J=r(82059);function T(M,f,m,w=new J.Z){let N;if("2d"===m.type)N=f*m.resolution;else if("3d"===m.type){const le=m.overlayPixelSizeInMapUnits(M),Q=m.basemapSpatialReference;N=(0,x.pC)(Q)&&!Q.equals(m.spatialReference)?(0,$.c9)(Q)/(0,$.c9)(m.spatialReference):f*le}const U=M.x-N,ae=M.y-N,D=M.x+N,G=M.y+N,{spatialReference:ne}=m;return w.xmin=Math.min(U,D),w.ymin=Math.min(ae,G),w.xmax=Math.max(U,D),w.ymax=Math.max(ae,G),w.spatialReference=ne,w}new J.Z}}]);