"use strict";var Xe=Object.defineProperty,ke=Object.defineProperties,He=Object.getOwnPropertyDescriptors,We=Object.getOwnPropertySymbols,Ne=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable,Te=Math.pow,Ee=(Lt,ht,d)=>ht in Lt?Xe(Lt,ht,{enumerable:!0,configurable:!0,writable:!0,value:d}):Lt[ht]=d,ne=(Lt,ht)=>{for(var d in ht||(ht={}))Ne.call(ht,d)&&Ee(Lt,d,ht[d]);if(We)for(var d of We(ht))Ye.call(ht,d)&&Ee(Lt,d,ht[d]);return Lt},oe=(Lt,ht)=>ke(Lt,He(ht));(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[105],{34119:(Lt,ht,d)=>{d.d(ht,{B:()=>mt});var j=d(61921),st=(d(90789),d(47475)),z=d(38963),X=d(21194);const R={marker:z.LW.MARKER,fill:z.LW.FILL,line:z.LW.LINE,text:z.LW.TEXT};class P{constructor(x,l,M,w){const J={minScale:null==l?void 0:l.minScale,maxScale:null==l?void 0:l.maxScale},A=(m=J).minScale||m.maxScale?m.minScale+"-"+m.maxScale:"";var m;this.layers=x,this.data=l,this.hash=this._createHash()+A,this.rendererKey=M;for(const I of x)I.materialKey=(0,X.jj)(R[I.type],this.rendererKey,!1,!1),I.maxVVSize=w,I.scaleInfo=J,I.templateHash+=A}get type(){return"expanded-cim"}_createHash(){let x="";for(const l of this.layers)x+=l.templateHash;return x}}var B=d(96779);const K=function(){var m=(0,j.Z)(function*(x,l){return new P(yield(0,st.c)(x.data,l),x.data,x.rendererKey,x.maxVVSize)});return function(l,M){return m.apply(this,arguments)}}(),mt=function(){var m=(0,j.Z)(function*(x,l,M){if(!x)return null;if("cim"===x.type)return K(x,l);if("web-style"===x.type){const w=B.Z.fromJSON(x),J={type:"cim",data:(yield w.fetchCIMSymbol(M)).data,rendererKey:x.rendererKey,maxVVSize:x.maxVVSize};return K(J,l)}return x});return function(l,M,w){return m.apply(this,arguments)}}()},61602:(Lt,ht,d)=>{d.d(ht,{i:()=>st});var j=d(24570),ot=d(60196);class st{static getPlacement(X,R,P){const Y=(0,ot.W)(R);if(!Y)return null;const B=(0,j.GP)(X);return Y.execute(B,R,P)}}},15049:(Lt,ht,d)=>{d.d(ht,{_:()=>Tt}),d(40595),d(54231);var st=d(6525),R=(d(71079),d(59868),d(99155)),P=d(38963),Y=d(20547);const B=new Map;B.set(P.LW.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),B.set(P.LW.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),B.set(P.LW.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),B.set(P.LW.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),B.set(P.LW.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});var mt=d(19839);class m{constructor(W,N,Q){this._start={index:0,vertex:0};const b=function(yt,W,N){const{indicesPerRecord:Q,multiplier:b,verticesPerRecord:it}=B.get(yt);return{recordBytes:N*R.XJ*Uint32Array.BYTES_PER_ELEMENT,indexBytes:b*Q*N*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:b*it*N*W}}(W,N,Q),it=N/4;this.geometryType=W,this._records=new mt.Z(Int32Array,b.recordBytes),this._indices=new mt.Z(Uint32Array,b.indexBytes),this._vertices=new mt.Z(Uint32Array,b.vertexBytes),this._metrics=new mt.Z(Float32Array,0),this._strideInt=it}serialize(W){const N=this._records.buffer(),Q=this._indices.buffer(),b=this._vertices.buffer(),it=this._metrics.length?this._metrics.buffer():null,Wt=4*this._strideInt;return W.push(N,Q,b),{stride:Wt,records:N,indices:Q,vertices:b,metrics:it}}get strideInt(){return this._strideInt}get recordCount(){return this._records.length/R.XJ}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(W){this._vertices.ensureSize(W)}indexEnsureSize(W){this._indices.ensureSize(W)}recordStart(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}recordEnd(W,N,Q,b,it,Wt,Et,pt){this._records.push(W),this._records.push(N),this._records.push(Q),this._records.push(b),this._records.push(it),this._records.push(Wt),this._records.push(Et),this._records.writeF32(pt)}writeIndex(W){this._indices.push(W)}writeVertex(W){this._vertices.push(W)}writeVertexF32(W){this._vertices.writeF32(W)}copyLastFrom(W,N,Q){const b=W._records.length-R.XJ,it=W._records.getValue(b),Wt=W._records.getValue(b+1),Et=W._records.getValue(b+2),pt=W._records.getValue(b+4),ct=W._records.getValue(b+6),It=W._records.getValue(b+7),wt=this._vertices.length,Bt=(W._start.vertex-this._vertices.length)/this._strideInt,Xt=this._indices.length,Kt=this.vertexCount;for(let Dt=W._start.index;Dt!==W._indices.length;Dt++){const kt=W._indices.getValue(Dt);this._indices.push(kt-Bt)}for(let Dt=W._start.vertex;Dt!==W._vertices.length;Dt++){const kt=W._vertices.getValue(Dt);this._vertices.push(kt)}for(let Dt=wt;Dt<=this._vertices.length;Dt+=this._strideInt)this._vertices.i1616Add(Dt,N,Q);this._records.push(it),this._records.push(Wt),this._records.push(Et),this._records.push(Xt),this._records.push(pt),this._records.push(Kt),this._records.push(ct),this._records.push(It)}}var x=d(59802),l=d(5082);function k(yt){switch(yt){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case 128:return 1}}function H(yt){switch(yt){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}class Tt{constructor(W,N,Q,b,it){this._hasDotDensity=!1,this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=N,this.tileKey=W,this._hasDotDensity=Q,this._hasAggregate=b,this._pixelBufferEnabled=it}get hasAggregates(){return this._hasAggregate}get hasPixelBufferEnabled(){return this._pixelBufferEnabled}serialize(W){const N=[];return N.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach((Q,b)=>{const it=1<<b,Wt=k(it),Et=H(it),pt=(0,l.M)(new st.Z(this.tileKey),Wt,Et,W),ct=this._serializeTileVertexData(this.tileKey,pt.id,Q.vertexData);ct.message.bufferIds=Q.displayIds,N.push(ct)}),N}_serializeTileVertexData(W,N,Q){var b,it,Wt,Et,pt;const ct=new Array;return{message:{tileKeyOrigin:W,tileKey:N,data:{[P.LW.MARKER]:null==(b=Q.get(P.LW.MARKER))?void 0:b.serialize(ct),[P.LW.FILL]:null==(it=Q.get(P.LW.FILL))?void 0:it.serialize(ct),[P.LW.LINE]:null==(Wt=Q.get(P.LW.LINE))?void 0:Wt.serialize(ct),[P.LW.TEXT]:null==(Et=Q.get(P.LW.TEXT))?void 0:Et.serialize(ct),[P.LW.LABEL]:null==(pt=Q.get(P.LW.LABEL))?void 0:pt.serialize(ct)}},transferList:ct}}featureStart(W,N){this._current.insertAfter=W,this._current.sortKey=N}featureEnd(){}recordStart(W,N,Q,b,it){this._current.writer=this._getVertexWriter(Q,b),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=it,this._current.id=W,this._current.materialKey=N,this._current.geometryType=Q,this._current.isDotDensity=!1,this._current.writer.recordStart()}recordCount(){return this._current.writer.recordCount}vertexCount(){return this._current.writer.vertexCount}indexCount(){return this._current.writer.indexCount}vertexEnsureSize(W){this._current.writer.vertexEnsureSize(W)}indexEnsureSize(W){this._current.writer.indexEnsureSize(W)}vertexBounds(W,N,Q,b){this._current.bufferingEnabled&&this._addOverlap(W,N,Q,b)}vertexWrite(W){this._current.writer.writeVertex(W)}vertexWriteF32(W){this._current.writer.writeVertexF32(W)}vertexEnd(){}vertexWriter(){return this._current.writer.vertexWriter}indexWrite(W){this._current.writer.writeIndex(W)}indexWriter(){return this._current.writer.indexWriter}metricWriter(){return this._current.writer.metricWriter}metricStart(W,N,Q,b,it,Wt,Et,pt){this._current.writer=this._getVertexWriter(P.LW.LABEL,!1);const ct=this._current.writer.metricWriter;ct.push((0,x.jL)(W)),ct.push(N),ct.push(Q),ct.push(b),ct.push(it),ct.push(Wt),ct.push(Et),ct.push(pt),ct.push(255),this._current.metricBoxLenPointer=ct.push(0)}metricEnd(){const W=this._current.writer.metricWriter;0===W.getValue(this._current.metricBoxLenPointer)&&W.seek(W.length-10)}metricBoxWrite(W,N,Q,b){const it=this._current.writer.metricWriter;it.incr(this._current.metricBoxLenPointer),it.push(0),it.push(0),it.push(W),it.push(N),it.push(Q),it.push(b)}recordEnd(){const W=this._current.indexStart,N=this._current.writer.indexCount;if(W===N)return!1;this.hasRecords=!0;const b=this._current.vertStart;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,W,N-W,b,this._current.writer.vertexCount-b,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===P.LW.LABEL)return!0;const Wt=this._current.writer;for(let Et=0;Et<8;Et++){const pt=1<<Et;if(this._current.overlaps&pt){this._data.neighbors[Et]||(this._data.neighbors[Et]={vertexData:new Map,displayIds:new Set});const ct=this._data.neighbors[Et],It=this._current.geometryType;if(!ct.vertexData.has(It)){const Dt=(0,Y.$_)(It,this._current.isDotDensity).geometry,kt=new m(It,Dt,R.Ip);ct.vertexData.set(It,kt)}const wt=ct.vertexData.get(this._current.geometryType),Bt=8,Xt=512*-k(pt)*Bt,Kt=512*-H(pt)*Bt;wt.copyLastFrom(Wt,Xt,Kt),ct.displayIds.add(this._current.id)}}return!0}_addOverlap(W,N,Q,b){this._current.overlaps|=255^((W<0+Q?148:W>=R.I_-Q?41:189)|(N<0+b?224:N>=R.I_-b?7:231))}_getVertexWriter(W,N){if(!this._data.self.has(W)){const Q=this._data.self,b=(0,Y.$_)(W,this._hasDotDensity).geometry;Q.set(W,new m(W,b,this.hint.records))}return this._data.self.get(W)}}},89213:(Lt,ht,d)=>{d.d(ht,{j:()=>kt});var j=d(61921),st=(d(67474),d(60305)),z=d(12523),X=d(44295),R=d(22795),P=d(33870),Y=d(22791),B=d(12788),at=d(75335),K=d(22806),mt=d(99155),m=d(38963),x=d(1452),l=d(21194),M=d(43281),w=d(78380);function A(V){return V.length-1}function y(V,c,p=1){const[g,v]=function(V,c){return V[c+1]}(V,c);return Math.sqrt(g*g+v*v)*p}class L{constructor(c,p,g,v,F){this._segments=c,this._index=p,this._distance=g,this._xStart=v,this._yStart=F,this._done=!1}static create(c){return new L(c,0,0,c[0][0],c[0][1])}clone(){return new L(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(c){return this._index===c._index||c._index===this._index-1&&(0===this._distance||1===c._distance)||c._index===this._index+1&&(1===this._distance||0===c._distance)}leq(c){return this._index<c._index||this._index===c._index&&this._distance<=c._distance}geq(c){return this._index>c._index||this._index===c._index&&this._distance>=c._distance}get _segment(){return this._segments[this._index+1]}get angle(){const c=this.dy;let g=Math.acos((0*c+-1*-this.dx)/(1*this.length));return c>0&&(g=2*Math.PI-g),g}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:c,dy:p}=this;return Math.sqrt(c*c+p*p)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<A(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(c,p){const g=this.backwardLength;if(c<=g)return this._distance=(g-c)/this.length,this;let v=this.backwardLength;for(;this.prev();){if(v+this.length>c)return this._seekBackwards(c-v);v+=this.length}return this._distance=0,p?this:null}seek(c,p=!1){if(c<0)return this._seekBackwards(Math.abs(c),p);if(c<=this.remainingLength)return this._distance=(this.backwardLength+c)/this.length,this;let g=this.remainingLength;for(;this.next();){if(g+this.length>c)return this.seek(c-g,p);g+=this.length}return this._distance=1,p?this:null}}function U(V,c,p){const g=function(V){let c=0;for(let p=0;p<A(V);p++)c+=y(V,p);return c}(V),v=L.create(V),F=g/2,Z=Math.floor((g-c)/2/c);v.seek(F-Z*c);for(let dt=-Z;dt<=Z;dt++)v.x<512&&v.x>=0&&v.y<512&&v.y>=0&&p(v.clone(),dt,F+dt*c,g),v.seek(c)}function lt(V,c){const p=1e-6;if(c<=0)return;const g=V.length;if(g<3)return;const v=[];let F=0;v.push(0);for(let nt=1;nt<g;nt++)F+=(0,w.TK)(V[nt],V[nt-1]),v.push(F);c=Math.min(c,.2*F);const C=[];C.push(V[0][0]),C.push(V[0][1]);const Z=V[g-1][0],ut=V[g-1][1],dt=(0,w.lu)([0,0],V[0],V[1]);(0,w.Fv)(dt),V[0][0]+=c*dt[0],V[0][1]+=c*dt[1],(0,w.lu)(dt,V[g-1],V[g-2]),(0,w.Fv)(dt),V[g-1][0]+=c*dt[0],V[g-1][1]+=c*dt[1];for(let nt=1;nt<g;nt++)v[nt]+=c;v[g-1]+=c;const $=.5*c;for(let nt=1;nt<g-1;nt++){let vt=0,Ut=0,jt=0;for(let xt=nt-1;xt>=0&&!(v[xt+1]<v[nt]-$);xt--){const St=$+v[xt+1]-v[nt],Ct=v[xt+1]-v[xt],Pt=v[nt]-v[xt]<$?1:St/Ct;if(Math.abs(Pt)<p)break;const Ft=Pt*Pt,Ot=Pt*St-.5*Ft*Ct,Gt=Pt*Ct/c,zt=V[xt+1],bt=V[xt][0]-zt[0],Vt=V[xt][1]-zt[1];vt+=Gt/Ot*(zt[0]*Pt*St+.5*Ft*(St*bt-Ct*zt[0])-Ft*Pt*Ct*bt/3),Ut+=Gt/Ot*(zt[1]*Pt*St+.5*Ft*(St*Vt-Ct*zt[1])-Ft*Pt*Ct*Vt/3),jt+=Gt}for(let xt=nt+1;xt<g&&!(v[xt-1]>v[nt]+$);xt++){const St=$-v[xt-1]+v[nt],Ct=v[xt]-v[xt-1],Pt=v[xt]-v[nt]<$?1:St/Ct;if(Math.abs(Pt)<p)break;const Ft=Pt*Pt,Ot=Pt*St-.5*Ft*Ct,Gt=Pt*Ct/c,zt=V[xt-1],bt=V[xt][0]-zt[0],Vt=V[xt][1]-zt[1];vt+=Gt/Ot*(zt[0]*Pt*St+.5*Ft*(St*bt-Ct*zt[0])-Ft*Pt*Ct*bt/3),Ut+=Gt/Ot*(zt[1]*Pt*St+.5*Ft*(St*Vt-Ct*zt[1])-Ft*Pt*Ct*Vt/3),jt+=Gt}C.push(vt/jt),C.push(Ut/jt)}C.push(Z),C.push(ut);for(let nt=0,vt=0;nt<g;nt++)V[nt][0]=C[vt++],V[nt][1]=C[vt++]}var ft=d(41814);const Mt=P.Z.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),pt=function(V){const c=new Map;return p=>(c.has(p)||c.set(p,(V=>{let c=0;if(0===V)return 1/0;for(;!(V%2);)c++,V/=2;return c})(p)),c.get(p))}(),ct=V=>Math.floor(127*V+127),It=V=>Math.floor(10*V),wt=V=>Math.round(V*(254/360));class Bt extends ft.Z{constructor(c,p,g,v){super(c,g.font.size,g.haloSize||0,g.color&&(0,K.aH)(g.color)||0,g.haloColor&&(0,K.aH)(g.haloColor)||0,g.horizontalAlignment,g.verticalAlignment,(0,M.N)(p.labelPlacement)?1:0,g.font.decoration,!1,g.angle||0,g.xoffset,g.yoffset,g.lineWidth,g.lineHeight,null,null,null,null,null),this._outLineLabelAngle=0,this._refPlacementPadding=0,this._refPlacementDirX=0,this._refPlacementDirY=0,this._refOffsetX=0,this._refOffsetY=0,this._zoomLevel=0,this.geometryType=m.LW.LABEL;const F=function(V,c){const p=!!V.minScale&&c.scaleToZoom(V.minScale)||0;return(0,Y.uZ)(p,0,25.5)}(p,v),C=function(V,c){const p=!!V.maxScale&&c.scaleToZoom(V.maxScale)||255;return(0,Y.uZ)(p,0,25.5)}(p,v),Z=p.labelPlacement,[ut,dt]=(0,at.qv)(Z);this._xAlignD=ut,this._yAlignD=dt,this._minZoom=F,this._maxZoom=C,this._refPlacementPadding=(0,B.F2)(g.haloSize)+mt.Iw;const $=l.Gq.load(c);$.sdf=!0,this._materialKey=$.data}static fromLabelClass(c,p){if("esriServerLinePlacementCenterAlong"===c.labelPlacement){const g=c.symbol;g.xoffset=0,g.yoffset=0,g.angle=0,g.font.decoration="none"}return new Bt(c.materialKey,c,c.symbol,p)}get _shapedBox(){return(0,st.Wg)(this._shapingInfo).bounds}setZoomLevel(c){this._zoomLevel=c}bindReferenceTemplate(c){let p=(0,at.g)(this._xAlignD),g=(0,at.tf)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,(0,st.Wi)(c))return void(this._refSymbolAndPlacementOffset=(0,x.Jz)(0,0,ct(p),ct(g)));if("circle"===c.boundsType&&(p||g)){const C=Math.sqrt(p*p+g*g);p/=C,g/=C}const v=Math.max(c.height,c.width);this._refSymbolAndPlacementOffset=(0,x.Jz)(4*this._refPlacementPadding,v,ct(p),ct(g)),this._referenceSize=v,this._refPlacementDirX=p,this._refPlacementDirY=g,this._refOffsetX=c.xOffset,this._refOffsetY=c.yOffset}_write(c,p){if((0,st.Wi)(this._shapingInfo))return;const g=this._shapingInfo,v=p.getDisplayId(),F="esriGeometryPolygon"===p.geometryType?p.readLegacyCentroid():p.readLegacyGeometry();if(F)switch(this.current={out:c,inId:v,inShaping:g,zoomLevel:this._zoomLevel},p.geometryType){case"esriGeometryPolyline":this._placeLineLabels(F);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(F);break;default:((V,c="mapview-labeling")=>{Mt.error(new R.Z(c,"mapview-labeling"))})(0,`Geometry of type ${p.geometryType} is not supported`)}}_isVisible(c,p){const g=It(this.current.zoomLevel);return It(c)<=g&&g<=It(p)}_placePointLabels(c){const{out:p,inId:g,inShaping:v}=this.current;this._writeGlyphs(p,g,c,v)}_placeLineLabels(c){const p=function(V,c){const p=c;for(let g=0;g<V.length;g++){let v=V[g];const F=[];F.push(v[0]);for(let Z=1;Z<v.length;Z++){let[ut,dt]=F[Z-1];ut+=v[Z][0],dt+=v[Z][1],F.push([ut,dt])}lt(F,p);const C=[];C.push(F[0]);for(let Z=1;Z<F.length;Z++){const[ut,dt]=F[Z-1],[$,nt]=F[Z],vt=Math.round($-ut),Ut=Math.round(nt-dt);C.push([vt,Ut])}V[g]=C,v=C}return V}(c.paths,this.current.inShaping.bounds.width),g=this._placeSubdivGlyphs.bind(this),v=(this._shapedBox.width+128)/2;for(const F of p)U(F,v,g)}_placeSubdivGlyphs(c,p,g,v){const F=pt(p),C=this._shapedBox.width/2,ut=Math.min(g,v-g),dt=(0,Y.k3)(ut/(8+C/2)),$=0===p?dt:Math.min(F,dt),nt=Math.max(this._minZoom,this.current.zoomLevel+1-$),Ut=this._shapedBox.width/2*Te(2,this.current.zoomLevel-nt);this.current.inShaping.isMultiline?0===p&&this._placeStraight(c,nt):this._placeCurved(c,nt,Ut)}_placeStraight(c,p){const{out:g,inId:v,inShaping:F}=this.current;this._writeGlyphs(g,v,c,F,p)}_placeCurved(c,p,g){const{out:v,inId:F}=this.current;v.metricStart(F,p,c.x,c.y,0,0,0,0);const C=c.clone(),Z=c.angle*(180/Math.PI)%360,ut=(c.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=wt(Z),this._placeFirst(C,p,1),this._placeBack(c,C,p,g,1),this._placeForward(c,C,p,g,1),this._outLineLabelAngle=wt(ut),this._placeFirst(C,p,0),this._placeBack(c,C,p,g,0),this._placeForward(c,C,p,g,0),v.metricEnd()}_placeBack(c,p,g,v,F){const C=c.clone();let Z=c.backwardLength+0;for(;C.prev()&&!(Z>=v);)this._placeOnSegment(C,p,Z,g,-1,F),Z+=C.length+0}_placeForward(c,p,g,v,F){const C=c.clone();let Z=c.remainingLength+0;for(;C.next()&&!(Z>=v);)this._placeOnSegment(C,p,Z,g,1,F),Z+=C.length+0}_placeFirst(c,p,g){const v=c,F=this.current.inShaping,C=F.glyphs,Z=this.current.zoomLevel,{out:ut,inId:dt}=this.current;for(const $ of C){const nt=$.x>F.bounds.x?g:1-g,vt=nt*c.remainingLength+(1-nt)*c.backwardLength,Ut=Math.abs($.x+$.width/2-F.bounds.x),jt=Math.max(0,Z+(0,Y.k3)(Ut/(vt+0))),xt=Math.max(p,jt);if($.maxZoom=25,$.angle=c.angle+(1-g)*Math.PI,$.minZoom=xt,this._writeGlyph(ut,dt,v.x,v.y,$),g&&this._isVisible($.minZoom,$.maxZoom)){const St=$.bounds;ut.metricBoxWrite(St.center[0],St.center[1],St.width,St.height)}}}_placeOnSegment(c,p,g,v,F,C){const Z=this.current.inShaping.glyphs,{out:ut,inId:dt}=this.current,$=this.current.inShaping,nt=this.current.zoomLevel,jt={x:c.x+g*-F*(c.dx/c.length),y:c.y+g*-F*(c.dy/c.length)};for(const xt of Z){const St=xt.x>$.bounds.x?C:1-C;if(!(St&&1===F||!St&&-1===F))continue;const Ct=Math.abs(xt.x+xt.width/2-$.bounds.x),Pt=Math.max(0,nt+(0,Y.k3)(Ct/g)-.1),Ft=Math.max(v,nt+(0,Y.k3)(Ct/(g+c.length+0)));if(0!==Pt&&(xt.angle=c.angle+(1-C)*Math.PI,xt.minZoom=Ft,xt.maxZoom=Pt,this._writeGlyph(ut,dt,jt.x,jt.y,xt),C&&this._isVisible(xt.minZoom,xt.maxZoom))){const Ot=xt.bounds;ut.metricBoxWrite(Ot.center[0]+(c.x-p.x),Ot.center[1]+(c.y-p.y),Ot.width,Ot.height)}}}_writeGlyphs(c,p,g,v,F=this._minZoom){if(g.x<0||g.x>=512||g.y<0||g.y>=512)return;const C=g.x+this._refOffsetX,Z=g.y-this._refOffsetY;for(const nt of v.glyphs)nt.minZoom=F,nt.maxZoom=this._maxZoom,this._writeGlyph(c,p,C,Z,nt);const $=v.boundsT;c.metricStart(p,F,C,Z,this._refPlacementDirX,this._refPlacementDirY,this._referenceSize,this._materialKey),c.metricBoxWrite($.center[0],$.center[1],$.width,$.height),c.metricEnd()}_writeVertexCommon(c,p,g,v){const F=this._color,C=this._haloColor,Z=(0,x.Jz)(0,0,this._size,this._haloSize),ut=Math.max(v.minZoom,this._minZoom),dt=Math.min(v.maxZoom,this._maxZoom),$=(0,x.Jz)(It(ut),It(dt),this._outLineLabelAngle,0);c.vertexWrite(g),c.vertexWrite(p),c.vertexWrite(F),c.vertexWrite(C),c.vertexWrite(Z),c.vertexWrite(this._refSymbolAndPlacementOffset),c.vertexWrite($)}}var Xt=d(79862),Kt=d(89883),Dt=d(59802);class kt{constructor(c,p,g){this._loadPromise=(0,X.j)(),this._geometryType=c,this._idField=p,this._templateStore=g}update(c,p){(0,st.pC)(c.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(c.mesh.labels,p)),this._schema=c}_createLabelTemplates(c,p){const g=new Map;if("simple"===c.type){for(const v of c.classes){const F=Bt.fromLabelClass(v,p);g.set(v.index,F)}return g}for(const v in c.classes){const F=c.classes[v];for(const C of F){const Z=Bt.fromLabelClass(C,p);g.set(C.index,Z)}}return g}get templates(){return this._templateStore}analyze(c,p,g,v,F,C){var Z=this;return(0,j.Z)(function*(){if((0,z.Hc)(C))return;let ut;"dictionary"===p.type&&(ut=yield p.analyze(Z._idField,c.copy(),v,F,C));let dt=0;for(;c.next();){let $;if($=ut?ut[dt++]:(0,st.pC)(g)&&(0,Dt.nE)(c.getDisplayId())&&1!==c.readAttribute("cluster_count")?g.match(Z._idField,c,Z._geometryType,v,F):p.match(Z._idField,c,Z._geometryType,v,F),c.setGroupId($),(0,Kt.S)($)){const nt=Z._templateStore.getDynamicTemplateGroup($);for(const vt of nt)vt&&vt.analyze&&vt.analyze(Z._templateStore,c,v,F)}}return yield Z._loadPromise,Z._templateStore.finalize(C)})()}analyzeGraphics(c,p,g,v,F){var C=this;return(0,j.Z)(function*(){if((0,z.Hc)(F))return;const Z=c.getCursor();for(p&&(yield p.analyze(C._idField,Z.copy(),g,v,F));Z.next();){let ut=Z.getGroupId();if(null!=ut&&-1!==ut||(ut=p.match(C._idField,Z,Z.geometryType,g,v),Z.setGroupId(ut)),(0,Kt.S)(ut)){const dt=C._templateStore.getDynamicTemplateGroup(ut);for(const $ of dt)$&&$.analyze&&$.analyze(C._templateStore,Z,g,v)}Z.setGroupId(ut)}return yield C._loadPromise,C._templateStore.finalize(F)})()}writeGraphic(c,p,g){const v=p.getGroupId(),F=p.getDisplayId(),C=this._templateStore.getTemplateGroup(v);if(c.featureStart(p.insertAfter,0),null!=F){if((0,Kt.S)(v))for(const Z of C)Z.bindFeature(p,null,null);if(C){for(const Z of C)Z&&Z.write(c,p,g);c.featureEnd()}}}writeCursor(c,p,g,v,F,C){const Z=p.getGroupId(),ut=p.getDisplayId(),dt=this._templateStore.getTemplateGroup(Z),$=this._schema.mesh.sortKey;let nt=0;if((0,st.pC)($)&&(nt=null!=$.fieldIndex?p.getComputedNumericAtIndex($.fieldIndex):p.readAttribute(null!=$.field?$.field:this._idField),nt*="asc"===$.order?1:-1),c.featureStart(0,null==nt||isNaN(nt)?0:nt),null!=ut&&dt){if((0,Kt.S)(Z))for(const vt of dt)vt.bindFeature(p,g,v);for(const vt of dt)vt.write(c,p,F);if((0,st.pC)(C)&&c.hasRecords){const vt=C&&this._findLabelRef(dt);this._writeLabels(c,p,C,vt,F)}c.featureEnd()}}_findLabelRef(c){for(const p of c)if(p instanceof Xt.Z)return p;return null}_writeLabels(c,p,g,v,F){for(const C of g)if((0,st.pC)(C)&&C){const{glyphs:Z,rtl:ut,index:dt}=C,$=this._labelTemplates.get(dt);$.setZoomLevel(F),$.bindReferenceTemplate(v),$.bindTextInfo(Z,ut),$.write(c,p,null)}}}},28149:(Lt,ht,d)=>{d.d(ht,{Z:()=>m});var j=d(60305),ot=d(12788),st=d(97209),z=d(62764),X=d(87492),R=d(3878),P=d(90097),Y=d(61602),B=d(38963),at=d(1452);const K=3.14159265359/180,m=x=>class extends x{constructor(...l){super(...l),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType="square",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this._vertexBoundsScaleX=1,this._vertexBoundsScaleY=1,this._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},this.geometryType=B.LW.MARKER}_write(l,M,w){const J=M.getDisplayId();l.recordStart(J,this._materialKey,this.geometryType,!1,!0),this._writeGeometry(l,M,J,w),l.recordEnd()}_writeGeometry(l,M,w,J){if((0,j.pC)(this._markerPlacement))return this._writePlacedMarkers(l,M,J);const A=J?(0,P.oB)((0,P.GH)(J),2):"esriGeometryPolygon"===M.geometryType?M.readCentroid():M.readGeometryForDisplay();if(!(0,j.Wi)(A)){if(A.isPoint){const[I,y]=A.coords;return!l.hasAggregates&&l.hasPixelBufferEnabled&&(I<-1||I>=513||y<-1||y>=513)?void 0:this._writeVertices(l,w,this._getPos(I,y),I,y)}A.forEachVertex((I,y)=>this._writeVertices(l,w,this._getPos(I,y),I,y))}}_writePlacedMarkers(l,M,w){const J=null!=w?w:M.readLegacyGeometryForDisplay(),A=Y.i.getPlacement(J,(0,j.Wg)(this._markerPlacement),(0,ot.F2)(1));if(!A)return;const I=M.getDisplayId(),y=(0,R.c)(),L=(0,z.c)();let H=A.next();for(;null!=H;){const{tx:q,ty:lt}=H;q>=-128&&q<=640&&lt>=-128&&lt<=640&&(this._applyTransformation(L,y,H.getAngle()/K),this._writeVertices(l,I,this._getPos(q,lt),q,lt)),H=A.next()}}_writeVertices(l,M,w,J,A){const I=l.vertexCount();l.vertexBounds(J+this.xOffset,A-this.yOffset,this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY),l.vertexWrite(w),l.vertexWrite(this._offsetUpperLeft),l.vertexWrite(this._texUpperLeft),l.vertexWrite(this._bitestAndDistRatio),l.vertexWrite(M),l.vertexWrite(this._fillColor),l.vertexWrite(this._outlineColor),l.vertexWrite(this._sizeOutlineWidth),l.vertexWrite(this._minMaxZoom),l.vertexEnd(),l.vertexWrite(w),l.vertexWrite(this._offsetUpperRight),l.vertexWrite(this._texUpperRight),l.vertexWrite(this._bitestAndDistRatio),l.vertexWrite(M),l.vertexWrite(this._fillColor),l.vertexWrite(this._outlineColor),l.vertexWrite(this._sizeOutlineWidth),l.vertexWrite(this._minMaxZoom),l.vertexEnd(),l.vertexWrite(w),l.vertexWrite(this._offsetBottomLeft),l.vertexWrite(this._texBottomLeft),l.vertexWrite(this._bitestAndDistRatio),l.vertexWrite(M),l.vertexWrite(this._fillColor),l.vertexWrite(this._outlineColor),l.vertexWrite(this._sizeOutlineWidth),l.vertexWrite(this._minMaxZoom),l.vertexEnd(),l.vertexWrite(w),l.vertexWrite(this._offsetBottomRight),l.vertexWrite(this._texBottomRight),l.vertexWrite(this._bitestAndDistRatio),l.vertexWrite(M),l.vertexWrite(this._fillColor),l.vertexWrite(this._outlineColor),l.vertexWrite(this._sizeOutlineWidth),l.vertexWrite(this._minMaxZoom),l.vertexEnd(),l.indexWrite(I+0),l.indexWrite(I+1),l.indexWrite(I+2),l.indexWrite(I+1),l.indexWrite(I+3),l.indexWrite(I+2)}_applyTransformation(l,M,w=0){(0,st.i)(l),(0,st.t)(l,l,(0,R.f)(this.xOffset,-this.yOffset)),this.angle+w!==0&&(0,st.r)(l,l,K*(this.angle+w));const J=this._computedWidth,A=this._computedHeight,I=(this._anchorX-.5)*J,y=(this._anchorY-.5)*A;(0,X.s)(M,I,y),(0,X.t)(M,M,l),this._offsetUpperLeft=(0,at.UJ)(16*M[0],16*M[1]),this._offsets.xUpperLeft=M[0],this._offsets.yUpperLeft=M[1],(0,X.s)(M,I+J,y),(0,X.t)(M,M,l),this._offsetUpperRight=(0,at.UJ)(16*M[0],16*M[1]),this._offsets.xUpperRight=M[0],this._offsets.yUpperRight=M[1],(0,X.s)(M,I,y+A),(0,X.t)(M,M,l),this._offsetBottomLeft=(0,at.UJ)(16*M[0],16*M[1]),this._offsets.xBottomLeft=M[0],this._offsets.yBottomLeft=M[1],(0,X.s)(M,I+J,y+A),(0,X.t)(M,M,l),this._offsetBottomRight=(0,at.UJ)(16*M[0],16*M[1]),this._offsets.xBottomRight=M[0],this._offsets.yBottomRight=M[1]}_getPos(l,M){return(0,at.UJ)(Math.round(8*l),Math.round(8*M))}}},24588:(Lt,ht,d)=>{d.d(ht,{Z:()=>K});var j=d(60305),ot=d(12788),st=d(90097),z=d(61602),X=d(99155),R=d(38963),P=d(1452),Y=d(21194),B=d(45880);const K=mt=>class extends mt{constructor(...m){super(...m),this._isCIM=!1,this._vertexBoundsScale=1,this.geometryType=R.LW.TEXT,this._aux=(0,P.Jz)(0,0,this._referenceSize,this._bitset)}bindTextInfo(m,x){this._shapingInfo=m&&m.length?(0,j.Po)(m,l=>(0,B.Nr)(l,x,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:X.xm*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM})):null}_write(m,x,l){const M=x.getDisplayId();this._writeGeometry(m,x,M,l)}_writeGeometry(m,x,l,M){const w=this._shapingInfo;if((0,j.Wi)(w))return;if((0,j.pC)(this._textPlacement)){const A=null!=M?M:x.readLegacyGeometryForDisplay();return this._writePlacedText(m,l,A,w)}const J=M?(0,st.oB)((0,st.GH)(M),2):"esriGeometryPolygon"===x.geometryType?x.readCentroid():x.readGeometryForDisplay();if(!(0,j.Wi)(J)){if(J.isPoint){const[A,I]=J.coords;return this._writeGlyphs(m,l,{x:A,y:I},w)}J.forEachVertex((A,I)=>this._writeGlyphs(m,l,{x:A,y:I},w))}}_writePlacedText(m,x,l,M){const w=(0,j.Wg)(this._textPlacement),J=z.i.getPlacement(l,w,(0,ot.F2)(1));if(!J)return;let A=J.next();for(;null!=A;){const I=A.getAngle();M.setRotation(I);const y=A.tx,L=A.ty;y<0||y>=512||L<0||L>=512||(this._writeGlyphs(m,x,{x:y,y:L},M),M.setRotation(-I)),A=J.next()}}_writeGlyphs(m,x,l,M){const w=Y.m2.load(this._materialKey),J=(0,P.UJ)(Math.round(8*l.x),Math.round(8*l.y)),A=this._vertexBoundsScale,I=M.bounds,y=2*Math.max(I.width,I.height);for(const L of M.glyphs)w.textureBinding=L.textureBinding,m.recordStart(x,w.data,this.geometryType,!1,!0),m.vertexBounds(l.x+I.x+this._xOffset,l.y+I.y-this._yOffset,y*A,y*A),this._writeVertices(m,x,J,L),m.recordEnd()}_writeGlyph(m,x,l,M,w){const J=Y.m2.load(this._materialKey),A=(0,P.UJ)(Math.round(8*l),Math.round(8*M));J.textureBinding=w.textureBinding,m.recordStart(x,J.data,this.geometryType,!1,!0);const I=w.bounds,y=this._vertexBoundsScale;m.vertexBounds(l+I.x*y,M+I.y*y,I.width*y,I.height*y),this._writeVertices(m,x,A,w),m.recordEnd()}_writeVertices(m,x,l,M){const w=m.vertexCount();this._writeVertexCommon(m,x,l,M),m.vertexWrite(M.offsets.upperLeft),m.vertexWrite(M.texcoords.upperLeft),m.vertexEnd(),this._writeVertexCommon(m,x,l,M),m.vertexWrite(M.offsets.upperRight),m.vertexWrite(M.texcoords.upperRight),m.vertexEnd(),this._writeVertexCommon(m,x,l,M),m.vertexWrite(M.offsets.lowerLeft),m.vertexWrite(M.texcoords.lowerLeft),m.vertexEnd(),this._writeVertexCommon(m,x,l,M),m.vertexWrite(M.offsets.lowerRight),m.vertexWrite(M.texcoords.lowerRight),m.vertexEnd(),m.indexWrite(w+0),m.indexWrite(w+1),m.indexWrite(w+2),m.indexWrite(w+1),m.indexWrite(w+3),m.indexWrite(w+2)}_writeVertexCommon(m,x,l,M){const w=this._color,J=this._haloColor,A=(0,P.Jz)(0,0,this._referenceSize,this._bitset),I=(0,P.Jz)(0,0,this._size,this._haloSize);m.vertexWrite(l),m.vertexWrite(x),m.vertexWrite(w),m.vertexWrite(J),m.vertexWrite(I),m.vertexWrite(A),m.vertexWrite(this._minMaxZoom)}}},79862:(Lt,ht,d)=>{d.d(ht,{Z:()=>mt});var j=d(60305),ot=d(12788),st=d(62764),z=d(3878),X=d(22806),R=d(99155),P=d(1452),Y=d(21194),B=d(78380),at=d(28149),K=d(12867);class mt extends((0,at.Z)(K.Z)){constructor(x,l,M,w,J,A,I,y,L,U,k,H,q,lt,ft,Mt,Tt,yt,W,N,Q,b,it){super(),this.angle=w,this.height=I,this.width=A,this.xOffset=l*W,this.yOffset=M*W,this._markerPlacement=N,this._effects=Q,this._anchorX=.5-(.5+Mt)*ft.width/ft.width,this._anchorY=.5-(.5+Tt)*ft.height/ft.height,this._minMaxZoom=(0,P.UJ)(Math.round(b*R.MI),Math.round(it*R.MI));const Wt=(1===lt?1:0)|(k?1:0)<<1|(q?1:0)<<2|(H?1:0)<<3,Et=ft&&ft.sdf,pt=Y.mE.load(x);pt.sdf=Et,pt.pattern=!0,pt.textureBinding=ft.textureBinding,this._materialKey=pt.data,this._fillColor=J,this._outlineColor=L,this._sizeOutlineWidth=(0,P.Jz)(Math.round(Math.min(Math.sqrt(128*A),255)),Math.round(Math.min(Math.sqrt(128*I),255)),Math.round(Math.min(Math.sqrt(128*U),255)),Math.round(Math.min(Math.sqrt(128*y),255)));const ct=ft.rect.x+R.fL,It=ft.rect.y+R.fL,wt=ct+ft.width,Bt=It+ft.height;this._offsets.xUpperLeft=ct,this._offsets.yUpperLeft=It,this._offsets.xUpperRight=wt,this._offsets.yUpperRight=It,this._offsets.xBottomLeft=ct,this._offsets.yBottomLeft=Bt,this._offsets.xBottomRight=wt,this._offsets.yBottomRight=Bt,this._texUpperLeft=(0,P.UJ)(ct,It),this._texUpperRight=(0,P.UJ)(wt,It),this._texBottomLeft=(0,P.UJ)(ct,Bt),this._texBottomRight=(0,P.UJ)(wt,Bt),A*=yt,I*=yt,A*=W,I*=W;const Xt=Math.round(64*yt);this._bitestAndDistRatio=(0,P.UJ)(Wt,Xt),this._computedWidth=A,this._computedHeight=I;const Kt=(0,z.c)(),Dt=(0,st.c)();this._applyTransformation(Dt,Kt)}static fromCIMMarker(x,l,M){const A=x.size,I=(l&&l.width||1)/(l&&l.height||1)*x.scaleX,y=x.scaleSymbolsProportionally&&x.frameHeight?A/x.frameHeight:1,L=(0,X.t2)(x.color),U=(0,X.t2)(x.outlineColor),k=(0,ot.F2)(A),H=k*I,q=(0,ot.F2)(x.offsetX||0),lt=(0,ot.F2)(x.offsetY||0),ft=(0,ot.F2)(x.outlineWidth||0)*y,Mt=x.alignment||0,Tt=(0,ot.F2)(x.referenceSize),[yt,W]=(0,B._f)(x.scaleInfo,M);let N=x.rotation||0;x.rotateClockwise||(N=-N);let Q=0,b=0;const it=x.anchorPoint;it&&(x.isAbsoluteAnchorPoint?A&&(Q=-it.x/(A*I),b=it.y/A):(Q=it.x,b=it.y));const Wt=new mt(x.materialKey,q,lt,N,L,H,k,Tt,U,ft,x.colorLocked,x.scaleSymbolsProportionally,!1,Mt,l,Q,b,x.sizeRatio,(0,j.Pt)(x.scaleFactor,1),x.markerPlacement,x.effects,yt,W);return Wt._vertexBoundsScaleX=x.maxVVSize?x.maxVVSize/H:1,Wt._vertexBoundsScaleY=x.maxVVSize?x.maxVVSize/k:1,Wt}static fromPictureMarker(x,l){const M=Math.round((0,ot.F2)(x.width)),w=Math.round((0,ot.F2)(x.height)),J=R.ru,A=Math.round((0,ot.F2)(x.xoffset||0)),I=Math.round((0,ot.F2)(x.yoffset||0)),y=new mt(x.materialKey,A,I,x.angle,J,M,w,w,0,0,!1,!1,!1,0,l,0,0,1,1,null,null,B.Xe,B.eW);return y._vertexBoundsScaleX=x.maxVVSize?x.maxVVSize/x.width:1,y._vertexBoundsScaleY=x.maxVVSize?x.maxVVSize/x.height:1,y}static fromSimpleMarker(x,l){const M=(0,X.aH)(x.color),w=Math.round((0,ot.F2)(x.size)),J=w,A=Math.round((0,ot.F2)(x.xoffset||0)),I=Math.round((0,ot.F2)(x.yoffset||0)),y=x.style,L=x.outline,U=0|(L&&L.color&&(0,X.aH)(L.color)),k=0|(L&&L.width&&Math.round((0,ot.F2)(L.width))),H=new mt(x.materialKey,A,I,x.angle,M,w,J,J,U,k,!1,!1,"esriSMSCross"===y||"esriSMSX"===y,0,l,0,0,126/64,1,null,null,B.Xe,B.eW);return H.boundsType="esriSMSCircle"===y?"circle":"square",H._vertexBoundsScaleX=x.maxVVSize?x.maxVVSize/x.size:1,H._vertexBoundsScaleY=x.maxVVSize?x.maxVVSize/x.size:1,H}static fromLineSymbolMarker(x,l){const M=(0,X.aH)(x.color),J=Math.round((0,ot.F2)(6*x.lineWidth)),A=J,I="cross"===x.style||"x"===x.style;let y;switch(x.placement){case"begin-end":y="Both";break;case"begin":y="JustBegin";break;case"end":y="JustEnd";break;default:y="None"}const L={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:y,offsetAlongLine:0},U=new mt(x.materialKey,0,0,0,M,J,A,A/6,M,I?Math.round((0,ot.F2)(x.lineWidth)):0,!1,!1,I,1,l,0,0,126/64,1,L,null,B.Xe,B.eW);return U.boundsType="circle"===x.style?"circle":"square",U}}},12867:(Lt,ht,d)=>{d.d(ht,{Z:()=>P});var j=d(60305),ot=d(24570),st=d(14511),z=d(60196);class R{static executeEffects(B,at){const K=(0,ot.GP)(at);let m=new st.M(K);for(const x of B){const l=(0,z.h)(x);l&&(m=l.execute(m,x,1.3333333333333333))}return m}static next(B){const at=B.next();return(0,ot.wp)(at),at}}class P{bindFeature(B,at,K){}write(B,at,K){if((0,j.Wi)(this._effects))return this._write(B,at);const mt=R.executeEffects(this._effects,at.readLegacyGeometryForDisplay());let m=R.next(mt);for(;m;)this._write(B,at,m),m=R.next(mt)}_write(B,at,K){}}},89883:(Lt,ht,d)=>{d.d(ht,{W:()=>Ve,S:()=>Pe});var j=d(61921),ot=d(22795),st=d(33870),z=d(12523),X=d(23290),R=d(22791),P=d(12788),Y=d(22806),B=d(99155),at=d(42367),K=d(1452),mt=d(21194),m=d(78380),x=d(60305),l=d(90097),M=d(38963),J=(d(43588),d(44295)),A=d(82490),I=d(32727);function y(a,r,i,n,s,h,u){v=0;const f=(n-i)*h,_=s&&s.length,T=_?(s[0]-i)*h:f;let E,O,G,D,S,rt=L(r,i,0,0,T,h,!0);if(rt&&rt.next!==rt.prev){if(_&&(rt=function(a,r,i,n,s,h){const u=new Array;for(let f=0,_=n.length;f<_;f++){const T=L(a,r,0,n[f]*h,f<_-1?n[f+1]*h:i*h,h,!1);T===T.next&&(T.steiner=!0),u.push(Mt(T))}u.sort(Bt);for(const f of u)yt(f,s),s=U(s,s.next);return s}(r,i,n,s,rt,h)),f>80*h){E=G=r[0+i*h],O=D=r[1+i*h];for(let tt=h;tt<T;tt+=h){const et=r[tt+i*h],_t=r[tt+1+i*h];E=Math.min(E,et),O=Math.min(O,_t),G=Math.max(G,et),D=Math.max(D,_t)}S=Math.max(G-E,D-O),S=0!==S?1/S:0}k(rt,a,h,E,O,S,u,0)}}function L(a,r,i,n,s,h,u){let f;if(u===function(a,r,i,n,s,h){let u=0;for(let f=n,_=s-h;f<s;f+=h)u+=(a[_+r*h]-a[f+r*h])*(a[f+1+r*h]+a[_+1+r*h]),_=f;return u}(a,r,0,n,s,h)>0)for(let _=n;_<s;_+=h)f=lt(_+r*h,a[_+r*h],a[_+1+r*h],f);else for(let _=s-h;_>=n;_-=h)f=lt(_+r*h,a[_+r*h],a[_+1+r*h],f);return f&&wt(f,f.next)&&(ft(f),f=f.next),f}function U(a,r=a){if(!a)return a;let i,n=a;do{if(i=!1,n.steiner||!wt(n,n.next)&&0!==b(n.prev,n,n.next))n=n.next;else{if(ft(n),n=r=n.prev,n===n.next)break;i=!0}}while(i||n!==r);return r}function k(a,r,i,n,s,h,u,f){if(!a)return;!f&&h&&(a=N(a,n,s,h));let _=a;for(;a.prev!==a.next;){const T=a.prev,E=a.next;if(h?q(a,n,s,h):H(a))r.push(T.index/i+u),r.push(a.index/i+u),r.push(E.index/i+u),ft(a),a=E.next,_=E.next;else if((a=E)===_){f?1===f?k(a=Xt(a,r,i,u),r,i,n,s,h,u,2):2===f&&Kt(a,r,i,n,s,h,u):k(U(a),r,i,n,s,h,u,1);break}}}function H(a){const r=a.prev,i=a,n=a.next;if(b(r,i,n)>=0)return!1;let s=a.next.next;const h=s;let u=0;for(;s!==a.prev&&(0===u||s!==h);){if(u++,pt(r.x,r.y,i.x,i.y,n.x,n.y,s.x,s.y)&&b(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function q(a,r,i,n){const s=a.prev,h=a,u=a.next;if(b(s,h,u)>=0)return!1;const T=s.x>h.x?s.x>u.x?s.x:u.x:h.x>u.x?h.x:u.x,E=s.y>h.y?s.y>u.y?s.y:u.y:h.y>u.y?h.y:u.y,O=It(s.x<h.x?s.x<u.x?s.x:u.x:h.x<u.x?h.x:u.x,s.y<h.y?s.y<u.y?s.y:u.y:h.y<u.y?h.y:u.y,r,i,n),G=It(T,E,r,i,n);let D=a.prevZ,S=a.nextZ;for(;D&&D.z>=O&&S&&S.z<=G;){if(D!==a.prev&&D!==a.next&&pt(s.x,s.y,h.x,h.y,u.x,u.y,D.x,D.y)&&b(D.prev,D,D.next)>=0||(D=D.prevZ,S!==a.prev&&S!==a.next&&pt(s.x,s.y,h.x,h.y,u.x,u.y,S.x,S.y)&&b(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;D&&D.z>=O;){if(D!==a.prev&&D!==a.next&&pt(s.x,s.y,h.x,h.y,u.x,u.y,D.x,D.y)&&b(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;S&&S.z<=G;){if(S!==a.prev&&S!==a.next&&pt(s.x,s.y,h.x,h.y,u.x,u.y,S.x,S.y)&&b(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function lt(a,r,i,n){const s=c.create(a,r,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function ft(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Mt(a){let r=a,i=a;do{(r.x<i.x||r.x===i.x&&r.y<i.y)&&(i=r),r=r.next}while(r!==a);return i}function yt(a,r){if(r=function(a,r){let i=r;const n=a.x,s=a.y;let h,u=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const G=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(G<=n&&G>u){if(u=G,G===n){if(s===i.y)return i;if(s===i.next.y)return i.next}h=i.x<i.next.x?i:i.next}}i=i.next}while(i!==r);if(!h)return null;if(n===u)return h.prev;const f=h,_=h.x,T=h.y;let E,O=1/0;for(i=h.next;i!==f;)n>=i.x&&i.x>=_&&n!==i.x&&pt(s<T?n:u,s,_,T,s<T?u:n,s,i.x,i.y)&&(E=Math.abs(s-i.y)/(n-i.x),(E<O||E===O&&i.x>h.x)&&ct(i,a)&&(h=i,O=E)),i=i.next;return h}(a,r)){const i=V(r,a);U(i,i.next)}}function N(a,r,i,n){for(let s;s!==a;s=s.next){if(s=s||a,null===s.z&&(s.z=It(s.x,s.y,r,i,n)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,N(a,r,i,n);s.prevZ=s.prev,s.nextZ=s.next}return a.prevZ.nextZ=null,a.prevZ=null,function(a){let r,i=1;for(;;){let n,s=a;a=null,r=null;let h=0;for(;s;){h++,n=s;let u=0;for(;u<i&&n;u++)n=n.nextZ;let f=i;for(;u>0||f>0&&n;){let _;0===u?(_=n,n=n.nextZ,f--):0!==f&&n?s.z<=n.z?(_=s,s=s.nextZ,u--):(_=n,n=n.nextZ,f--):(_=s,s=s.nextZ,u--),r?r.nextZ=_:a=_,_.prevZ=r,r=_}s=n}if(r.nextZ=null,i*=2,h<2)return a}}(a)}function b(a,r,i){return(r.y-a.y)*(i.x-r.x)-(r.x-a.x)*(i.y-r.y)}function it(a,r,i,n){return!!(wt(a,r)&&wt(i,n)||wt(a,n)&&wt(i,r))||b(a,r,i)>0!=b(a,r,n)>0&&b(i,n,a)>0!=b(i,n,r)>0}function pt(a,r,i,n,s,h,u,f){return(s-u)*(r-f)-(a-u)*(h-f)>=0&&(a-u)*(n-f)-(i-u)*(r-f)>=0&&(i-u)*(h-f)-(s-u)*(n-f)>=0}function ct(a,r){return b(a.prev,a,a.next)<0?b(a,r,a.next)>=0&&b(a,a.prev,r)>=0:b(a,r,a.prev)<0||b(a,a.next,r)<0}function It(a,r,i,n,s){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-i)*s)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-n)*s)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function wt(a,r){return a.x===r.x&&a.y===r.y}function Bt(a,r){return a.x-r.x}function Xt(a,r,i,n){let s=a;do{const h=s.prev,u=s.next.next;!wt(h,u)&&it(h,s,s.next,u)&&ct(h,u)&&ct(u,h)&&(r.push(h.index/i+n),r.push(s.index/i+n),r.push(u.index/i+n),ft(s),ft(s.next),s=a=u),s=s.next}while(s!==a);return s}function Kt(a,r,i,n,s,h,u){let f=a;do{let _=f.next.next;for(;_!==f.prev;){if(f.index!==_.index&&Dt(f,_)){let T=V(f,_);return f=U(f,f.next),T=U(T,T.next),k(f,r,i,n,s,h,u,0),void k(T,r,i,n,s,h,u,0)}_=_.next}f=f.next}while(f!==a)}function Dt(a,r){return a.next.index!==r.index&&a.prev.index!==r.index&&!function(a,r){let i=a;do{if(i.index!==a.index&&i.next.index!==a.index&&i.index!==r.index&&i.next.index!==r.index&&it(i,i.next,a,r))return!0;i=i.next}while(i!==a);return!1}(a,r)&&ct(a,r)&&ct(r,a)&&function(a,r){let i=a,n=!1;const s=(a.x+r.x)/2,h=(a.y+r.y)/2;do{i.y>h!=i.next.y>h&&i.next.y!==i.y&&s<(i.next.x-i.x)*(h-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==a);return n}(a,r)}function V(a,r){const i=c.create(a.index,a.x,a.y),n=c.create(r.index,r.x,r.y),s=a.next,h=r.prev;return a.next=r,r.prev=a,i.next=s,s.prev=i,n.next=i,i.prev=n,h.next=n,n.prev=h,n}class c{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(r,i,n){const s=v<p.length?p[v++]:new c;return s.index=r,s.x=i,s.y=n,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}}const p=new Array;let v=0;for(let a=0;a<8096;a++)p.push(new c);const C=new I.b(0,0,0,1,0),Z=new I.b(0,0,0,1,0);function ut(a,r,i){let n=0;for(let s=1;s<i;s++)n+=(a[2*(r+s)]-a[2*(r+s-1)])*(a[2*(r+s)+1]+a[2*(r+s-1)+1]);return n}function dt(a,r,i,n,s){let h=0;for(let f=i;f<n;f+=3){const _=2*(a.getValue(f)-s),T=2*(a.getValue(f+1)-s),E=2*(a.getValue(f+2)-s);h+=Math.abs((r[_]-r[E])*(r[T+1]-r[_+1])-(r[_]-r[T])*(r[E+1]-r[_+1]))}return h}C.setExtent(B.I_),Z.setExtent(B.I_);const Pt=a=>class extends a{constructor(...r){super(...r),this.forceLibtess=!1,this.geometryType=M.LW.FILL}_write(r,i,n){const s="esriGeometryPoint"===i.geometryType,h=mt.dk.load(this._materialKey);r.recordStart(i.getDisplayId(),this._materialKey,this.geometryType,h.dotDensity,s),this._writeGeometry(r,i,h,n,s),r.recordEnd()}_writeGeometry(r,i,n,s,h){const u=this._getGeometry(i,s,h);if((0,x.Wi)(u))return;const f=r.indexCount();if(!(u.maxLength>100)&&!this.forceLibtess&&function(a,r){const{coords:i,lengths:n,hasIndeterminateRingOrder:s}=r,h=a.indexWriter(),u=a.vertexCount();if(s)return!1;const f=h.length;let _=0;for(let T=0;T<n.length;){let E=T,O=n[T],G=ut(i,_,O);const D=[];for(;++E<n.length;){const et=n[E],_t=ut(i,_+O,et);if(!(_t>0))break;G+=_t,D.push(_+O),O+=et}const S=h.length;y(h,i,_,_+O,D,2,u);const rt=dt(h,i,S,h.length,u),tt=Math.abs(G);if(Math.abs((rt-tt)/Math.max(1e-7,tt))>1e-5)return h.seek(f),!1;T=E,_+=O}return!0}(r,u))return void(f!==r.indexCount()&&this._writeVertices(r,i,u.coords,u.lengths,n));const _=function(a,r){const i=a.indexWriter(),n=a.vertexCount(),{coords:s,lengths:h}=r,{buffer:u,vertexCount:f}=(0,J.b)(s,h);i.ensureSize(f);for(let _=0;_<f;_++)i.push(_+n);return u}(r,u);f!==r.indexCount()&&this._writeVertices(r,i,_,[_.length/2],n)}_writeVertices(r,i,n,s,h){const u=i.getDisplayId();let f=0;const _=s.reduce((E,O)=>E+O);r.vertexEnsureSize((h.dotDensity?4:10)*_);for(const E of s){const O=E+f;for(let G=f;G<O;G++){const D=n[2*G],S=n[2*G+1],rt=(0,K.UJ)(1*D,1*S);r.vertexBounds(D,S,0,0),r.vertexWrite(rt),r.vertexWrite(u),h.dotDensity?r.vertexWriteF32(1/Math.abs(i.readGeometryArea())):(r.vertexWrite(this.fillColor),r.vertexWrite(this.tl),r.vertexWrite(this.br),r.vertexWrite(this.aux1),r.vertexWrite(this.aux2),r.vertexWrite(this.aux3),r.vertexWrite(this._minMaxZoom))}f+=E}}_getGeometry(r,i,n){const s=i?(0,l.oB)((0,l.GH)(i),2):r.readGeometryForDisplay();return s?function(a,r){if((0,x.Wi)(a))return null;if(!function(a,r,i){let n=0;for(let s=0;s<a.lengths.length;s++){const h=a.lengths[s];for(let u=0;u<h;u++){const f=a.coords[2*(u+n)],_=a.coords[2*(u+n)+1];if(f<-128||f>i||_<-128||_>i)return!0}n+=h}return!1}(a,0,B.I_+128))return a;C.setPixelMargin(r),C.reset(3);let i=0;for(let u=0;u<a.lengths.length;u++){const f=a.lengths[u];let _=a.coords[2*(0+i)],T=a.coords[2*(0+i)+1];C.moveTo(_,T);for(let E=1;E<f;E++)_=a.coords[2*(E+i)],T=a.coords[2*(E+i)+1],C.lineTo(_,T);C.close(),i+=f}const n=C.result(!1);if(!n)return null;const s=[],h=[];for(const u of n){let f=0;for(const _ of u)h.push(_.x),h.push(_.y),f++;s.push(f)}return new A.Z(s,h)}(s,n?256:8):null}};var Ft=d(47475),Ot=d(12867);const Gt=st.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");class zt extends Ot.Z{constructor(r){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=r}analyze(r,i,n,s){const h=i.readLegacyFeature(),u=this._materialCache,f=this._cimLayer.materialHash;if(!f)return Gt.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);const _="function"==typeof f?f(h,n,s):f;if(u.has(_)){const O=u.get(_);return Promise.resolve(O)}if(this._ongoingMaterialRequestMap.has(_))return this._ongoingMaterialRequestMap.get(_);const T=(0,Ft.S)(this._cimLayer.cim,this._cimLayer.materialOverrides);T.mosaicHash=_;const E=r.getMosaicItem(T).then(O=>(this._ongoingMaterialRequestMap.delete(_),u.set(_,O),O)).catch(O=>(this._ongoingMaterialRequestMap.delete(_),Gt.error(".analyze()",O.message),null));return this._ongoingMaterialRequestMap.set(_,E),E}}var bt=d(7409);class ae extends(Pt(zt)){constructor(r,i,n){var s;if(super(r),this._minMaxZoom=(0,K.UJ)(Math.round(i*B.MI),Math.round(n*B.MI)),(0,m.mf)(r.color))this._dynamicPropertyMap.set("fillColor",(et,_t,gt)=>{const At=r.color(et,_t,gt);return At&&(0,Y.t2)(At)||0});else{const tt=r.color;this.fillColor=tt&&(0,Y.t2)(tt)||0}let h=0;(0,m.mf)(r.height)||(h=r.height||0);const u="CIMMarkerPlacementInsidePolygon"===(null==(s=r.cim.placement)?void 0:s.type)&&r.cim.placement.shiftOddRows?2:1;this._dynamicPropertyMap.set("_height",(tt,et,_t)=>(0,m.mf)(r.height)?r.height(tt,et,_t)*u:h*u);let _=0;(0,m.mf)(r.offsetX)||(_=(0,P.F2)(r.offsetX||0)+128,_>255&&(_=255)),this._dynamicPropertyMap.set("_offsetX",(tt,et,_t)=>{if((0,m.mf)(r.offsetX)){let gt=(0,P.F2)(r.offsetX(tt,et,_t))+128;return gt>255&&(gt=255),gt}return _});let E=1;(0,m.mf)(r.scaleX)||(E=r.scaleX||1),this._dynamicPropertyMap.set("_scaleX",(tt,et,_t)=>(0,m.mf)(r.scaleX)?r.scaleX(tt,et,_t):E);let G=0;(0,m.mf)(r.offsetY)||(G=(0,P.F2)(-r.offsetY||0)+128,G>255&&(G=255)),this._dynamicPropertyMap.set("_offsetY",(tt,et,_t)=>{if((0,m.mf)(r.offsetY)){let gt=(0,P.F2)(-r.offsetY(tt,et,_t))+128;return gt>255&&(gt=255),gt}return G});let S=0;(0,m.mf)(r.angle)||(S=(0,at.Or)(r.angle)||0),this._dynamicPropertyMap.set("_angle",(tt,et,_t)=>(0,m.mf)(r.angle)?(0,at.Or)(r.angle(tt,et,_t)):S),this._effects=r.effects,this._cimFillLayer=r,this._fillMaterialKey=mt.dk.load(r.materialKey)}static fromCIMFill(r,i){const[n,s]=(0,m._f)(r.scaleInfo,i);return new ae(r,n,s)}bindFeature(r,i,n){const s=r.readLegacyFeature();this._dynamicPropertyMap.forEach((O,G)=>{this[G]=O(s,i,n)});const h=this._fillMaterialKey,u=this._materialCache,f=this._cimFillLayer;this.aux3=(0,K.Jz)(0,0,this._angle,f.colorLocked?1:0);const _=(0,f.materialHash)(s,i,n),T=u.get(_);let E=null;if(T&&(0,bt.ok)(T.spriteMosaicItem)&&(E=T.spriteMosaicItem),E){const{rect:O,width:G,height:D}=E,S=O.x+B.fL,rt=O.y+B.fL,tt=S+G,et=rt+D;let _t=(0,R.Sf)((0,P.F2)(this._height));_t>255?_t=255:_t<=0&&(_t=(0,R.Sf)(et-rt));let gt=(0,R.Sf)((0,P.F2)(this._height/D*G||0));gt>255?gt=255:gt<=0&&(gt=(0,R.Sf)(tt-S));const At=this._scaleX,Zt=1;this.tl=(0,K.UJ)(S,rt),this.br=(0,K.UJ)(tt,et),this.aux1=(0,K.Jz)(gt,_t,this._offsetX,this._offsetY),this.aux2=(0,K.UJ)(128*At,128*Zt),h.sdf=E.sdf,h.pattern=!0,h.textureBinding=E.textureBinding}else this.tl=0,this.br=0,this.aux1=0,this.aux2=0,h.sdf=!1,h.pattern=!1,h.textureBinding=0;this._materialKey=h.data}}var Se=d(30274);const xe=a=>class extends a{constructor(...r){super(...r),this.tessellationProperties={},this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},this.geometryType=M.LW.LINE}_initializeTessellator(r){const i=mt.a.load(this._materialKey),n=this._tessellationOptions,s=i.vvSizeFieldStops||i.vvSizeMinMaxValue||i.vvSizeScaleStops||i.vvSizeUnitValue,h=this.tessellationProperties._halfWidth<B.tQ;this.tessellationProperties.minMaxZoom=this._minMaxZoom;const u=h&&!r&&!s;n.wrapDistance=65535,n.textured=this._isDashed||this._hasPattern,n.offset=this.tessellationProperties.offset,n.halfWidth=this.tessellationProperties._halfWidth;const f=u?0:1;this._lineTessellator=new Se.z(Ie(this.tessellationProperties,f,f),Ce(this.tessellationProperties),u)}_write(r,i,n){const s="esriGeometryPoint"===i.geometryType;r.recordStart(i.getDisplayId(),this._materialKey,this.geometryType,!1,s),this._writeGeometry(r,i,n,s),r.recordEnd()}_writeGeometry(r,i,n,s){const h=null!=n?n:i.readLegacyGeometryForDisplay(),u=this._getLines(h,s);(0,x.Wi)(u)||this._writeVertices(r,i,u)}_getLines(r,i){if((0,x.Wi)(r))return null;const n=r.paths||r.rings;return(0,x.Wi)(n)?null:function(a,r){Z.setPixelMargin(r);const i=Z,n=-r,s=B.I_+r;let h=[],u=!1,f=0;for(;f<a.length;){const _=[],T=a[f];if(!T)return null;i.reset(2);let[E,O]=T[0];if(u)i.moveTo(E,O);else{if(E<n||E>s||O<n||O>s){u=!0;continue}_.push({x:E,y:O})}let G=!1;const D=T.length;for(let S=1;S<D;++S)if(E+=T[S][0],O+=T[S][1],u)i.lineTo(E,O);else{if(E<n||E>s||O<n||O>s){G=!0;break}_.push({x:E,y:O})}if(G)u=!0;else{if(u){const S=i.resultWithStarts();if(S)for(const rt of S)h.push(rt)}else h.push({line:_,start:0});f++,u=!1}}return h=h.filter(_=>_.line.length>1),0===h.length?null:h}(n,i?256:16)}_writeVertices(r,i,n){const s=i.getDisplayId(),h=r.vertexCount(),u=this.tessellationProperties,f=this._tessellationOptions;u.out=r,u.id=s,u.indexCount=0,u.vertexCount=0,u.offset=h,f.capType=this._capType,f.joinType=this._joinType;for(const{line:_,start:T}of n)f.initialDistance=T%65535,this._lineTessellator.tessellate(_,f)}},Ie=(a,r,i)=>(n,s,h,u,f,_,T,E,O,G,D)=>{const S=(0,K.UJ)(D,Math.ceil(1024*a._halfWidth)),rt=(0,K.Jz)(Math.round(31*T),Math.round(31*E),Math.round(31*O),Math.round(31*G)),tt=(0,K.Jz)(31*f,31*_,0,a._bitset),et=a.out;return et.vertexBounds(n,s,r,i),et.vertexWrite((0,K.UJ)(8*n,8*s)),et.vertexWrite(a.id),et.vertexWrite(a._fillColor),et.vertexWrite(rt),et.vertexWrite(S),et.vertexWrite(a._tl),et.vertexWrite(a._br),et.vertexWrite(tt),et.vertexWrite((0,K.UJ)(Math.ceil(1024*a._halfReferenceWidth),0)),et.vertexWrite(a.minMaxZoom),et.vertexEnd(),a.offset+a.vertexCount++},Ce=a=>(r,i,n)=>{const s=a.out;s.indexWrite(r),s.indexWrite(i),s.indexWrite(n),a.indexCount+=3};class le extends(xe(zt)){constructor(r,i,n){super(r),this._minMaxZoom=(0,K.UJ)(Math.round(i*B.MI),Math.round(n*B.MI)),this._cimLineLayer=r;let s=0;if((0,m.mf)(r.width)||(s=.5*(0,P.F2)(r.width)),this._dynamicPropertyMap.set("_halfWidth",(u,f,_)=>(0,m.mf)(r.width)?.5*(0,P.F2)(r.width(u,f,_)):s),(0,m.mf)(r.cap)?this._dynamicPropertyMap.set("_capType",r.cap):this._capType=r.cap,(0,m.mf)(r.join)?this._dynamicPropertyMap.set("_joinType",r.join):this._joinType=r.join,(0,m.mf)(r.color))this._dynamicPropertyMap.set("_fillColor",(f,_,T)=>{const E=r.color(f,_,T);return E&&(0,Y.t2)(E)||0});else{const u=r.color;this._fillColor=u&&(0,Y.t2)(u)||0}(0,m.mf)(r.miterLimit)?this._dynamicPropertyMap.set("_miterLimitCosine",(f,_,T)=>(0,m.NW)(r.miterLimit(f,_,T))):this._miterLimitCosine=(0,m.NW)(r.miterLimit),this._scaleFactor=r.scaleFactor||1,this._isDashed=r.isDashed,this._effects=r.effects,this.tessellationProperties._bitset=r.colorLocked?1:0,this._materialKey=r.materialKey,this._initializeTessellator(!0)}static fromCIMLine(r,i){const[n,s]=(0,m._f)(r.scaleInfo,i);return new le(r,n,s)}bindFeature(r,i,n){const s=r.readLegacyFeature();this._dynamicPropertyMap.forEach((E,O)=>{this[O]=E(s,i,n)}),this._halfWidth*=this._scaleFactor;const h=this._materialCache,u=(0,this._cimLineLayer.materialHash)(s,i,n),f=h.get(u);let _=null;if(f&&(0,bt.ok)(f.spriteMosaicItem)&&(_=f.spriteMosaicItem),_){this._hasPattern=!0;const{rect:E,width:O,height:G}=_,D=E.x+B.fL,S=E.y+B.fL,rt=D+O,tt=S+G;this.tessellationProperties._tl=(0,K.UJ)(D,S),this.tessellationProperties._br=(0,K.UJ)(rt,tt)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;const T=mt.a.load(this._materialKey);_&&(T.sdf=_.sdf,T.pattern=!0,T.textureBinding=_.textureBinding),this._materialKey=T.data}}var ze=d(62764),we=d(3878),De=d(28149);const be=(0,we.c)(),Be=(0,ze.c)(),Fe=st.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");class he extends((0,De.Z)(zt)){constructor(r,i,n){super(r),this._cimMarkerLayer=r,this._minMaxZoom=(0,K.UJ)(Math.round(i*B.MI),Math.round(n*B.MI)),(0,m.mf)(r.color)?this._dynamicPropertyMap.set("_fillColor",(h,u,f)=>(0,Y.t2)(r.color(h,u,f))):this._fillColor=(0,Y.t2)(r.color),(0,m.mf)(r.outlineColor)?this._dynamicPropertyMap.set("_outlineColor",(h,u,f)=>(0,Y.t2)(r.outlineColor(h,u,f))):this._outlineColor=(0,Y.t2)(r.outlineColor),(0,m.mf)(r.size)?this._dynamicPropertyMap.set("_size",(h,u,f)=>(0,P.F2)(r.size(h,u,f))):this._size=(0,P.F2)(r.size)||0,(0,m.mf)(r.scaleX)?this._dynamicPropertyMap.set("_scaleX",r.scaleX):this._scaleX=r.scaleX||1,(0,m.mf)(r.offsetX)?this._dynamicPropertyMap.set("xOffset",(h,u,f)=>(0,P.F2)(r.offsetX(h,u,f))):this.xOffset=(0,P.F2)(r.offsetX)||0,(0,m.mf)(r.offsetY)?this._dynamicPropertyMap.set("yOffset",(h,u,f)=>(0,P.F2)(r.offsetY(h,u,f))):this.yOffset=(0,P.F2)(r.offsetY)||0,(0,m.mf)(r.outlineWidth)?this._dynamicPropertyMap.set("_outlineWidth",(h,u,f)=>(0,P.F2)(r.outlineWidth(h,u,f))):this._outlineWidth=(0,P.F2)(r.outlineWidth)||0,(0,m.mf)(r.rotation)?this._dynamicPropertyMap.set("_angle",r.rotation):this._angle=r.rotation||0,this._scaleFactor=(0,x.Pt)(r.scaleFactor,1),this._markerPlacement=r.markerPlacement,this._effects=r.effects,this._bitSet=(1===r.alignment?1:0)|(r.colorLocked?1:0)<<1|(r.scaleSymbolsProportionally?1:0)<<3,this._materialKey=r.materialKey}static fromCIMMarker(r,i){const[n,s]=(0,m._f)(r.scaleInfo,i);return new he(r,n,s)}bindFeature(r,i,n){const s=r.readLegacyFeature();this._dynamicPropertyMap.forEach((je,Je)=>{this[Je]=je(s,i,n)});const h=this._cimMarkerLayer.materialHash,u="function"==typeof h?h(s,i,n):h,f=this._materialCache.get(u);if(!f||!(0,bt.ok)(f.spriteMosaicItem)||!f.spriteMosaicItem)return void Fe.error(new ot.Z("mapview-cim","Encountered an error when binding feature"));const _=f.spriteMosaicItem,T=this._cimMarkerLayer.sizeRatio,E=_.width/_.height*this._scaleX,O=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle;let G=this._size,D=G*E;const S=this.xOffset,rt=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;const tt=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/(0,P.F2)(this._cimMarkerLayer.frameHeight):1,et=this._outlineWidth*tt,_t=(0,P.F2)(this._cimMarkerLayer.referenceSize);let gt=0,At=0;const Zt=this._cimMarkerLayer.anchorPoint;Zt&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(gt=-Zt.x/(this._size*E),At=Zt.y/this._size):(gt=Zt.x,At=Zt.y)),this._sizeOutlineWidth=(0,K.Jz)(Math.round(Math.min(Math.sqrt(128*D),255)),Math.round(Math.min(Math.sqrt(128*G),255)),Math.round(Math.min(Math.sqrt(128*et),255)),Math.round(Math.min(Math.sqrt(128*_t),255))),this.angle=O;const te=Math.round(64*T);this._bitestAndDistRatio=(0,K.UJ)(this._bitSet,te);const Qt=_.rect.x+B.fL,ee=_.rect.y+B.fL,ie=Qt+_.width,se=ee+_.height;this._texUpperLeft=(0,K.UJ)(Qt,ee),this._texUpperRight=(0,K.UJ)(ie,ee),this._texBottomLeft=(0,K.UJ)(Qt,se),this._texBottomRight=(0,K.UJ)(ie,se);const qt=mt.mE.load(this._materialKey);qt.sdf=_.sdf,qt.pattern=!0,qt.textureBinding=_.textureBinding,this._materialKey=qt.data,this._anchorX=.5-(.5+gt)*_.width/_.width,this._anchorY=.5-(.5+At)*_.height/_.height,D*=T,G*=T,D*=this._scaleFactor,G*=this._scaleFactor,D*=_.rect.width/_.width,G*=_.rect.height/_.height,this._computedWidth=D,this._computedHeight=G,this._applyTransformation(Be,be),this.xOffset=S,this.yOffset=rt}}var ye=d(75335),Oe=d(24588),pe=d(38519);class ce extends((0,Oe.Z)(zt)){constructor(r,i,n){super(r),this._horizontalAlignment="center",this._verticalAlignment="middle",this._textToGlyphs=new Map,this._minMaxZoom=(0,K.UJ)(Math.round(i*B.MI),Math.round(n*B.MI));const s=r.scaleFactor||1;let h,f,T;this._cimTextLayer=r,(0,m.mf)(r.color)?this._dynamicPropertyMap.set("_color",(S,rt,tt)=>(0,Y.t2)(r.color(S,rt,tt))):this._color=(0,Y.t2)(r.color),(0,m.mf)(r.color)?this._dynamicPropertyMap.set("_haloColor",(S,rt,tt)=>(0,Y.t2)(r.outlineColor(S,rt,tt))):this._haloColor=(0,Y.t2)(r.outlineColor),(0,m.mf)(r.size)||(h=Math.min(Math.round((0,P.F2)(r.size*r.sizeRatio)),127)),this._dynamicPropertyMap.set("_size",(D,S,rt)=>(0,m.mf)(r.size)?Math.min(Math.round((0,P.F2)(r.size(D,S,rt)*r.sizeRatio)),127):h),(0,m.mf)(r.outlineSize)?this._dynamicPropertyMap.set("_haloSize",(S,rt,tt)=>Math.min(Math.floor(5*(0,P.F2)(r.outlineSize(S,rt,tt)*r.sizeRatio)),127)):this._haloSize=Math.min(Math.floor(5*(0,P.F2)(r.outlineSize*r.sizeRatio)),127),(0,m.mf)(r.offsetX)||(f=Math.round((0,P.F2)(r.offsetX*r.sizeRatio))),this._dynamicPropertyMap.set("_xOffset",(D,S,rt)=>(0,m.mf)(r.offsetX)?Math.round((0,P.F2)(r.offsetX(D,S,rt)*r.sizeRatio)):f),(0,m.mf)(r.offsetY)||(T=Math.round((0,P.F2)(r.offsetY*r.sizeRatio))),this._dynamicPropertyMap.set("_yOffset",(D,S,rt)=>(0,m.mf)(r.offsetY)?Math.round((0,P.F2)(r.offsetY(D,S,rt)*r.sizeRatio)):T),(0,m.mf)(r.angle)?this._dynamicPropertyMap.set("_angle",r.angle):this._angle=r.angle,(0,m.mf)(r.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",r.horizontalAlignment):this._horizontalAlignment=r.horizontalAlignment,(0,m.mf)(r.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",r.verticalAlignment):this._verticalAlignment=r.verticalAlignment,this._scaleFactor=s,(0,m.mf)(r.text)?this._dynamicPropertyMap.set("_text",r.text):this._text=r.text;const O=Math.min(Math.round((0,P.F2)(r.referenceSize*r.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*O)),this._materialKey=r.materialKey;const G=mt.qr.load(this._materialKey);G.sdf=!0,this._bitset=(1===r.alignment?1:0)|(r.colorLocked?1:0)<<1,this._materialKey=G.data,this._decoration="none",this._lineHeight=1,this._lineWidth=512,this._textPlacement=r.markerPlacement,this._effects=r.effects,this._isCIM=!0}static fromCIMText(r,i){const[n,s]=(0,m._f)(r.scaleInfo,i);return new ce(r,n,s)}analyze(r,i,n,s){var h=this;return(0,j.Z)(function*(){const u=i.readLegacyFeature(),f=function(a,r,i,n){return"string"==typeof a.text?a.text:"function"==typeof a.text?a.text(r,i,n):""}(h._cimTextLayer,u,n,s),_=yield r.getMosaicItem(h._cimTextLayer.cim,(0,pe._)(f));return h._textToGlyphs.set(f,_.glyphMosaicItems),_})()}bindFeature(r,i,n){const s=r.readLegacyFeature();if(this._dynamicPropertyMap.forEach((u,f)=>{this[f]=u(s,i,n)}),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/24,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=(0,ye.kH)(this._horizontalAlignment||"center"),this._yAlignD=(0,ye.b7)(this._verticalAlignment||"baseline");const h=this._textToGlyphs.get(this._text);this.bindTextInfo(h,!1)}}const Jt=128;class Ht extends(Pt(Ot.Z)){constructor(r,i,n,s,h,u,f,_,T,E,O){super(),this._effects=T;const G=mt.dk.load(r);i&&(G.sdf=i.sdf,G.pattern=!0,G.textureBinding=i.textureBinding),this.fillColor=n,this.tl=s,this.br=h,this.aux1=u,this.aux2=f,this.aux3=_,this._minMaxZoom=(0,K.UJ)(Math.round(E*B.MI),Math.round(O*B.MI)),this._materialKey=G.data}static fromCIMFill(r,i,n){const s=r.color,h=s&&(0,Y.t2)(s)||0,u=r.materialKey,[f,_]=(0,m._f)(r.scaleInfo,n);if(!i){const qt=(0,K.Jz)(0,0,0,r.colorLocked?1:0);return new Ht(u,null,h,0,0,0,0,qt,r.effects,f,_)}const{rect:T,width:E,height:O}=i,G=T.x+B.fL,D=T.y+B.fL,S=G+E,rt=D+O;let tt=(0,R.Sf)(O);tt>255?tt=255:tt<=0&&(tt=(0,R.Sf)(rt-D));let et=(0,R.Sf)(E||0);et>255?et=255:et<=0&&(et=(0,R.Sf)(S-G));let _t=(0,P.F2)(r.offsetX||0)+Jt;_t>255&&(_t=255);let gt=(0,P.F2)(-r.offsetY||0)+Jt;gt>255&&(gt=255);const At=r.scaleX||1,te=(0,K.UJ)(G,D),Qt=(0,K.UJ)(S,rt),ee=(0,K.Jz)(et,tt,_t,gt),ie=(0,K.UJ)(Jt*At,128),se=(0,K.Jz)(0,0,(0,at.s5)(r.angle),r.colorLocked?1:0);return new Ht(u,i,h,te,Qt,ee,ie,se,r.effects,f,_)}static fromSimpleFill(r,i,n=!1){const{color:s}=r,h=s&&"esriSFSNull"!==r.style&&(0,Y.aH)(s)||0,u=(0,K.Jz)(0,0,0,n?255:0),f=r.materialKey;if(!i)return new Ht(f,null,h,0,0,0,0,u,null,m.Xe,m.eW);const{rect:_,width:T,height:E}=i,O=_.x+B.fL,G=_.y+B.fL,D=O+T,S=G+E,rt=(0,K.UJ)(O,G),tt=(0,K.UJ)(D,S),et=(0,K.Jz)((0,R.Sf)(D-O),(0,R.Sf)(S-G),0,0),_t=(0,K.UJ)(Jt,Jt);return new Ht(f,i,h,rt,tt,et,_t,u,null,m.Xe,m.eW)}static fromPictureFill(r,i,n=!1){const s=B.ru,{rect:h,width:u,height:f}=i,_=h.x+B.fL,T=h.y+B.fL,E=_+u,O=T+f,G=(0,K.UJ)(_,T),D=(0,K.UJ)(E,O);let S=(0,R.Sf)((0,P.F2)(r.width));S>255&&(S=255);let rt=(0,R.Sf)((0,P.F2)(r.height));rt>255&&(rt=255);let tt=(0,P.F2)(r.xoffset)+Jt;tt>255&&(tt=255);let et=(0,P.F2)(-r.yoffset)+Jt;et>255&&(et=255);const _t=(0,K.Jz)(S,rt,tt,et),gt=(0,K.UJ)(Jt*r.xscale,Jt*r.yscale),At=(0,K.Jz)(0,0,0,n?255:0);return new Ht(r.materialKey,i,s,G,D,_t,gt,At,null,m.Xe,m.eW)}}var Me=d(20547);const Ue=st.Z.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");class Yt extends(xe(Ot.Z)){constructor(r,i,n,s,h,u,f,_,T,E,O,G,D,S,rt,tt,et){super();const _t=mt.a.load(r);i&&(_t.sdf=i.sdf,_t.pattern=!0,_t.textureBinding=i.textureBinding),this._capType=s,this._joinType=h,this._miterLimitCosine=(0,m.NW)(u),this.tessellationProperties._fillColor=f,this.tessellationProperties._tl=_,this.tessellationProperties._br=T,this._hasPattern=E,this._isDashed=O,this._isColorLocked=G,this._zOrder=S,this._effects=rt,this._minMaxZoom=(0,K.UJ)(Math.round(tt*B.MI),Math.round(et*B.MI)),this._materialKey=_t.data,this.tessellationProperties._bitset=G?1:0,this.tessellationProperties._halfWidth=.5*n,this.tessellationProperties._halfReferenceWidth=.5*D,this.tessellationProperties.offset=0,this._initializeTessellator(!1)}static fromCIMLine(r,i,n){const s=r.color,h=r.scaleFactor||1,u=r.isDashed;let f=r.cap;u&&1===f&&(f=2);const _=r.join,T=(0,P.F2)(r.width)*h,E=(0,P.F2)(r.referenceWidth),O=(0,P.F2)(r.miterLimit),G=s&&(0,Y.t2)(s)||0,[D,S]=(0,m._f)(r.scaleInfo,n);if(!i)return new Yt(r.materialKey,i,T,f,_,O,G,0,0,!1,u,r.colorLocked,E,r.zOrder,r.effects,D,S);const{rect:rt,width:tt,height:et}=i,_t=rt.x+B.fL,gt=rt.y+B.fL,At=_t+tt,Zt=gt+et,te=(0,K.UJ)(_t,gt),Qt=(0,K.UJ)(At,Zt);return new Yt(r.materialKey,i,T,f,_,O,G,te,Qt,!0,u,r.colorLocked,E,r.zOrder,r.effects,D,S)}static fromSimpleLine(r,i){const{color:n}=r,s="esriSLSSolid"!==r.style&&"esriSLSNull"!==r.style,h=(0,Me.ws)(r.cap||"round"),u=(0,Me.xV)(r.join||"round");let f=n&&"esriSLSNull"!==r.style&&(0,Y.aH)(n)||0;"esriSLSNull"===r.style&&(f=0);const _=(0,P.F2)(r.width),T=r.miterLimit;if(!i)return new Yt(r.materialKey,i,_,h,u,T,f,0,0,!1,s,!1,_,0,null,m.Xe,m.eW);const{rect:E,width:O,height:G}=i,D=E.x+B.fL,S=E.y+B.fL,rt=D+O,tt=S+G,et=(0,K.UJ)(D,S),_t=(0,K.UJ)(rt,tt);return new Yt(r.materialKey,i,_,h,u,T,f,et,_t,!0,s,!1,_,0,null,m.Xe,m.eW)}static fromPictureLineSymbol(r,i,n,s){return Ue.error("PictureLineSymbol support does not exist!"),null}}var re=d(79862),ve=d(41814);class Ze{constructor(){this._resolver=null}isHeld(){return!!this._resolver}acquire(){var r=this;return(0,j.Z)(function*(){if(!r._resolver)return r._resolver=(0,z.hh)(),Promise.resolve();yield r._resolver.promise,yield r.acquire()})()}release(){const r=this._resolver;this._resolver=null,r.resolve()}}function ue(){return(ue=(0,j.Z)(function*(a,r,i){try{yield a.acquire(),yield r(i),a.release()}catch(n){throw a.release(),n}})).apply(this,arguments)}var fe=d(15691);const Rt=st.Z.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Le=new Array;function Nt(a,r){const i=a.length;return a.push(null),r.then(n=>a[i]=n),a}function Pe(a){return!!(1&a)}class Ve{constructor(r,i){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new Ze,this._fetchResource=r,this._tileInfo=i}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(r,i){this._initErrorTemplates();const n=r.hash;if(this._symbolToTemplate.has(n))return this._symbolToTemplate.get(n);const s=new Array;i&&this._createMeshTemplates(s,i,!0),this._createMeshTemplates(s,r,!1);const h=this._createGroupId("expanded-cim"===r.type);return this._idToTemplateGroup.set(h,s),this._symbolToTemplate.set(n,h),h}getTemplateGroup(r){return this._idToTemplateGroup.has(r)?this._idToTemplateGroup.get(r):Le}getDynamicTemplateGroup(r){return this._idToTemplateGroup.has(r)?(Pe(r)||Rt.error("mapview-template-store",`Id ${r} does not refer to a dynamic template`),this._idToTemplateGroup.get(r)):Le}getMosaicItem(r,i){const n=this._createTemplateId(),s=new Promise(h=>this._idToResolver.set(n,h));return this._fetchQueue.push({symbol:r,id:n,glyphIds:i}),s}finalize(r){return this._fetchQueue.length||this._lock.isHeld()?function(a,r,i){return ue.apply(this,arguments)}(this._lock,this._fetchAllQueuedResources.bind(this),r):Promise.resolve()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],(0,fe.PY)(X.kD),!1),marker:this._createMeshTemplates([],(0,fe.PY)(X.G),!1),line:this._createMeshTemplates([],(0,fe.PY)(X.mW),!1)})}_fetchAllQueuedResources(r){if(!this._fetchQueue.length)return Promise.resolve();const i=this._fetchQueue,n=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(n).then(()=>this._fetchResource(i,r).then(s=>{for(const{id:h,mosaicItem:u}of s)this._idToResolver.get(h)(u),this._idToResolver.delete(h)})).catch(s=>{(0,z.D_)(s)?this._fetchQueue=this._fetchQueue.concat(i):"worker:port-closed"===s.name||Rt.error(new ot.Z("mapview-template-store","Unable to fetch requested texture resources",s))})}_createGroupId(r){return this._idCounter++<<1|(r?1:0)}_createTemplateId(){return this._templateIdCounter++}_createSMS(r){var i=this;return(0,j.Z)(function*(){const{spriteMosaicItem:n}=yield i.getMosaicItem(r);return(0,bt.ok)(n,Rt)?re.Z.fromSimpleMarker(r,n):i._markerError})()}_createPMS(r){var i=this;return(0,j.Z)(function*(){const{spriteMosaicItem:n}=yield i.getMosaicItem(r);return(0,bt.ok)(n,Rt)?re.Z.fromPictureMarker(r,n):i._markerError})()}_createSFS(r,i){var n=this;return(0,j.Z)(function*(){const{spriteMosaicItem:s}=yield n.getMosaicItem(r);return(0,bt.ok)(s,Rt)?Ht.fromSimpleFill(r,s,i):n._fillError})()}_createPFS(r,i){var n=this;return(0,j.Z)(function*(){const{spriteMosaicItem:s}=yield n.getMosaicItem(r);return(0,bt.ok)(s,Rt)?Ht.fromPictureFill(r,s,i):n._fillError})()}_createSLS(r,i){var n=this;return(0,j.Z)(function*(){const{spriteMosaicItem:s}=yield n.getMosaicItem(r);return(0,bt.ok)(s,Rt)?Yt.fromSimpleLine(r,s):n._lineError})()}_createLMS(r){var i=this;return(0,j.Z)(function*(){const{spriteMosaicItem:n}=yield i.getMosaicItem(r);return(0,bt.ok)(n,Rt)?re.Z.fromLineSymbolMarker(r,n):i._markerError})()}_createTS(r){var i=this;return(0,j.Z)(function*(){const{glyphMosaicItems:n}=yield i.getMosaicItem(r);return ve.Z.fromText(r,n)})()}_createCIMText(r){var i=this;return(0,j.Z)(function*(){const{glyphMosaicItems:n}=yield i.getMosaicItem(r.cim,(0,pe._)(r.text));return(0,bt.ok)(n,Rt)?ve.Z.fromCIMText(r,n,i._tileInfo):i._textError})()}_createCIMFill(r){var i=this;return(0,j.Z)(function*(){const{spriteMosaicItem:n}=yield i.getMosaicItem(r.cim);return(0,bt.ok)(n,Rt)?Ht.fromCIMFill(r,n,i._tileInfo):i._fillError})()}_createCIMLine(r){var i=this;return(0,j.Z)(function*(){const{spriteMosaicItem:n}=yield i.getMosaicItem(r.cim);return(0,bt.ok)(n,Rt)?Yt.fromCIMLine(r,n,i._tileInfo):i._lineError})()}_createCIMMarker(r){var i=this;return(0,j.Z)(function*(){const{spriteMosaicItem:n}=yield i.getMosaicItem(r.cim);return(0,bt.ok)(n,Rt)?re.Z.fromCIMMarker(r,n,i._tileInfo):i._markerError})()}_createCIM(r){var i=this;return(0,j.Z)(function*(){const n=r.templateHash;if(i._cimTemplateCache.has(n))return i._cimTemplateCache.get(n);const s=oe(ne({},r),{cim:oe(ne({},r.cim),{mosaicHash:r.materialHash})});let h;switch(s.type){case"marker":h=i._createCIMMarker(s);break;case"line":h=i._createCIMLine(s);break;case"fill":h=i._createCIMFill(s);break;case"text":h=i._createCIMText(s)}return h.then(u=>i._cimTemplateCache.set(n,u)),h})()}_createDynamicCIM(r){const i=r.templateHash;if(this._cimTemplateCache.has(i))return this._cimTemplateCache.get(i);let n;switch(r.type){case"marker":n=he.fromCIMMarker(r,this._tileInfo);break;case"line":n=le.fromCIMLine(r,this._tileInfo);break;case"fill":n=ae.fromCIMFill(r,this._tileInfo);break;case"text":n=ce.fromCIMText(r,this._tileInfo)}return this._cimTemplateCache.set(i,n),n}_createPrimitiveMeshTemplates(r,i,n){switch(i.type){case"esriSMS":return Nt(r,this._createSMS(i));case"esriPMS":return Nt(r,this._createPMS(i));case"esriSFS":return Nt(r,this._createSFS(i,n));case"line-marker":return Nt(r,this._createLMS(i));case"esriPFS":return Nt(r,this._createPFS(i,n));case"esriSLS":return Nt(r,this._createSLS(i,!1));case"esriTS":return Nt(r,this._createTS(i));default:return Rt.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),r}}_createMeshTemplates(r,i,n){if(-1!==i.type.indexOf("3d"))return Rt.error("3D symbols are not supported with MapView"),r;if("expanded-cim"===i.type){for(const s of i.layers)"function"==typeof s.materialHash?r.push(this._createDynamicCIM(s)):Nt(r,this._createCIM(s));return r}if("composite-symbol"===i.type){for(const s of i.layers)this._createPrimitiveMeshTemplates(r,s,n);return r}return"cim"===i.type||"label"===i.type||"web-style"===i.type?r:this._createPrimitiveMeshTemplates(r,i,n)}}},41814:(Lt,ht,d)=>{d.d(ht,{Z:()=>m});var j=d(12788),ot=d(75335),st=d(22806),z=d(99155),X=d(1452),R=d(21194),P=d(78380),Y=d(24588),B=d(12867),at=d(83704);class m extends((0,Y.Z)(B.Z)){constructor(l,M,w,J,A,I,y,L,U,k,H,q,lt,ft,Mt,Tt,yt,W=!1,N,Q){super(),this._xOffset=(0,j.F2)(q),this._yOffset=(0,j.F2)(lt),this._decoration=U||"none",this._color=J,this._haloColor=A,this._haloSize=Math.min(Math.floor(5*(0,j.F2)((0,j.t_)(w))),127),this._size=Math.min(Math.round((0,j.F2)(M)),127);const b=Math.min(Math.round((0,j.F2)(M)),127);this._referenceSize=Math.round(Math.sqrt(256*b)),this._scale=this._size/24,this._angle=H,this._justify=(0,ot.Hd)(I||"center"),this._xAlignD=(0,ot.kH)(I||"center"),this._yAlignD=(0,ot.b7)(y||"baseline"),this._baseline="baseline"===(y||"baseline"),this._bitset=(1===L?1:0)|(k?1:0)<<1;const it=R.m2.load(l);it.sdf=!0,this._materialKey=it.data,this._lineWidth=(0,j.F2)(ft)||512,this._lineHeight=Mt||1,this._textPlacement=Tt,this._effects=yt,this._isCIM=W,this._minMaxZoom=(0,X.UJ)(Math.round(N*z.MI),Math.round(Q*z.MI))}static fromText(l,M){const w=new m(l.materialKey,l.font.size,l.haloSize||0,l.color&&(0,st.aH)(l.color)||0,l.haloColor&&(0,st.aH)(l.haloColor)||0,l.horizontalAlignment,l.verticalAlignment,0,l.font.decoration,!1,l.angle||0,l.xoffset,l.yoffset,l.lineWidth,l.lineHeight,null,null,!1,P.Xe,P.eW),[,J]=(0,at.E)(l.text);return w.bindTextInfo(M,J),w._vertexBoundsScale=l.maxVVSize?l.maxVVSize/l.font.size:1,w}static fromCIMText(l,M,w){const J=l.scaleFactor||1,A=l.size*l.sizeRatio*J,[I,y]=(0,P._f)(l.scaleInfo,w),L=new m(l.materialKey,A,l.outlineSize*l.sizeRatio,(0,st.t2)(l.color),(0,st.t2)(l.outlineColor),l.horizontalAlignment,l.verticalAlignment,l.alignment,l.decoration,l.colorLocked,l.angle,l.offsetX*l.sizeRatio*J,l.offsetY*l.sizeRatio*J,512,1,l.markerPlacement,l.effects,!0,I,y),[,U]=(0,at.E)(l.text);return L.bindTextInfo(M,U),L._vertexBoundsScale=l.maxVVSize?l.maxVVSize/A:1,L}}},78380:(Lt,ht,d)=>{d.d(ht,{eW:()=>ot,Xe:()=>j,TK:()=>R,NW:()=>Y,_f:()=>x,mf:()=>P,Fv:()=>X,lu:()=>st});const j=0,ot=100;function st(l,M,w){return l[0]=M[0]-w[0],l[1]=M[1]-w[1],l}function z(l,M){return Math.sqrt(l*l+M*M)}function X(l){const M=z(l[0],l[1]);l[0]/=M,l[1]/=M}function R(l,M){return z(l[0]-M[0],l[1]-M[1])}function P(l){return"function"==typeof l}function Y(l=2){return 1/Math.max(l,1)}function x(l,M){return[!!l.minScale&&M.scaleToZoom(l.minScale)||j,!!l.maxScale&&M.scaleToZoom(l.maxScale)||ot]}},34238:(Lt,ht,d)=>{d.d(ht,{fL:()=>K});var j=d(61921),ot=d(22795),st=d(33870),z=d(88955),X=d(8982),R=d(34119),P=d(60194),Y=d(40602),B=d(15691);const at=st.Z.getLogger("esri/views/2d/engine/webgl/util/Matcher");function K(I,y,L){return mt.apply(this,arguments)}function mt(){return(mt=(0,j.Z)(function*(I,y,L){switch(I.type){case"simple":return m.fromBasicRenderer(I,y,L);case"map":return M.fromUVRenderer(I,y,L);case"interval":return l.fromCBRenderer(I,y,L);case"dictionary":return A.fromDictionaryRenderer(I,y,L);case"subtype":return x.fromSubtypes(I,y,L)}})).apply(this,arguments)}class m{constructor(){this.type="feature",this._defaultResult=null}static fromBasicRenderer(y,L,U){return(0,j.Z)(function*(){const k=new m;if(y.symbol){const H=yield(0,R.B)(y.symbol,U),q=L.createTemplateGroup(H,null);k.setDefault(q)}return k})()}size(){return 1}getDefault(){return this._defaultResult}setDefault(y){this._defaultResult=y}match(y,L,U,k,H){return this.getDefault()}analyze(y,L,U,k,H){return(0,j.Z)(function*(){return null})()}}class x extends m{constructor(y,L){super(),this._subMatchers=y,this._subtypeField=L}static fromSubtypes(y,L,U){return(0,j.Z)(function*(){const k=new Map,H=[];for(const q in y.renderers){const lt=parseInt(q,10),ft=K(y.renderers[q],L,U).then(Mt=>k.set(lt,Mt));H.push(ft)}return yield Promise.all(H),new x(k,y.subtypeField)})()}match(y,L,U,k,H){const q=L.readAttribute(this._subtypeField),lt=this._subMatchers.get(q);return lt?lt.match(y,L,U,k,H):null}}class l extends m{constructor(y,L,U,k){super(),this.type="interval",this._intervals=[],this._isMaxInclusive=L,this._fieldIndex=k,this._field=y,this._normalizationInfo=U}static fromCBRenderer(y,L,U){return(0,j.Z)(function*(){const{isMaxInclusive:k,normalizationField:H,normalizationTotal:q,normalizationType:lt}=y,Mt=new l(y.field,k,{normalizationField:H,normalizationTotal:q,normalizationType:lt},y.fieldIndex),Tt=yield(0,R.B)(y.backgroundFillSymbol,U);yield Promise.all(y.intervals.map(function(){var W=(0,j.Z)(function*(N){const Q=yield(0,R.B)(N.symbol,U),b=yield L.createTemplateGroup(Q,Tt);Mt.add({min:N.min,max:N.max},b)});return function(N){return W.apply(this,arguments)}}()));const yt=yield(0,R.B)(y.defaultSymbol,U);if(yt){const W=yield L.createTemplateGroup(yt,Tt);Mt.setDefault(W)}return Mt})()}add(y,L){this._intervals.push({interval:y,result:L}),this._intervals.sort((U,k)=>U.interval.min-k.interval.min)}size(){return super.size()+this._intervals.length}match(y,L,U,k,H){if(null==this._fieldIndex&&!this._field)return this.getDefault();const q=null!=this._fieldIndex?L.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(L);if(!q&&(null==q||isNaN(q)))return this.getDefault();for(let lt=0;lt<this._intervals.length;lt++){const{interval:ft,result:Mt}=this._intervals[lt],yt=this._isMaxInclusive?q<=ft.max:q<ft.max;if(q>=ft.min&&yt)return Mt}return this.getDefault()}_needsNormalization(){const y=this._normalizationInfo;return y&&(y.normalizationField||y.normalizationTotal||y.normalizationType)}_getValueFromField(y){const L=y.readAttribute(this._field);if(!this._needsNormalization()||null==L)return L;const{normalizationField:U,normalizationTotal:k,normalizationType:H}=this._normalizationInfo,q=!!U&&y.readAttribute(U);if(H)switch(H){case"esriNormalizeByField":return q?L/q:void 0;case"esriNormalizeByLog":return Math.log(L)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return L/k*100;default:return void at.error(`Found unknown normalization type: ${H}`)}else at.error("Normalization is required, but no type was set!")}}class M extends m{constructor(y,L,U){super(),this.type="map",this._nullResult=null,this._resultsMap=new Map,this._fieldsIndex=U,this._fields=y,this._seperator=L||""}static fromUVRenderer(y,L,U){return(0,j.Z)(function*(){const k=y.fieldDelimiter,H=[y.field];y.field2&&H.push(y.field2),y.field3&&H.push(y.field3);const q=yield(0,R.B)(y.backgroundFillSymbol,U),lt=new M(H,k,y.fieldIndex);yield Promise.all(y.map.map(function(){var Mt=(0,j.Z)(function*(Tt){const yt=yield(0,R.B)(Tt.symbol,U),W=yield L.createTemplateGroup(yt,q);"<Null>"===Tt.value?lt.setNullResult(W):lt.add(Tt.value,W)});return function(Tt){return Mt.apply(this,arguments)}}()));const ft=yield(0,R.B)(y.defaultSymbol,U);if(ft){const Mt=yield L.createTemplateGroup(ft,q);lt.setDefault(Mt)}return lt})()}setNullResult(y){this._nullResult=y}add(y,L){this._resultsMap.set(y.toString(),L)}size(){return super.size()+this._resultsMap.size}match(y,L,U,k,H){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const q=null!=this._fieldsIndex?L.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(L);if(null!==this._nullResult&&(null==q||""===q||"<Null>"===q))return this._nullResult;if(!q&&null==q)return this.getDefault();const lt=q.toString();return this._resultsMap.has(lt)?this._resultsMap.get(lt):this.getDefault()}_getValueFromFields(y){const L=[];for(const U of this._fields){const k=y.readAttribute(U);L.push(null==k||""===k?"<Null>":k)}return L.join(this._seperator)}}function J(){return(J=(0,j.Z)(function*(I,y){const L=I||1;if("number"==typeof L)return(k,H,q)=>L;const U=yield(0,X.Yi)(L,y.spatialReference,y.fields);return(k,H,q)=>(0,Y.Z)(U,k,{$view:q},y.geometryType,H)||1})).apply(this,arguments)}class A extends m{constructor(y,L,U,k){super(),this.type="dictionary",this._groupIdCache=new z.Z(100),this._renderer=y,this._fieldMap=y.fieldMap,this._symbolFields=y.getSymbolFields(),this._templates=L,this._info=U,this._scaleFn=k}static fromDictionaryRenderer(y,L,U){return(0,j.Z)(function*(){const k=(yield Promise.resolve().then(d.bind(d,45594))).default.fromJSON(y.renderer);yield k.fetchResources({spatialReference:U.spatialReference,fields:U.fields});const H=yield function(I,y){return J.apply(this,arguments)}(k.scaleExpression,U);return new A(k,L,U,H)})()}_analyzeFeature(y,L,U,k){var H=this;return(0,j.Z)(function*(){const q=y.readLegacyFeature(),lt=H._scaleFn(q,L,U),ft=H._attributeHash(q)+"-"+lt,Mt=H._groupIdCache.get(ft);if(Mt)return Mt;const Tt=oe(ne({},U),{spatialReference:H._info.spatialReference,abortOptions:k,fields:H._info.fields}),yt=yield H._renderer.getSymbolAsync(q,Tt),W=(0,B.PY)(yt,H._renderer),N=(0,R.B)(W,H._info,k).then(Q=>{if("expanded-cim"!==Q.type)return at.error(new ot.Z("mapview-bad-type",`Found unexpected type ${Q.type} in dictionary response`)),null;Q.hash+="-"+lt;for(const b of Q.layers)b.scaleFactor=lt,b.templateHash+="-"+lt,"text"===b.type&&"string"==typeof b.text&&b.text.indexOf("[")>-1&&(b.text=(0,P.Qs)(H._fieldMap,b.text,b.cim.textCase));return H._templates.createTemplateGroup(Q,null)});return H._groupIdCache.put(ft,N,1),N})()}analyze(y,L,U,k,H){var q=this;return(0,j.Z)(function*(){const lt=L.getCursor(),ft=[];for(;lt.next();)ft.push(q._analyzeFeature(lt,U,k,H));return Promise.all(ft)})()}match(y,L,U,k,H){return null}_attributeHash(y){let L="";for(const U of this._symbolFields){const k=this._fieldMap[U];k&&(L+=y.attributes[k]+"-")}return L}}},7409:(Lt,ht,d)=>{d.d(ht,{ok:()=>ot});var j=d(22795);function ot(st,z){if(st&&"name"in st){const X=st;return z&&z.error(new j.Z(X.name,X.message,X.details)),!1}return!0}},19839:(Lt,ht,d)=>{d.d(ht,{Z:()=>ot});class ot{constructor(z,X){this._pos=0;const R=X?this._roundToNearest(X,z.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(R),this._buffer=new z(this._array),this._ctor=z,this._i16View=new Int16Array(this._array)}get length(){return this._pos}_roundToNearest(z,X){const R=Math.round(z);return R+(X-R%X)}_ensureSize(z){if(this._pos+z>=this._buffer.length){const X=this._roundToNearest(1.5*(this._array.byteLength+z*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),R=new ArrayBuffer(X),P=new this._ctor(R);P.set(this._buffer,0),this._array=R,this._buffer=P,this._i16View=new Int16Array(this._array)}}ensureSize(z){this._ensureSize(z)}writeF32(z){this._ensureSize(1);const X=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=z,this._pos++,X}push(z){this._ensureSize(1);const X=this._pos;return this._buffer[this._pos++]=z,X}writeFixed(z){this._buffer[this._pos++]=z}setValue(z,X){this._buffer[z]=X}i1616Add(z,X,R){this._i16View[2*z]+=X,this._i16View[2*z+1]+=R}getValue(z){return this._buffer[z]}incr(z){if(this._buffer.length<z)throw new Error("Increment index overflows the target buffer");this._buffer[z]++}decr(z){this._buffer[z]--}writeRegion(z){this._ensureSize(z.length);const X=this._pos;return this._buffer.set(z,this._pos),this._pos+=z.length,X}writeManyFrom(z,X,R){this._ensureSize(R-X);for(let P=X;P!==R;P++)this.writeFixed(z._buffer[P])}buffer(){const z=this._array.slice(0,4*this._pos);return this.destroy(),z}toArray(){const z=this._array,X=[];for(let R=0;R<z.byteLength/4;R++)X.push(z[R]);return X}seek(z){this._pos=z}destroy(){this._array=null,this._buffer=null}}},5082:(Lt,ht,d)=>{function st(z,X,R,P){const Y=z.clone(),B=1<<Y.level,at=Y.col+X,K=Y.row+R;return P&&at<0?(Y.col=at+B,Y.world-=1):at>=B?(Y.col=at-B,Y.world+=1):Y.col=at,Y.row=K,Y}d.d(ht,{M:()=>st}),d(25644)},38519:(Lt,ht,d)=>{function j(ot){const st=new Array(ot.length);for(let z=0;z<ot.length;z++)st[z]=ot.charCodeAt(z);return st}d.d(ht,{_:()=>j})}}]);