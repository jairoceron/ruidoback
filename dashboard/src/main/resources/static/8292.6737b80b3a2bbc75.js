"use strict";(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[8292],{16174:(T,g,t)=>{t.d(g,{eY:()=>C});var c=t(60305),o=t(19554),E=t(61274),n=t(3878),_=(t(26436),t(27001),t(67474),t(36320),t(40150),t(94345),t(82705),t(13006)),d=(t(48082),t(66505)),P=t(28644);function O(f,r,h){const m={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return r&&h&&(m.width=r,m.height=h),new _.Z(f,m)}class C extends d.s{constructor(r=null,h,m=!0){super(),this.requestRenderOnSourceChangedEnabled=m,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.blendFunction=h,this.source=r,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(r){this._height=r}get source(){return this._source}set source(r){this._source=r,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(r){this._width=r}beforeRender(r){super.beforeRender(r),this.updateTexture(r.context)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}_createTransforms(){return{dvs:(0,E.c)()}}setTransform(r){const h=(0,o.b)(this.transforms.dvs),[m,y]=r.toScreenNoRotation([0,0],[this.x,this.y]),B=this.resolution/this.pixelRatio/r.resolution,D=B*this.width,M=B*this.height,b=Math.PI*this.rotation/180;(0,o.c)(h,h,(0,n.f)(m,y)),(0,o.c)(h,h,(0,n.f)(D/2,M/2)),(0,o.r)(h,h,-b),(0,o.c)(h,h,(0,n.f)(-D/2,-M/2)),(0,o.j)(h,h,(0,n.f)(D,M)),(0,o.m)(this.transforms.dvs,r.displayViewMat3,h)}setSamplingProfile(r){this._texture&&(r.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(r.samplingMode))}bind(r,h){this._texture&&r.bindTexture(this._texture,h)}updateTexture(r){var h;if(!this.stage)return null==(h=this._texture)||h.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this._texture=this.source?O(r,this.sourceWidth,this.sourceHeight):O(r));const m=this.source;if(m){if(this._texture.resize(this.sourceWidth,this.sourceHeight),(f=m)&&"render"in f)if(m instanceof P.Z){const y=m.getRenderedRasterPixels();this._texture.setData((0,c.pC)(y)?y.renderedRasterPixels:null)}else this._texture.setData(function(f){const r=document.createElement("canvas");return r.width=f.width,r.height=f.height,f.render(r.getContext("2d")),r}(m));else(function(f){return f&&!("render"in f)})(m)&&this._texture.setData(m);this.ready()}else this._texture.setData(null);var f}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}},40729:(T,g,t)=>{t.d(g,{s:()=>i});var c=t(13638),o=t(61274),E=t(16174),n=t(96620);class p extends n.I{constructor(e,_,s,d,P,v=null){super(e,_,s,d,P),this.bitmap=new E.eY(v,"standard",!1),this.bitmap.coordScale=[d,P],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(e){super.beforeRender(e),this.bitmap.beforeRender(e)}afterRender(e){super.afterRender(e),this.bitmap.afterRender(e)}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{dvs:(0,o.c)(),tileMat3:(0,o.c)()}}setTransform(e,_){super.setTransform(e,_),this.bitmap.transforms.dvs=this.transforms.dvs}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}var l=t(56109),x=t(38963),u=t(79337);class i extends u.Z{get requiresDedicatedFBO(){return this.children.some(e=>"additive"===e.bitmap.blendFunction)}createTile(e){const _=this._tileInfoView.getTileBounds((0,c.Ue)(),e),[s,d]=this._tileInfoView.tileInfo.size;return new p(e,_[0],_[3],s,d)}destroyTile(){}prepareRenderPasses(e){const _=e.registerRenderPass({name:"bitmap (tile)",brushes:[l.U.bitmap],target:()=>this.children.map(s=>s.bitmap),drawPhase:x.jx.MAP});return[...super.prepareRenderPasses(e),_]}doRender(e){this.visible&&e.drawPhase===x.jx.MAP&&super.doRender(e)}}},28644:(T,g,t)=>{t.d(g,{Z:()=>o});var c=t(60305);class o{constructor(n,p,l){this.pixelBlock=n,this.extent=p,this.originalPixelBlock=l}get width(){return(0,c.pC)(this.pixelBlock)?this.pixelBlock.width:0}get height(){return(0,c.pC)(this.pixelBlock)?this.pixelBlock.height:0}render(n){const p=this.pixelBlock;if((0,c.Wi)(p))return;const l=this.filter({pixelBlock:p});if((0,c.Wi)(l.pixelBlock))return;const x=l.pixelBlock.getAsRGBA(),u=n.createImageData(l.pixelBlock.width,l.pixelBlock.height);u.data.set(x),n.putImageData(u,0,0)}getRenderedRasterPixels(){const n=this.filter({pixelBlock:this.pixelBlock});return(0,c.Wi)(n.pixelBlock)?null:{width:n.pixelBlock.width,height:n.pixelBlock.height,renderedRasterPixels:new Uint8Array(n.pixelBlock.getAsRGBA().buffer)}}}},79337:(T,g,t)=>{t.d(g,{Z:()=>x});var c=t(67474),o=t(38963),E=t(91099),n=t(86932),p=t(3953);const l=(u,i)=>u.key.level-i.key.level!=0?u.key.level-i.key.level:u.key.row-i.key.row!=0?u.key.row-i.key.row:u.key.col-i.key.col;class x extends E.Z{constructor(i){super(),this._tileInfoView=i}get requiresDedicatedFBO(){return!1}renderChildren(i){this.sortChildren(l),this.setStencilReference(),super.renderChildren(i)}createRenderParams(i){const{state:a}=i,e=super.createRenderParams(i);return e.requiredLevel=this._tileInfoView.getClosestInfoForScale(a.scale).level,e.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(a.scale),e}prepareRenderPasses(i){const a=super.prepareRenderPasses(i);return a.push(i.registerRenderPass({name:"stencil",brushes:[p.Z],drawPhase:o.jx.DEBUG|o.jx.MAP|o.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,c.Z)("esri-tiles-debug")&&a.push(i.registerRenderPass({name:"tileInfo",brushes:[n.Z],drawPhase:o.jx.DEBUG,target:()=>this.children})),a}getStencilTarget(){return this.children}updateTransforms(i){for(const a of this.children){const e=this._tileInfoView.getTileResolution(a.key);a.setTransform(i,e)}}setStencilReference(){let i=1;for(const a of this.children)a.stencilRef=i++}}},96620:(T,g,t)=>{t.d(g,{I:()=>n});var c=t(19554),o=t(66505),E=t(6525);class n extends o.s{constructor(l,x,u,i,a,e=i,_=a){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new E.Z(l),this.x=x,this.y=u,this.width=i,this.height=a,this.rangeX=e,this.rangeY=_}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(l,x){const u=x/(l.resolution*l.pixelRatio),i=this.transforms.tileMat3,[a,e]=l.toScreenNoRotation([0,0],[this.x,this.y]);(0,c.s)(i,this.width/this.rangeX*u,0,0,0,this.height/this.rangeY*u,0,a,e,1),(0,c.m)(this.transforms.dvs,l.displayViewMat3,i)}}},28292:(T,g,t)=>{t.r(g),t.d(g,{default:()=>_});var c=t(60046),l=(t(9077),t(67474),t(57025),t(33870),t(42442)),x=t(39605),u=t(40729),i=t(94584);class a{constructor(){this.gradient=null,this.height=512,this.width=512}render(d){(0,x.hy)(d,512,this.intensities,this.gradient,this.minPixelIntensity,this.maxPixelIntensity)}}let e=class extends i.Z{constructor(s){super(s),this._intensityInfo={minPixelIntensity:0,maxPixelIntensity:0},this.featuresView={attributeView:{initialize:()=>{},requestUpdate:()=>{}},requestRender:()=>{}},this._container=new u.s(s.tileInfoView)}createTile(s){const d=this._container.createTile(s);return this.tileInfoView.getTileCoords(d.bitmap,s),d.bitmap.resolution=this.tileInfoView.getTileResolution(s),d}onConfigUpdate(){const s=this.layer.renderer;if("heatmap"===s.type){const{minPixelIntensity:d,maxPixelIntensity:P}=s;this._intensityInfo.minPixelIntensity=d,this._intensityInfo.maxPixelIntensity=P,this._gradient=(0,x.uI)(s.toJSON()),this.tiles.forEach(v=>{const R=v.bitmap.source;R&&(R.minPixelIntensity=d,R.maxPixelIntensity=P,R.gradient=this._gradient,v.bitmap.invalidateTexture())})}}hitTest(){return Promise.resolve([])}install(s){s.addChild(this._container)}uninstall(s){this._container.removeAllChildren(),s.removeChild(this._container)}disposeTile(s){this._container.removeChild(s),s.destroy()}supportsRenderer(s){return s&&"heatmap"===s.type}onTileData(s){const d=this.tiles.get(s.tileKey);if(!d)return;const P=s.intensityInfo,{minPixelIntensity:v,maxPixelIntensity:R}=this._intensityInfo,I=d.bitmap.source||new a;I.intensities=P&&P.matrix||null,I.minPixelIntensity=v,I.maxPixelIntensity=R,I.gradient=this._gradient,d.bitmap.source=I,this._container.addChild(d),this.requestUpdate()}onTileError(s){console.error(s)}lockGPUUploads(){}unlockGPUUploads(){}};e=(0,c._)([(0,l.j)("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],e);var _=e}}]);