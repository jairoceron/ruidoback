"use strict";(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[524],{20524:(de,V,I)=>{I.r(V),I.d(V,{registerFunctions:()=>ue});var W=I(99771),P=I(96171),b=I(67155),H=I(31126),O=I(65949),a=I(71655),h=I(99027),z=I(36113),te=I(1698),ne=I(6053),re=I(52825),ae=I(5864),se=I(78389),B=I(72596),X=I(32826),j=I(16481),C=I(12523),_=I(41122),U=I(71221),v=I(12656);function Z(t,r,m){const p=t.getVariables();if(p.length>0){const F=[];for(let e=0;e<p.length;e++)F.push(r.evaluateIdentifier(m,{name:p[e]}));return(0,C.$6)(F).then(e=>{const i={};for(let s=0;s<p.length;s++)i[p[s]]=e[s];return t.parameters=i,t})}return(0,C.DB)(t)}function c(t,r,m=null){for(const p in t)if(p.toLowerCase()===r.toLowerCase())return t[p];return m}function J(t){if(null===t)return null;const r={type:c(t,"type",""),name:c(t,"name","")};if("range"===r.type)r.range=c(t,"range",[]);else{r.codedValues=[];for(const m of c(t,"codedValues",[]))r.codedValues.push({name:c(m,"name",""),code:c(m,"code",null)})}return r}function K(t){if(null===t)return null;const r={},m=c(t,"wkt",null);null!==m&&(r.wkt=m);const p=c(t,"wkid",null);return null!==p&&(r.wkid=p),r}function M(t){if(null===t)return null;const r={hasZ:c(t,"hasz",!1),hasM:c(t,"hasm",!1)},m=c(t,"spatialreference",null);m&&(r.spatialReference=K(m));const p=c(t,"x",null);if(null!==p)return r.x=p,r.y=c(t,"y",null),r;const F=c(t,"rings",null);if(null!==F)return r.rings=F,r;const e=c(t,"paths",null);if(null!==e)return r.paths=e,r;const i=c(t,"points",null);if(null!==i)return r.points=i,r;for(const s of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const u=c(t,s,null);null!==u&&(r[s]=u)}return r}function ue(t){"async"===t.mode&&(t.functions.getuser=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>{(0,a.p)(e,1,2);let i=(0,a.C)(e[1],""),s=!0===i;if(i=!0===i||!1===i?"":(0,a.d)(i),e[0]instanceof W.Z){let y=null;return r.services&&r.services.portal&&(y=r.services.portal),y=(0,O.getPortal)(e[0],y),(0,O.lookupUser)(y,i,s).then(o=>{if(o){const l=JSON.parse(JSON.stringify(o));for(const n of["lastLogin","created","modified"])null!=l[n]&&(l[n]=new Date(l[n]));return P.Z.convertObjectToArcadeDictionary(l)}return null})}let u=null;if((0,a.o)(e[0])&&(u=e[0]),u)return s=!1,i?null:u.load().then(()=>u.getOwningSystemUrl()).then(y=>{if(!y)return i?null:u.getIdentityUser().then(l=>l?P.Z.convertObjectToArcadeDictionary({username:l}):null);let o=null;return r.services&&r.services.portal&&(o=r.services.portal),o=(0,O.getPortal)(new W.Z(y),o),(0,O.lookupUser)(o,i,s).then(l=>{if(l){const n=JSON.parse(JSON.stringify(l));for(const f of["lastLogin","created","modified"])null!=n[f]&&(n[f]=new Date(n[f]));return P.Z.convertObjectToArcadeDictionary(n)}return null})});throw new Error("Invalid Parameter")})},t.signatures.push({name:"getuser",min:"1",max:"2"}),t.functions.featuresetbyid=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>{if((0,a.p)(e,2,4),e[0]instanceof H.Z){const i=(0,a.d)(e[1]);let s=(0,a.C)(e[2],null);const u=(0,a.u)((0,a.C)(e[3],!0));if(null===s&&(s=["*"]),!1===(0,a.a)(s))throw new Error("Invalid Parameter");return e[0].featureSetById(i,u,s)}throw new Error("Invalid Parameter")})},t.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),t.functions.getfeatureset=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>{if((0,a.p)(e,1,2),e[0]instanceof b.Z){let i=(0,a.C)(e[1],"datasource");return null===i&&(i="datasource"),i=(0,a.d)(i).toLowerCase(),(0,O.convertToFeatureSet)(e[0]._layer,i,r.lrucache,r.interceptor,r.spatialReference)}throw new Error("Invalid Parameter")})},t.signatures.push({name:"getfeatureset",min:"1",max:"2"}),t.functions.featuresetbyportalitem=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>{if((0,a.p)(e,2,5),null===e[0])throw new Error("Portal is required");if(e[0]instanceof W.Z){const o=(0,a.d)(e[1]),l=(0,a.d)(e[2]);let n=(0,a.C)(e[3],null);const f=(0,a.u)((0,a.C)(e[4],!0));if(null===n&&(n=["*"]),!1===(0,a.a)(n))throw new Error("Invalid Parameter");let d=null;return r.services&&r.services.portal&&(d=r.services.portal),d=(0,O.getPortal)(e[0],d),(0,O.constructFeatureSetFromPortalItem)(o,l,r.spatialReference,n,f,d,r.lrucache,r.interceptor)}if(!1===(0,a.f)(e[0]))throw new Error("Portal is required");const i=(0,a.d)(e[0]),s=(0,a.d)(e[1]);let u=(0,a.C)(e[2],null);const y=(0,a.u)((0,a.C)(e[3],!0));if(null===u&&(u=["*"]),!1===(0,a.a)(u))throw new Error("Invalid Parameter");if(r.services&&r.services.portal)return(0,O.constructFeatureSetFromPortalItem)(i,s,r.spatialReference,u,y,r.services.portal,r.lrucache,r.interceptor);throw new Error("Portal is required")})},t.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),t.functions.featuresetbyname=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>{if((0,a.p)(e,2,4),e[0]instanceof H.Z){const i=(0,a.d)(e[1]);let s=(0,a.C)(e[2],null);const u=(0,a.u)((0,a.C)(e[3],!0));if(null===s&&(s=["*"]),!1===(0,a.a)(s))throw new Error("Invalid Parameter");return e[0].featureSetByName(i,u,s)}throw new Error("Invalid Parameter")})},t.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),t.functions.featureset=function(r,m){return t.standardFunction(r,m,(p,F,e)=>{(0,a.p)(e,1,1);let i=e[0];const s={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if((0,a.f)(i))i=JSON.parse(i),void 0!==i.layerDefinition?(s.layerDefinition=i.layerDefinition,s.featureSet=i.featureSet,i.layerDefinition.spatialReference&&(s.layerDefinition.spatialReference=i.layerDefinition.spatialReference)):(s.featureSet.features=i.features,s.featureSet.geometryType=i.geometryType,s.layerDefinition.geometryType=s.featureSet.geometryType,s.layerDefinition.objectIdField=i.objectIdFieldName,s.layerDefinition.typeIdField=i.typeIdFieldName,s.layerDefinition.globalIdField=i.globalIdFieldName,s.layerDefinition.fields=i.fields,i.spatialReference&&(s.layerDefinition.spatialReference=i.spatialReference));else{if(!(e[0]instanceof P.Z))throw new Error("Invalid Parameter");{i=JSON.parse(e[0].castToText());const u=c(i,"layerdefinition");if(null!==u){s.layerDefinition.geometryType=c(u,"geometrytype",""),s.featureSet.geometryType=s.layerDefinition.geometryType,s.layerDefinition.globalIdField=c(u,"globalidfield",""),s.layerDefinition.objectIdField=c(u,"objectidfield",""),s.layerDefinition.typeIdField=c(u,"typeidfield","");const y=c(u,"spatialreference",null);y&&(s.layerDefinition.spatialReference=K(y));for(const l of c(u,"fields",[])){const n={name:c(l,"name",""),alias:c(l,"alias",""),type:c(l,"type",""),nullable:c(l,"nullable",!0),editable:c(l,"editable",!0),length:c(l,"length",null),domain:J(c(l,"domain"))};s.layerDefinition.fields.push(n)}const o=c(i,"featureset",null);if(o){const l={};for(const n of s.layerDefinition.fields)l[n.name.toLowerCase()]=n.name;for(const n of c(o,"features",[])){const f={},d=c(n,"attributes",{});for(const D in d)f[l[D.toLowerCase()]]=d[D];s.featureSet.features.push({attributes:f,geometry:M(c(n,"geometry",null))})}}}else{s.layerDefinition.geometryType=c(i,"geometrytype",""),s.featureSet.geometryType=s.layerDefinition.geometryType,s.layerDefinition.objectIdField=c(i,"objectidfieldname",""),s.layerDefinition.typeIdField=c(i,"typeidfieldname","");const y=c(i,"spatialreference",null);y&&(s.layerDefinition.spatialReference=K(y));for(const l of c(i,"fields",[])){const n={name:c(l,"name",""),alias:c(l,"alias",""),type:c(l,"type",""),nullable:c(l,"nullable",!0),editable:c(l,"editable",!0),length:c(l,"length",null),domain:J(c(l,"domain"))};s.layerDefinition.fields.push(n)}const o={};for(const l of s.layerDefinition.fields)o[l.name.toLowerCase()]=l.name;for(const l of c(i,"features",[])){const n={},f=c(l,"attributes",{});for(const d in f)n[o[d.toLowerCase()]]=f[d];s.featureSet.features.push({attributes:n,geometry:M(c(l,"geometry",null))})}}}}if(!1===function(t){return!!t.layerDefinition&&!!t.featureSet&&!1!==function(t,r){for(const m of["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])if(m===t)return!0;return!1}(t.layerDefinition.geometryType)&&null!==t.layerDefinition.objectIdField&&""!==t.layerDefinition.objectIdField&&!1!==(0,a.a)(t.layerDefinition.fields)&&!1!==(0,a.a)(t.featureSet.features)}(s))throw new Error("Invalid Parameter");return ae.Z.create(s,r.spatialReference)})},t.signatures.push({name:"featureset",min:"1",max:"1"}),t.functions.filter=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>((0,a.p)(e,2,2),(0,a.o)(e[0])?e[0].load().then(i=>{const s=_.WhereClause.create(e[1],i.getFieldsIndex()),u=s.getVariables();if(u.length>0){const y=[];for(let o=0;o<u.length;o++)y.push(t.evaluateIdentifier(r,{name:u[o]}));return(0,C.$6)(y).then(o=>{const l={};for(let n=0;n<u.length;n++)l[u[n]]=o[n];return s.parameters=l,new z.Z({parentfeatureset:e[0],whereclause:s})})}return(0,C.DB)(new z.Z({parentfeatureset:e[0],whereclause:s}))}):t.failDefferred("Filter cannot accept this parameter type")))},t.signatures.push({name:"filter",min:"2",max:"2"}),t.functions.orderby=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>{if((0,a.p)(e,2,2),(0,a.o)(e[0])){const i=new se.Z(e[1]);return(0,C.DB)(new te.Z({parentfeatureset:e[0],orderbyclause:i}))}return t.failDefferred("Order cannot accept this parameter type")})},t.signatures.push({name:"orderby",min:"2",max:"2"}),t.functions.top=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>((0,a.p)(e,2,2),(0,a.o)(e[0])?(0,C.DB)(new ne.Z({parentfeatureset:e[0],topnum:e[1]})):(0,a.a)(e[0])?(0,a.t)(e[1])>=e[0].length?e[0].slice(0):e[0].slice(0,(0,a.t)(e[1])):(0,a.b)(e[0])?(0,a.t)(e[1])>=e[0].length()?e[0].slice(0):e[0].slice(0,(0,a.t)(e[1])):t.failDefferred("Top cannot accept this parameter type")))},t.signatures.push({name:"top",min:"2",max:"2"}),t.functions.first=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>((0,a.p)(e,1,1),(0,a.o)(e[0])?e[0].first(p.abortSignal).then(i=>{if(null!==i){const s=b.Z.createFromGraphicLikeObject(i.geometry,i.attributes,e[0]);s._underlyingGraphic=i,i=s}return i}):(0,a.a)(e[0])?(0,C.DB)(0===e[0].length?null:e[0][0]):(0,a.b)(e[0])?0===e[0].length()?(0,C.DB)(null):(0,C.DB)(e[0].get(0)):null))},t.signatures.push({name:"first",min:"1",max:"1"}),t.functions.attachments=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>{(0,a.p)(e,1,2);const i={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1)if(e[1]instanceof P.Z){if(e[1].hasField("minsize")&&(i.minsize=(0,a.t)(e[1].field("minsize"))),e[1].hasField("metadata")&&(i.returnMetadata=(0,a.u)(e[1].field("metadata"))),e[1].hasField("maxsize")&&(i.maxsize=(0,a.t)(e[1].field("maxsize"))),e[1].hasField("types")){const s=(0,a.T)(e[1].field("types"),!1);s.length>0&&(i.types=s)}}else if(null!==e[1])throw new Error("Invalid Parameter");if(e[0]instanceof b.Z){let s=e[0]._layer;return s instanceof U.default&&(s=(0,O.constructFeatureSet)(s,r.spatialReference,["*"],!0,r.lrucache,r.interceptor)),null===s||!1===(0,a.o)(s)?[]:s.load().then(()=>s.queryAttachments(e[0].field(s.objectIdField),i.minsize,i.maxsize,i.types,i.returnMetadata))}if(null===e[0])return[];throw new Error("Invalid Parameter")})},t.signatures.push({name:"attachments",min:"1",max:"2"}),t.functions.featuresetbyrelationshipname=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>{(0,a.p)(e,2,4);const i=e[0],s=(0,a.d)(e[1]);let u=(0,a.C)(e[2],null);const y=(0,a.u)((0,a.C)(e[3],!0));if(null===u&&(u=["*"]),!1===(0,a.a)(u))throw new Error("Invalid Parameter");if(null===e[0])return null;if(!(e[0]instanceof b.Z))throw new Error("Invalid Parameter");let o=i._layer;return o instanceof U.default&&(o=(0,O.constructFeatureSet)(o,r.spatialReference,["*"],!0,r.lrucache,r.interceptor)),null===o||!1===(0,a.o)(o)?null:o.load().then(l=>{const n=l.relationshipMetaData().filter(d=>d.name===s);if(0===n.length)return null;if(null!=n[0].relationshipTableId&&n[0].relationshipTableId>-1)return(0,O.constructFeatureSetFromRelationship)(l,n[0],i.field(l.objectIdField),l.spatialReference,u,y,r.lrucache,r.interceptor);let f=l.serviceUrl();return f?(f="/"===f.charAt(f.length-1)?f+n[0].relatedTableId.toString():f+"/"+n[0].relatedTableId.toString(),(0,O.constructFeatureSetFromUrl)(f,l.spatialReference,u,y,r.lrucache,r.interceptor).then(d=>d.load().then(()=>d.relationshipMetaData()).then(D=>{if(D=D.filter(x=>x.id===n[0].id),!1===i.hasField(n[0].keyField)||null===i.field(n[0].keyField))return l.getFeatureByObjectId(i.field(l.objectIdField),[n[0].keyField]).then(x=>{if(x){const S=_.WhereClause.create(D[0].keyField+"= @id",d.getFieldsIndex());return S.parameters={id:x.attributes[n[0].keyField]},d.filter(S)}return new re.Z({parentfeatureset:d})});const A=_.WhereClause.create(D[0].keyField+"= @id",d.getFieldsIndex());return A.parameters={id:i.field(n[0].keyField)},d.filter(A)}))):null})})},t.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),t.functions.featuresetbyassociation=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>{(0,a.p)(e,2,3);const i=e[0],s=(0,a.d)((0,a.C)(e[1],"")).toLowerCase(),u=(0,a.f)(e[2])?(0,a.d)(e[2]):null;if(null===e[0])return null;if(!(e[0]instanceof b.Z))throw new Error("Invalid Parameter");let y=i._layer;return y instanceof U.default&&(y=(0,O.constructFeatureSet)(y,r.spatialReference,["*"],!0,r.lrucache,r.interceptor)),null===y||!1===(0,a.o)(y)?null:y.load().then(()=>{const o=y.serviceUrl();return(0,O.constructAssociationMetaDataFeatureSetFromUrl)(o,r.spatialReference)}).then(o=>{let l=null,n=null,f=!1;if(null!==u&&""!==u&&void 0!==u){for(const g of o.terminals)g.terminalName===u&&(n=g.terminalId);null===n&&(f=!0)}const d=o.associations.getFieldsIndex(),D=d.get("TOGLOBALID").name,A=d.get("FROMGLOBALID").name,x=d.get("TOTERMINALID").name,S=d.get("FROMTERMINALID").name,$=d.get("FROMNETWORKSOURCEID").name,R=d.get("TONETWORKSOURCEID").name,L=d.get("ASSOCIATIONTYPE").name,fe=d.get("ISCONTENTVISIBLE").name,ce=d.get("OBJECTID").name;for(const g of y.fields)if("global-id"===g.type){l=i.field(g.name);break}let T=null,k=new h.yN(new v.Z({name:"percentalong",alias:"percentalong",type:"double"}),_.WhereClause.create("0",o.associations.getFieldsIndex())),Q=new h.yN(new v.Z({name:"side",alias:"side",type:"string"}),_.WhereClause.create("''",o.associations.getFieldsIndex()));const N="globalid",Y="globalId",q={};for(const g in o.lkp)q[g]=o.lkp[g].sourceId;const w=new h.TO(new v.Z({name:"classname",alias:"classname",type:"string"}),null,q);let E="";switch(s){case"midspan":{E=`((${D}='${l}') OR ( ${A}='${l}')) AND (${L} IN (5))`,w.codefield=_.WhereClause.create(`CASE WHEN (${D}='${l}') THEN ${$} ELSE ${R} END`,o.associations.getFieldsIndex());const g=(0,B.JW)(h.Xx.findField(o.associations.fields,A));g.name=N,g.alias=N,T=new h.yN(g,_.WhereClause.create(`CASE WHEN (${A}='${l}') THEN ${D} ELSE ${A} END`,o.associations.getFieldsIndex())),k=o.unVersion>=4?new h.$X(h.Xx.findField(o.associations.fields,d.get("PERCENTALONG").name)):new h.yN(new v.Z({name:"percentalong",alias:"percentalong",type:"double"}),_.WhereClause.create("0",o.associations.getFieldsIndex()));break}case"junctionedge":{E=`((${D}='${l}') OR ( ${A}='${l}')) AND (${L} IN (4,6))`,w.codefield=_.WhereClause.create(`CASE WHEN (${D}='${l}') THEN ${$} ELSE ${R} END`,o.associations.getFieldsIndex());const g=(0,B.JW)(h.Xx.findField(o.associations.fields,A));g.name=N,g.alias=N,T=new h.yN(g,_.WhereClause.create(`CASE WHEN (${A}='${l}') THEN ${D} ELSE ${A} END`,o.associations.getFieldsIndex())),Q=new h.yN(new v.Z({name:"side",alias:"side",type:"string"}),_.WhereClause.create(`CASE WHEN (${L}=4) THEN 'from' ELSE 'to' END`,o.associations.getFieldsIndex()));break}case"connected":{let g=`${D}='@T'`,ee=`${A}='@T'`;null!==n&&(g+=` AND ${x}=@A`,ee+=` AND ${S}=@A`),E="(("+g+") OR ("+ee+"))",E=(0,a.M)(E,"@T",l),g=(0,a.M)(g,"@T",l),null!==n&&(g=(0,a.M)(g,"@A",n.toString()),E=(0,a.M)(E,"@A",n.toString())),w.codefield=_.WhereClause.create("CASE WHEN "+g+` THEN ${$} ELSE ${R} END`,o.associations.getFieldsIndex());const G=(0,B.JW)(h.Xx.findField(o.associations.fields,A));G.name=N,G.alias=N,T=new h.yN(G,_.WhereClause.create("CASE WHEN "+g+` THEN ${A} ELSE ${D} END`,o.associations.getFieldsIndex()));break}case"container":E=`${D}='${l}' AND ${L} = 2`,null!==n&&(E+=` AND ${x} = `+n.toString()),w.codefield=$,E="( "+E+" )",T=new h.QP(h.Xx.findField(o.associations.fields,A),N,N);case"content":E=`(${A}='${l}' AND ${L} = 2)`,null!==n&&(E+=` AND ${S} = `+n.toString()),w.codefield=R,E="( "+E+" )",T=new h.QP(h.Xx.findField(o.associations.fields,D),N,N);break;case"structure":E=`(${D}='${l}' AND ${L} = 3)`,null!==n&&(E+=` AND ${x} = `+n.toString()),w.codefield=$,E="( "+E+" )",T=new h.QP(h.Xx.findField(o.associations.fields,A),N,Y);break;case"attached":E=`(${A}='${l}' AND ${L} = 3)`,null!==n&&(E+=` AND ${S} = `+n.toString()),w.codefield=R,E="( "+E+" )",T=new h.QP(h.Xx.findField(o.associations.fields,D),N,Y);break;default:throw new Error("Invalid Parameter")}return f&&(E="1 <> 1"),new h.Xx({parentfeatureset:o.associations,adaptedFields:[new h.$X(h.Xx.findField(o.associations.fields,ce)),new h.$X(h.Xx.findField(o.associations.fields,fe)),T,Q,w,k],extraFilter:E?_.WhereClause.create(E,o.associations.getFieldsIndex()):null})})})},t.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),t.functions.groupby=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>((0,a.p)(e,3,3),(0,a.o)(e[0])?e[0].load().then(i=>{const s=[],u=[];let y=!1,o=[];if((0,a.f)(e[1]))o.push(e[1]);else if(e[1]instanceof P.Z)o.push(e[1]);else if((0,a.a)(e[1]))o=e[1];else{if(!(0,a.b)(e[1]))return t.failDefferred("Illegal Value: GroupBy");o=e[1].toArray()}for(const n of o)if((0,a.f)(n)){const f=_.WhereClause.create((0,a.d)(n),i.getFieldsIndex()),d=!0===(0,X.y5)(f)?(0,a.d)(n):"%%%%FIELDNAME";s.push({name:d,expression:f}),"%%%%FIELDNAME"===d&&(y=!0)}else{if(!(n instanceof P.Z))return t.failDefferred("Illegal Value: GroupBy");{const f=n.hasField("name")?n.field("name"):"%%%%FIELDNAME",d=n.hasField("expression")?n.field("expression"):"";if("%%%%FIELDNAME"===f&&(y=!0),!f)return t.failDefferred("Illegal Value: GroupBy");s.push({name:f,expression:_.WhereClause.create(d||f,i.getFieldsIndex())})}}if(o=[],(0,a.f)(e[2]))o.push(e[2]);else if((0,a.a)(e[2]))o=e[2];else if((0,a.b)(e[2]))o=e[2].toArray();else{if(!(e[2]instanceof P.Z))return t.failDefferred("Illegal Value: GroupBy");o.push(e[2])}for(const n of o){if(!(n instanceof P.Z))return t.failDefferred("Illegal Value: GroupBy");{const f=n.hasField("name")?n.field("name"):"",d=n.hasField("statistic")?n.field("statistic"):"",D=n.hasField("expression")?n.field("expression"):"";if(!f||!d||!D)return t.failDefferred("Illegal Value: GroupBy");u.push({name:f,statistic:d.toLowerCase(),expression:_.WhereClause.create(D,i.getFieldsIndex())})}}if(y){const n={};for(const d of i.fields)n[d.name.toLowerCase()]=1;for(const d of s)"%%%%FIELDNAME"!==d.name&&(n[d.name.toLowerCase()]=1);for(const d of u)"%%%%FIELDNAME"!==d.name&&(n[d.name.toLowerCase()]=1);let f=0;for(const d of s)if("%%%%FIELDNAME"===d.name){for(;1===n["field_"+f.toString()];)f++;n["field_"+f.toString()]=1,d.name="FIELD_"+f.toString()}}const l=[];for(const n of s)l.push(Z(n.expression,t,r));for(const n of u)l.push(Z(n.expression,t,r));return l.length>0?(0,C.$6)(l).then(()=>(0,C.DB)(e[0].groupby(s,u))):(0,C.DB)(e[0].groupby(s,u))}):t.failDefferred("Illegal Value: GroupBy")))},t.signatures.push({name:"groupby",min:"3",max:"3"}),t.functions.distinct=function(r,m){return t.standardFunctionAsync(r,m,(p,F,e)=>(0,a.o)(e[0])?((0,a.p)(e,2,2),e[0].load().then(i=>{const s=[];let u=[];if((0,a.f)(e[1]))u.push(e[1]);else if(e[1]instanceof P.Z)u.push(e[1]);else if((0,a.a)(e[1]))u=e[1];else{if(!(0,a.b)(e[1]))return t.failDefferred("Illegal Value: GroupBy");u=e[1].toArray()}let y=!1;for(const l of u)if((0,a.f)(l)){const n=_.WhereClause.create((0,a.d)(l),i.getFieldsIndex()),f=!0===(0,X.y5)(n)?(0,a.d)(l):"%%%%FIELDNAME";s.push({name:f,expression:n}),"%%%%FIELDNAME"===f&&(y=!0)}else{if(!(l instanceof P.Z))return t.failDefferred("Illegal Value: GroupBy");{const n=l.hasField("name")?l.field("name"):"%%%%FIELDNAME",f=l.hasField("expression")?l.field("expression"):"";if("%%%%FIELDNAME"===n&&(y=!0),!n)return t.failDefferred("Illegal Value: GroupBy");s.push({name:n,expression:_.WhereClause.create(f||n,i.getFieldsIndex())})}}if(y){const l={};for(const f of i.fields)l[f.name.toLowerCase()]=1;for(const f of s)"%%%%FIELDNAME"!==f.name&&(l[f.name.toLowerCase()]=1);let n=0;for(const f of s)if("%%%%FIELDNAME"===f.name){for(;1===l["field_"+n.toString()];)n++;l["field_"+n.toString()]=1,f.name="FIELD_"+n.toString()}}const o=[];for(const l of s)o.push(Z(l.expression,t,r));return o.length>0?(0,C.$6)(o).then(()=>(0,C.DB)(e[0].groupby(s,[]))):(0,C.DB)(e[0].groupby(s,[]))})):function(t,r,m,p){if(1===p.length){if((0,a.a)(p[0]))return(0,j.t)(t,p[0],-1);if((0,a.b)(p[0]))return(0,j.t)(t,p[0].toArray(),-1)}return(0,j.t)(t,p,-1)}("distinct",0,0,e))})}}}]);