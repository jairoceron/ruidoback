"use strict";var rt=Object.defineProperty,tt=Object.getOwnPropertySymbols,it=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable,et=(V,j,y)=>j in V?rt(V,j,{enumerable:!0,configurable:!0,writable:!0,value:y}):V[j]=y,st=(V,j)=>{for(var y in j||(j={}))it.call(j,y)&&et(V,y,j[y]);if(tt)for(var y of tt(j))nt.call(j,y)&&et(V,y,j[y]);return V};(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[6570],{64124:(V,j,y)=>{y.d(j,{N:()=>F});const F={convertToGEGeometry:function(b,I){return null==I?null:b.convertJSONToGeometry(I)},exportPoint:function(b,I,T){const i=new f(b.getPointX(I),b.getPointY(I),T),e=b.hasZ(I),u=b.hasM(I);return e&&(i.z=b.getPointZ(I)),u&&(i.m=b.getPointM(I)),i},exportPolygon:function(b,I,T){return new M(b.exportPaths(I),T,b.hasZ(I),b.hasM(I))},exportPolyline:function(b,I,T){return new S(b.exportPaths(I),T,b.hasZ(I),b.hasM(I))},exportMultipoint:function(b,I,T){return new x(b.exportPoints(I),T,b.hasZ(I),b.hasM(I))},exportExtent:function(b,I,T){const i=b.hasZ(I),e=b.hasM(I),u=new m(b.getXMin(I),b.getYMin(I),b.getXMax(I),b.getYMax(I),T);if(i){const h=b.getZExtent(I);u.zmin=h.vmin,u.zmax=h.vmax}if(e){const h=b.getMExtent(I);u.mmin=h.vmin,u.mmax=h.vmax}return u}};class f{constructor(I,T,i){this.x=I,this.y=T,this.spatialReference=i,this.z=void 0,this.m=void 0}}class M{constructor(I,T,i,e){this.rings=I,this.spatialReference=T,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),e&&(this.hasM=e)}}class S{constructor(I,T,i,e){this.paths=I,this.spatialReference=T,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),e&&(this.hasM=e)}}class x{constructor(I,T,i,e){this.points=I,this.spatialReference=T,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),e&&(this.hasM=e)}}class m{constructor(I,T,i,e,u){this.xmin=I,this.ymin=T,this.xmax=i,this.ymax=e,this.spatialReference=u,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},21276:(V,j,y)=>{y.d(j,{ym:()=>A,RF:()=>a,vY:()=>S,J9:()=>U,U1:()=>W,Ie:()=>Q,G6:()=>H});var F=y(60305),N=y(52917);const c=(s,t,o)=>[t,o],M=(s,t,o)=>[t,o,s[2]],E=(s,t,o)=>[t,o,s[2],s[3]];function S(s){return s?{originPosition:"upper-left"===s.originPosition?"upperLeft":"lower-left"===s.originPosition?"lowerLeft":s.originPosition,scale:s.tolerance?[s.tolerance,s.tolerance]:[1,1],translate:s.extent?[s.extent.xmin,s.extent.ymax]:[0,0]}:null}function x({scale:s,translate:t},o){return Math.round((o-t[0])/s[0])}function l({scale:s,translate:t},o){return Math.round((t[1]-o)/s[1])}function m(s,t,o){const v=[];let C,Z,K,G;for(let J=0;J<o.length;J++){const k=o[J];J>0?(K=x(s,k[0]),G=l(s,k[1]),K===C&&G===Z||(v.push(t(k,K-C,G-Z)),C=K,Z=G)):(C=x(s,k[0]),Z=l(s,k[1]),v.push(t(k,C,Z)))}return v.length>0?v:null}function i({scale:s,translate:t},o){return o*s[0]+t[0]}function e({scale:s,translate:t},o){return t[1]-o*s[1]}function u(s,t,o){const v=new Array(o.length);if(!o.length)return v;const[C,Z]=s.scale;let K=i(s,o[0][0]),G=e(s,o[0][1]);v[0]=t(o[0],K,G);for(let J=1;J<o.length;J++){const k=o[J];K+=k[0]*C,G-=k[1]*Z,v[J]=t(k,K,G)}return v}function h(s,t,o){const v=new Array(o.length);for(let C=0;C<o.length;C++)v[C]=u(s,t,o[C]);return v}function a(s,t,o,v,C){return t.x=x(s,o.x),t.y=l(s,o.y),t!==o&&(v&&(t.z=o.z),C&&(t.m=o.m)),t}function A(s,t){return s&&t?(0,N.wp)(t)?a(s,{},t,!1,!1):(0,N.l9)(t)?function(s,t,o,v,C){const Z=function(s,t,o,v){const C=[],Z=o?v?E:M:v?M:c;for(let K=0;K<t.length;K++){const G=m(s,Z,t[K]);G&&G.length>=2&&C.push(G)}return C.length?C:null}(s,o.paths,v,C);return Z?(t.paths=Z,t):null}(s,{},t,!1,!1):(0,N.oU)(t)?function(s,t,o,v,C){const Z=function(s,t,o,v){const C=[],Z=o?v?E:M:v?M:c;for(let K=0;K<t.length;K++){const G=m(s,Z,t[K]);G&&G.length>=3&&C.push(G)}return C.length?C:null}(s,o.rings,v,C);return Z?(t.rings=Z,t):null}(s,{},t,!1,!1):(0,N.aW)(t)?function(s,t,o,v,C){return t.points=function(s,t,o,v){return m(s,o?v?E:M:v?M:c,t)}(s,o.points,v,C),t}(s,{},t,!1,!1):(0,N.YX)(t)?function(s,t,o,v,C){return t.xmin=x(s,o.xmin),t.ymin=l(s,o.ymin),t.xmax=x(s,o.xmax),t.ymax=l(s,o.ymax),t}(s,{},t):null:null}function U(s,t,o,v,C){return(0,F.pC)(o)&&(t.points=function(s,t,o,v){return u(s,o?v?E:M:v?M:c,t)}(s,o.points,v,C)),t}function W(s,t,o,v,C){return(0,F.Wi)(o)||(t.x=i(s,o.x),t.y=e(s,o.y),t!==o&&(v&&(t.z=o.z),C&&(t.m=o.m))),t}function Q(s,t,o,v,C){return(0,F.pC)(o)&&(t.rings=function(s,t,o,v){return h(s,o?v?E:M:v?M:c,t)}(s,o.rings,v,C)),t}function H(s,t,o,v,C){return(0,F.pC)(o)&&(t.paths=function(s,t,o,v){return h(s,o?v?E:M:v?M:c,t)}(s,o.paths,v,C)),t}},89977:(V,j,y)=>{y.d(j,{Y:()=>f});var F=y(60305);function N(l,m){return l?m?4:3:m?3:2}function f(l,m,P,b,I){if((0,F.Wi)(m)||!m.lengths.length)return null;const T="upperLeft"===(null==I?void 0:I.originPosition)?-1:1;l.lengths.length&&(l.lengths.length=0),l.coords.length&&(l.coords.length=0);const i=l.coords,e=[],u=P?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:h,coords:n}=m,g=N(P,b);let z=0;for(const r of h){const D=c(u,n,z,r,P,b,T);D&&e.push(D),z+=r*g}if(e.sort((r,D)=>{let R=T*r[2]-T*D[2];return 0===R&&P&&(R=r[4]-D[4]),R}),e.length){let r=6*e[0][2];i[0]=e[0][0]/r,i[1]=e[0][1]/r,P&&(r=6*e[0][4],i[2]=0!==r?e[0][3]/r:0),(i[0]<u[0]||i[0]>u[1]||i[1]<u[2]||i[1]>u[3]||P&&(i[2]<u[4]||i[2]>u[5]))&&(i.length=0)}if(!i.length){const r=m.lengths[0]?function(l,m,P,b,I){const T=N(b,I);let i=0,e=0+T,u=0,h=0,n=0,g=0;for(let z=0,r=P-1;z<r;z++,i+=T,e+=T){const D=l[i],R=l[i+1],L=l[i+2],w=l[e],Y=l[e+1],X=l[e+2],B=b?S(D,R,L,w,Y,X):E(D,R,w,Y);if(B)if(u+=B,b){const a=x(D,R,L,w,Y,X);h+=B*a[0],n+=B*a[1],g+=B*a[2]}else{const a=_(D,R,w,Y);h+=B*a[0],n+=B*a[1]}}return u>0?b?[h/u,n/u,g/u]:[h/u,n/u]:P>0?b?[l[0],l[1],l[2]]:[l[0],l[1]]:null}(n,0,h[0],P,b):null;if(!r)return null;i[0]=r[0],i[1]=r[1],P&&r.length>2&&(i[2]=r[2])}return l}function c(l,m,P,b,I,T,i=1){const e=N(I,T);let u=P,h=P+e,n=0,g=0,z=0,r=0,D=0;for(let L=0,w=b-1;L<w;L++,u+=e,h+=e){const Y=m[u],X=m[u+1],B=m[u+2],a=m[h],d=m[h+1],p=m[h+2];let A=Y*d-a*X;r+=A,n+=(Y+a)*A,g+=(X+d)*A,I&&(A=Y*p-a*B,z+=(B+p)*A,D+=A),Y<l[0]&&(l[0]=Y),Y>l[1]&&(l[1]=Y),X<l[2]&&(l[2]=X),X>l[3]&&(l[3]=X),I&&(B<l[4]&&(l[4]=B),B>l[5]&&(l[5]=B))}if(r*i>0&&(r*=-1),D*i>0&&(D*=-1),!r)return null;const R=[n,g,.5*r];return I&&(R[3]=z,R[4]=.5*D),R}function E(l,m,P,b){const I=P-l,T=b-m;return Math.sqrt(I*I+T*T)}function S(l,m,P,b,I,T){const i=b-l,e=I-m,u=T-P;return Math.sqrt(i*i+e*e+u*u)}function _(l,m,P,b){return[l+.5*(P-l),m+.5*(b-m)]}function x(l,m,P,b,I,T){return[l+.5*(b-l),m+.5*(I-m),P+.5*(T-P)]}},68310:(V,j,y)=>{y.d(j,{_W:()=>m,iV:()=>T,oj:()=>u});var F=y(61921),N=y(60305),f=y(62733),c=y(64124),M=y(89096),E=y(87337);const S=[0,0];function _(h,n){if(!n)return null;if("x"in n){const g={x:0,y:0};return[g.x,g.y]=h(n.x,n.y,S),null!=n.z&&(g.z=n.z),null!=n.m&&(g.m=n.m),g}if("xmin"in n){const g={xmin:0,ymin:0,xmax:0,ymax:0};return[g.xmin,g.ymin]=h(n.xmin,n.ymin,S),[g.xmax,g.ymax]=h(n.xmax,n.ymax,S),n.hasZ&&(g.zmin=n.zmin,g.zmax=n.zmax,g.hasZ=!0),n.hasM&&(g.mmin=n.mmin,g.mmax=n.mmax,g.hasM=!0),g}return"rings"in n?{rings:x(n.rings,h),hasM:n.hasM,hasZ:n.hasZ}:"paths"in n?{paths:x(n.paths,h),hasM:n.hasM,hasZ:n.hasZ}:"points"in n?{points:l(n.points,h),hasM:n.hasM,hasZ:n.hasZ}:void 0}function x(h,n){const g=[];for(const z of h)g.push(l(z,n));return g}function l(h,n){const g=[];for(const z of h){const r=n(z[0],z[1],[0,0]);g.push(r),z.length>2&&r.push(z[2]),z.length>3&&r.push(z[3])}return g}function m(h,n){return P.apply(this,arguments)}function P(){return(P=(0,F.Z)(function*(h,n){if(!n)return;const g=Array.isArray(h)?h.map(z=>(0,N.pC)(z.geometry)&&z.geometry.spatialReference):[h];yield(0,f.iQ)(g.map(z=>({source:z,dest:n})))})).apply(this,arguments)}const b=_.bind(null,E.hG),I=_.bind(null,E.R6);function T(h,n,g){return h&&(g||(g=n,n=h.spatialReference),(0,M.JY)(n)&&(0,M.JY)(g)&&!(0,M.fS)(n,g)?(0,E.Q8)(n,g)?(0,M.sS)(g)?b(h):I(h):(0,f.oj)(c.N,[h],n,g,null)[0]:h)}const e=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}push(n,g,z){var r=this;return(0,F.Z)(function*(){if(!n||!n.length||!g||!z||(0,M.fS)(g,z))return n;const D={geometries:n,inSpatialReference:g,outSpatialReference:z,resolve:null};return r._jobs.push(D),new Promise(R=>{D.resolve=R,null===r._timer&&(r._timer=setTimeout(r._process,10))})})()}_process(){this._timer=null;const n=this._jobs.shift();if(!n)return;const{geometries:g,inSpatialReference:z,outSpatialReference:r,resolve:D}=n;(0,E.Q8)(z,r)?(0,M.sS)(r)?D(g.map(b)):D(g.map(I)):D((0,f.oj)(c.N,g,z,r,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function u(h,n,g){return e.push(h,n,g)}},63870:(V,j,y)=>{y.d(j,{J:()=>N,g:()=>F});const F=(f,c)=>f&&((...M)=>c.warn("DEBUG:",...M))||(()=>null),N=!1},96054:(V,j,y)=>{y.d(j,{a:()=>E});var F=y(22795),N=y(33870),f=y(38963),c=y(20547);const M=N.Z.getLogger("esri.views.2d.engine.webgl");function E(S){return(0,c.hj)(S.minDataValue)&&(0,c.hj)(S.maxDataValue)&&null!=S.minSize&&null!=S.maxSize?f.X.SIZE_MINMAX_VALUE:(S.expression&&"view.scale"===S.expression||S.valueExpression&&"$view.scale"===S.valueExpression)&&Array.isArray(S.stops)?f.X.SIZE_SCALE_STOPS:(null!=S.field||S.expression&&"view.scale"!==S.expression||S.valueExpression&&"$view.scale"!==S.valueExpression)&&(Array.isArray(S.stops)||"levels"in S&&S.levels)?f.X.SIZE_FIELD_STOPS:(null!=S.field||S.expression&&"view.scale"!==S.expression||S.valueExpression&&"$view.scale"!==S.valueExpression)&&null!=S.valueUnit?f.X.SIZE_UNIT_VALUE:(M.error(new F.Z("mapview-bad-type","Found invalid size VisualVariable",S)),f.X.NONE)}},59802:(V,j,y)=>{y.d(j,{ZP:()=>X,jL:()=>r,nE:()=>R});var F=y(61921),N=y(22795),f=y(67474),c=y(33870),M=y(22791),E=y(60305),S=y(12523),_=y(32699),x=y(25808),l=y(99155),m=y(20547),P=y(63870),b=y(479);const I=c.Z.getLogger("esri.views.layers.2d.features.support.AttributeStore"),T=(0,P.g)(P.J,I),z=B=>(2147483648&B)>>>31,r=B=>2147483647&B;function R(B){return 1===z(B)}const L={sharedArrayBuffer:(0,f.Z)("esri-shared-array-buffer"),atomics:(0,f.Z)("esri-atomics")};function w(B,a){return d=>a(B(d))}class Y{constructor(a,d,p,A){this.size=0,this.texelSize=4;const{pixelType:O,layout:U,textureOnly:W}=A;this.textureOnly=W||!1,this.pixelType=O,this._ctype=d,this.layout=U,this._resetRange(),this._shared=a,this.size=p,W||(this.data=this._initData(O,p,a,d))}get buffer(){return(0,E.Po)(this.data,a=>a.buffer)}unsetComponentAllTexels(a,d){const p=(0,E.Wg)(this.data);for(let A=0;A<this.size*this.size;A++)p[A*this.texelSize+a]&=~d;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(a,d){const p=(0,E.Wg)(this.data);for(let A=0;A<this.size*this.size;A++)p[A*this.texelSize+a]|=255&d;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(a,d,p){const A=(0,E.Wg)(this.data);for(const O of p)A[O*this.texelSize+a]|=d,this.dirtyStart=Math.min(this.dirtyStart,O),this.dirtyEnd=Math.max(this.dirtyEnd,O)}setComponentTexel(a,d,p){(0,E.Wg)(this.data)[p*this.texelSize+a]|=d,this.dirtyStart=Math.min(this.dirtyStart,p),this.dirtyEnd=Math.max(this.dirtyEnd,p)}unsetComponentTexel(a,d,p){(0,E.Wg)(this.data)[p*this.texelSize+a]&=~d,this.dirtyStart=Math.min(this.dirtyStart,p),this.dirtyEnd=Math.max(this.dirtyEnd,p)}getData(a,d){const p=r(a);return(0,E.Wg)(this.data)[p*this.texelSize+d]}setData(a,d,p){const A=r(a);0!=(this.layout&1<<d)?(this.data[A*this.texelSize+d]=p,this.dirtyStart=Math.min(this.dirtyStart,A),this.dirtyEnd=Math.max(this.dirtyEnd,A)):I.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){5121===this.pixelType&&this._shared&&L.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){5121===this.pixelType&&this._shared&&L.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(a){if(this.size=a,!this.textureOnly){const d=this._initData(this.pixelType,a,this._shared,this._ctype),p=(0,E.Wg)(this.data);d.set(p),this.data=d}}toMessage(){const a=this.dirtyStart,d=this.dirtyEnd,p=this.texelSize;if(a>d)return null;this._resetRange();const A=!(this._shared||"local"===this._ctype),O=this.pixelType,U=this.layout,W=(0,E.Wg)(this.data);return{start:a,end:d,data:A&&W.slice(a*p,(d+1)*p)||null,pixelType:O,layout:U}}_initData(a,d,p,A){const O=p&&"local"!==A?SharedArrayBuffer:ArrayBuffer,U=(0,m.UK)(a),W=new U(new O(d*d*4*U.BYTES_PER_ELEMENT));for(let Q=0;Q<W.length;Q+=4)W[Q+1]=255;return W}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class X{constructor(a,d){this._client=a,this.config=d,this._attributeComputeMap=new Map,this._blocks=new Array,this._filters=new Array(l.m4),this._targetType=0,this._abortController=(0,S.yi)(),this._hasScaleExpr=!1,this._size=32,this._idsToHighlight=new Set;const p=d.supportsTextureFloat?5126:5121;T(`Creating AttributeStore ${L.sharedArrayBuffer?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:p,layout:15},{pixelType:p,layout:15}],this._blocks=this._blockDescriptors.map(()=>null)}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}update(a,d){this.config=d;const p=d.schema.processors[0].storage,A=(0,_.Hg)(this._schema,p);if((a.targets.feature||a.targets.aggregate)&&(a.storage.data=!0),A&&((0,f.Z)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",A),a.storage.data=!0,this._schema=p,this._attributeComputeMap.clear(),!(0,E.Wi)(p))){switch(p.target){case"feature":this._targetType=0;break;case"aggregate":this._targetType=1}if("subtype"===p.type)for(const O in p.mapping){const U=p.mapping[O];if((0,E.pC)(U))for(const W of U.mapping)this._bindAttribute(W)}else for(const O of p.mapping)this._bindAttribute(O)}}onTileData(a,d){if((0,E.Wi)(d.addOrUpdate))return;const p=d.addOrUpdate.getCursor();for(;p.next();){const A=p.getDisplayId();this.setAttributeData(A,p)}}invalidateResources(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=(0,S.yi)()}setHighlight(a,d){var p=this;return(0,F.Z)(function*(){const O=p._getBlock(0),U=d.map(W=>r(W));O.lock(),O.unsetComponentAllTexels(0,1),O.setComponent(0,1,U),O.unlock(),p._idsToHighlight.clear();for(const W of a)p._idsToHighlight.add(W);yield p.sendUpdates()})()}updateFilters(a,d){var p=this;return(0,F.Z)(function*(){const{config:A,service:O,spatialReference:U}=d,{filters:W}=A,Q=W.map((H,s)=>p._updateFilter(H,s,O,U));(yield Promise.all(Q)).some(H=>H)&&(a.storage.filters=!0,(0,f.Z)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))})()}setData(a,d,p,A){const O=r(a);this._ensureSizeForTexel(O),this._getBlock(d).setData(a,p,A)}getData(a,d,p){return this._getBlock(d).getData(a,p)}getHighlightFlag(a){return this._idsToHighlight.has(a)?l.uG:0}unsetAttributeData(a){const d=r(a);this._getBlock(0).setData(d,0,0)}setAttributeData(a,d){const p=r(a);if(this._ensureSizeForTexel(p),this._getBlock(0).setData(p,0,this.getFilterFlags(d)),this._targetType!==z(a))return;const A=this._attributeComputeMap,O=this.config.supportsTextureFloat?1:2;A.size&&A.forEach((W,Q)=>{const H=Q*O%4,s=Math.floor(Q*O/4),t=this._getBlock(s+l.aK),o=W(d);if(this.config.supportsTextureFloat)t.setData(p,H,o);else if(o===l.AI)t.setData(p,H,255),t.setData(p,H+1,255);else{const v=(0,M.uZ)(Math.round(o),-32767,32766)+32768,Z=(65280&v)>>8;t.setData(p,H,255&v),t.setData(p,H+1,Z)}})}sendUpdates(){if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=(0,S.hh)(),this._nextUpdate.promise;const a={blocks:this._blocks.map(d=>(0,E.pC)(d)?d.toMessage():null)};return this._currUpdate=this._createResources().then(()=>{const d=()=>{if(this._currUpdate=null,this._nextUpdate){const A=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then(()=>A.resolve())}},p=this._client.update(a,this._signal).then(d).catch(d);return this._client.render(this._signal),p}).catch(d=>(0,S.D_)(d)?(this._createResourcesPromise=null,this._createResources()):(I.error(new N.Z("mapview-attribute-store","Encountered an error during client update",d)),Promise.resolve())),this._currUpdate}_ensureSizeForTexel(a){for(;a>=this._size*this._size;)if(this._expand())return}_bindAttribute(a){let A;if(null!=a.fieldIndex)a.normalizationField&&I.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),A=U=>U.getComputedNumericAtIndex(a.fieldIndex);else{if(!a.field)return;A=a.normalizationField?U=>{const W=U.readAttribute(a.normalizationField);return W?U.readAttribute(a.field)/W:null}:U=>U.readAttribute(a.field)}a.valueRepresentation&&(A=w(A,U=>(0,b.qc)(U,a.valueRepresentation))),this._attributeComputeMap.set(a.binding,w(A,U=>null===U||isNaN(U)||U===1/0?l.AI:U))}_createResources(){if((0,E.pC)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(l.xl),T("Initializing AttributeStore");const a={shared:L.sharedArrayBuffer&&"local"!==this._client.type,size:this._size,blocks:(0,E.Fd)(this._blocks,p=>({textureOnly:p.textureOnly,buffer:p.buffer,pixelType:p.pixelType}))},d=this._client.initialize(a,this._signal).catch(p=>{(0,S.D_)(p)?this._createResourcesPromise=null:I.error(new N.Z("mapview-attribute-store","Encountered an error during client initialization",p))});return this._createResourcesPromise=d,d.then(()=>(0,E.Wi)(this._createResourcesPromise)?this._createResources():void 0),d}_getBlock(a){const d=this._blocks[a];if((0,E.pC)(d))return d;T(`Initializing AttributeBlock at index ${a}`);const O=new Y(L.sharedArrayBuffer,this._client.type,this._size,this._blockDescriptors[a]);return this._blocks[a]=O,this._createResourcesPromise=null,O}_expand(){if(this._size<this.config.maxTextureSize){const a=this._size<<=1;return T("Expanding block size to",a,this._blocks),(0,E.JR)(this._blocks,d=>d.expand(a)),this._createResourcesPromise=null,this._size=a,0}return I.error(new N.Z("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}_updateFilter(a,d,p,A){var O=this;return(0,F.Z)(function*(){const U=O._filters[d],W=(0,E.pC)(U)&&U.hash;if(!U&&!a||W===JSON.stringify(a))return!1;if((0,E.Wi)(a)){if(!U)return!1;const H=1<<d+1,s=O._getBlock(0);return O._filters[d]=null,s.setComponentAllTexels(0,H),O.sendUpdates(),!0}return yield(yield O._getFilter(d,p)).update(a,A),!0})()}_getFilter(a,d){var p=this;return(0,F.Z)(function*(){const A=p._filters[a];if((0,E.pC)(A))return A;const{default:O}=yield Promise.all([y.e(8592),y.e(8342)]).then(y.bind(y,88342)),U=new O({geometryType:d.geometryType,hasM:!1,hasZ:!1,timeInfo:d.timeInfo,fieldsIndex:new x.Z(d.fields)});return p._filters[a]=U,U})()}isVisible(a){return!!(2&this._getBlock(0).getData(a,0))}getFilterFlags(a){let d=0;const p=(B=a.getDisplayId(),1===z(B)?254:255);var B;for(let O=0;O<this._filters.length;O++){const W=this._filters[O];d|=(p&1<<O&&!(0,E.Wi)(W)&&!W.check(a)?0:1)<<O}let A=0;if(this._idsToHighlight.size){const O=a.getObjectId();A=this.getHighlightFlag(O)}return d<<1|A}}},72181:(V,j,y)=>{y.d(j,{O:()=>I});class _{constructor(){this._freeIds=[],this._idCounter=1}createId(i=!1){return function(T,i){return((i?2147483648:0)|T)>>>0}(this._getFreeId(),i)}releaseId(i){this._freeIds.push(i)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var x=y(2679);function l(T,i,e){if(!(T.length>i))for(;T.length<=i;)T.push(e)}const m=2147483647;class I{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new _,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){const i=this._bitsets.length;return this._bitsets.push(x.p.create(this._allocatedSize,m)),i+1}getBitset(i){return this._bitsets[i-1]}_expand(){this._allocatedSize<<=1;for(const i of this._bitsets)i.resize(this._allocatedSize)}_ensureNumeric(i,e){this._numerics[i]||(this._numerics[i]=[]),l(this._numerics[i],e,0)}_ensureInstanceId(i){l(this._instanceIds,i,0)}_ensureString(i,e){this._strings[i]||(this._strings[i]=[]),l(this._strings[i],e,null)}createDisplayId(i=!1){const e=this._idGenerator.createId();return e>this._allocatedSize&&this._expand(),((T,i)=>((i?2147483648:0)|T)>>>0)(e,i)}releaseDisplayId(i){for(const e of this._bitsets)e.unset(i);return this._idGenerator.releaseId(i&m)}getComputedNumeric(i,e){return this.getComputedNumericAtIndex(i&m,0)}setComputedNumeric(i,e,u){return this.setComputedNumericAtIndex(i&m,u,0)}getComputedString(i,e){return this.getComputedStringAtIndex(i&m,0)}setComputedString(i,e,u){return this.setComputedStringAtIndex(i&m,0,u)}getComputedNumericAtIndex(i,e){const u=i&m;return this._ensureNumeric(e,u),this._numerics[e][u]}setComputedNumericAtIndex(i,e,u){const h=i&m;this._ensureNumeric(e,h),this._numerics[e][h]=u}getInstanceId(i){const e=i&m;return this._ensureInstanceId(e),this._instanceIds[e]}setInstanceId(i,e){const u=i&m;this._ensureInstanceId(u),this._instanceIds[u]=e}getComputedStringAtIndex(i,e){const u=i&m;return this._ensureString(e,u),this._strings[e][u]}setComputedStringAtIndex(i,e,u){const h=i&m;this._ensureString(e,h),this._strings[e][h]=u}getXMin(i){return this._bounds[4*(i&m)]}getYMin(i){return this._bounds[4*(i&m)+1]}getXMax(i){return this._bounds[4*(i&m)+2]}getYMax(i){return this._bounds[4*(i&m)+3]}setBounds(i,e){const u=e.readHydratedGeometry();if(!u||!u.coords.length)return!1;let h=1/0,n=1/0,g=-1/0,z=-1/0;u.forEachVertex((D,R)=>{h=Math.min(h,D),n=Math.min(n,R),g=Math.max(g,D),z=Math.max(z,R)});const r=i&m;return l(this._bounds,4*r+4,0),this._bounds[4*r]=h,this._bounds[4*r+1]=n,this._bounds[4*r+2]=g,this._bounds[4*r+3]=z,!0}}},46337:(V,j,y)=>{y.d(j,{s:()=>g}),y(73513);var x,l,N=y(67474),f=y(60305),c=y(89977),M=y(90097),E=y(82490),S=y(2679),_=y(52917);let m=0;const P=null!=(x=(0,N.Z)("featurelayer-simplify-thresholds"))?x:[.5,.5,.5,.5],b=P[0],I=P[1],T=P[2],i=P[3],e=null!=(l=(0,N.Z)("featurelayer-simplify-payload-size-factors"))?l:[1,2,4],u=e[0],h=e[1],n=e[2];class g{constructor(r){this.type="FeatureSetReader",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._level=0,this.instance=r}static createInstance(){return m++,m=m>65535?0:m,m}get isEmpty(){return(0,f.pC)(this._deleted)&&this._deleted.countSet()===this.getSize()}set level(r){this._level=r}getAreaSimplificationThreshold(r,D){let R=1;D>4e6?R=n:D>1e6?R=h:D>5e5&&(R=u);let L=0;r>4e3?L=i*R:r>2e3?L=T*R:r>100?L=I:r>15&&(L=b);let w=8;return this._level<4?w=1:this._level<5?w=2:this._level<6&&(w=4),L*w}setArcadeSpatialReference(r){this._arcadeSpatialReference=r}attachStorage(r){this._storage=r}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(r){return this.getComputedNumericAtIndex(0)}setComputedNumeric(r,D){return this.setComputedNumericAtIndex(D,0)}getComputedString(r){return this.getComputedStringAtIndex(0)}setComputedString(r,D){return this.setComputedStringAtIndex(0,D)}getComputedNumericAtIndex(r){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),r)}setComputedNumericAtIndex(r,D){this._storage.setComputedNumericAtIndex(this.getDisplayId(),r,D)}getComputedStringAtIndex(r){return this._storage.getComputedStringAtIndex(this.getDisplayId(),r)}setComputedStringAtIndex(r,D){return this._storage.setComputedStringAtIndex(this.getDisplayId(),r,D)}transform(r,D,R,L){const w=this.copy();return w._tx+=r,w._ty+=D,w._sx*=R,w._sy*=L,w}readAttribute(r,D=!1){const R=this._readAttribute(r,D);if(void 0!==R)return R;for(const L of this._joined){L.setIndex(this.getIndex());const w=L._readAttribute(r,D);if(void 0!==w)return w}}readAttributes(){const r=this._readAttributes();for(const D of this._joined){D.setIndex(this.getIndex());const R=D._readAttributes();for(const L of Object.keys(R))r[L]=R[L]}return r}joinAttributes(r){this._joined.push(r)}readArcadeFeature(){return this}geometry(){const r=this.readHydratedGeometry(),D=(0,M.di)(r,this.geometryType,this.hasZ,this.hasM),R=(0,_.im)(D);return R&&(R.spatialReference=this._arcadeSpatialReference),R}field(r){return this.readAttribute(r,!0)}hasField(r){return!0}setField(r,D){}keys(){return[]}castToText(){return""}removeIds(r){if((0,f.Wi)(this._objectIdToIndex)){const R=new Map,L=this.getCursor();for(;L.next();)R.set(L.getObjectId(),L.getIndex());this._objectIdToIndex=R}const D=this._objectIdToIndex;for(const R of r)D.has(R)&&this.removeAtIndex(D.get(R))}removeAtIndex(r){(0,f.Wi)(this._deleted)&&(this._deleted=S.p.create(this.getSize())),this._deleted.set(r)}readGeometryForDisplay(){return this.readUnquantizedGeometry(!0)}readLegacyGeometryForDisplay(){return this.readLegacyGeometry(!0)}*features(){const r=this.getCursor();for(;r.next();)yield r.readOptimizedFeature()}_getExists(){return(0,f.Wi)(this._deleted)||!this._deleted.has(this.getIndex())}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;const r=this.readUnquantizedGeometry();if(!r||r.hasIndeterminateRingOrder)return null;const D=(0,f.Pt)(this.getQuantizationTransform(),null);return(0,c.Y)(new E.Z,r,this.hasM,this.hasZ,D)}copyInto(r){r.seen=this.seen,r._storage=this._storage,r._arcadeSpatialReference=this._arcadeSpatialReference,r._joined=this._joined,r._tx=this._tx,r._ty=this._ty,r._sx=this._sx,r._sy=this._sy,r._deleted=this._deleted,r._objectIdToIndex=this._objectIdToIndex}}},15958:(V,j,y)=>{y.d(j,{i:()=>E});var F=y(60305),N=y(90097),f=y(82535),c=y(46337);class E extends c.s{constructor(_,x,l){super(_),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=l,this._features=x}static fromFeatures(_,x,l){const m=(0,N.Yn)([],_,x,!1,!1,l);for(let P=0;P<m.length;P++)m[P].displayId=_[P].displayId;return E.fromOptimizedFeatures(m,x)}static fromFeatureSet(_,x){const l=(0,N.h_)(_,x);return E.fromOptimizedFeatureSet(l)}static fromOptimizedFeatureSet(_){const{features:x,geometryType:l}=_,m=E.fromOptimizedFeatures(x,l);m._exceededTransferLimit=_.exceededTransferLimit,m._transform=_.transform;for(const P of _.fields)"esriFieldTypeDate"===P.type&&m._dateFields.add(P.name);return m}static fromOptimizedFeatures(_,x,l){const m=c.s.createInstance(),P=new E(m,_,x);return P._transform=l,P}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}removeIds(_){const x=new Set(_);this._features=this._features.filter(l=>!x.has(l.objectId))}append(_){for(const x of _)this._features.push(x)}getSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let _="";for(const x in this._current.attributes)_+=this._current.attributes[x];return _}getIndex(){return this._featureIndex}setIndex(_){this._featureIndex=_}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(_){this._current.displayId=_}getGroupId(){return this._current.groupId}setGroupId(_){this._current.groupId=_}copy(){const _=new E(this.instance,this._features,this.geometryType);return this.copyInto(_),_}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readLegacyFeature(){return(0,N.EI)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null}readLegacyGeometry(){const _=this.readGeometry();return(0,N.di)(_,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const _=this.readCentroid();return(0,F.Wi)(_)?null:{x:_.coords[0]*this._sx+this._tx,y:_.coords[1]*this._sy+this._ty}}readGeometryArea(){return(0,f.S6)(this._current)?(0,N.lz)(this._current.geometry,2):0}readUnquantizedGeometry(){const _=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!_)return _;const x=_.clone();return function({coords:S,lengths:_}){let x=0;for(const l of _){for(let m=1;m<l;m++)S[2*(x+m)]+=S[2*(x+m)-2],S[2*(x+m)+1]+=S[2*(x+m)-1];x+=l}}(x),x}readHydratedGeometry(){const _=this._current.geometry;if((0,F.Wi)(_))return null;const x=_.clone();return(0,F.pC)(this._transform)&&(0,N.$g)(x,x,this.hasZ,this.hasM,this._transform),x}getXHydrated(){if(!(0,f.S6)(this._current))return 0;const _=this._current.geometry.coords[0],x=this.getQuantizationTransform();return(0,F.Wi)(x)?_:_*x.scale[0]+x.translate[0]}getYHydrated(){if(!(0,f.S6)(this._current))return 0;const _=this._current.geometry.coords[1],x=this.getQuantizationTransform();return(0,F.Wi)(x)?_:x.translate[1]-_*x.scale[1]}getX(){return(0,f.S6)(this._current)?this._current.geometry.coords[0]*this._sx+this._tx:0}getY(){return(0,f.S6)(this._current)?this._current.geometry.coords[1]*this._sy+this._ty:0}readGeometry(){if(!(0,f.S6)(this._current))return null;const _=this._current.geometry.clone();if(_.isPoint)return _.coords[0]=_.coords[0]*this._sx+this._tx,_.coords[1]=_.coords[1]*this._sy+this._ty,_;let x=0;for(const l of _.lengths)_.coords[2*x]=_.coords[2*x]*this._sx+this._tx,_.coords[2*x+1]=_.coords[2*x+1]*this._sy+this._ty,x+=l;return _}readCentroid(){if(!(0,f.S6)(this._current))return null;if(!this._current.centroid){const x=this._computeCentroid();if(!x)return null;x.coords[0]=(x.coords[0]-this._tx)/this._sx,x.coords[1]=(x.coords[1]-this._ty)/this._sy,this._current.centroid=x}const _=this._current.centroid.clone();return _.coords[0]=_.coords[0]*this._sx+this._tx,_.coords[1]=_.coords[1]*this._sx+this._ty,_}_readAttribute(_,x){const l=this._current.attributes[_];if(void 0!==l)return null!=l&&x&&this._dateFields.has(_)?new Date(l):l;const m=this.readAttributes(),P=_.toLocaleLowerCase().trim();for(const b in m)if(b.toLocaleLowerCase().trim()===P){const I=this._current.attributes[b];return null!=I&&x&&this._dateFields.has(b)?new Date(I):I}}copyInto(_){super.copyInto(_),_._featureIndex=this._featureIndex,_._transform=this._transform,_._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}}},2679:(V,j,y)=>{y.d(j,{p:()=>F});class F{constructor(f,c){this._mask=0,this._buf=f,this._mask=c}static fromBuffer(f,c){return new F(f,c)}static create(f,c=4294967295){const M=new Uint32Array(Math.ceil(f/32));return new F(M,c)}_getIndex(f){return Math.floor(f/32)}has(f){const c=this._mask&f;return!!(this._buf[this._getIndex(c)]&1<<c%32)}hasRange(f,c){let M=f,E=c;for(;M%32&&M!==E;){if(this.has(M))return!0;M++}for(;E%32&&M!==E;){if(this.has(M))return!0;E--}if(M===E)return!1;for(let S=M/32;S!==E/32;S++)if(this._buf[S])return!0;return!1}set(f){const c=this._mask&f,M=this._getIndex(c);this._buf[M]|=1<<c%32}setRange(f,c){let M=f,E=c;for(;M%32&&M!==E;)this.set(M++);for(;E%32&&M!==E;)this.set(E--);if(M!==E)for(let S=M/32;S!==E/32;S++)this._buf[S]=4294967295}unset(f){const c=this._mask&f,M=this._getIndex(c);this._buf[M]&=4294967295^1<<c%32}resize(f){const c=this._buf,M=new Uint32Array(Math.ceil(f/32));M.set(c),this._buf=M}or(f){for(let c=0;c<this._buf.length;c++)this._buf[c]|=f._buf[c];return this}and(f){for(let c=0;c<this._buf.length;c++)this._buf[c]&=f._buf[c];return this}xor(f){for(let c=0;c<this._buf.length;c++)this._buf[c]^=f._buf[c];return this}ior(f){for(let c=0;c<this._buf.length;c++)this._buf[c]|=~f._buf[c];return this}iand(f){for(let c=0;c<this._buf.length;c++)this._buf[c]&=~f._buf[c];return this}ixor(f){for(let c=0;c<this._buf.length;c++)this._buf[c]^=~f._buf[c];return this}any(){for(let f=0;f<this._buf.length;f++)if(this._buf[f])return!0;return!1}copy(f){for(let c=0;c<this._buf.length;c++)this._buf[c]=f._buf[c];return this}clone(){return new F(this._buf.slice(),this._mask)}clear(){for(let f=0;f<this._buf.length;f++)this._buf[f]=0}forEachSet(f){for(let c=0;c<this._buf.length;c++){let M=this._buf[c],E=32*c;if(M)for(;M;)1&M&&f(E),M>>>=1,E++}}countSet(){let f=0;return this.forEachSet(c=>{f++}),f}}},479:(V,j,y)=>{y.d(j,{I:()=>b,qc:()=>S});var F=y(60305),N=y(12788),f=y(22806),c=y(99155),M=y(38963),E=y(96054);function S(e,u){if(!e||!u)return e;switch(u){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function x(e){return e.map(u=>function(e){return{value:e.value,size:(0,N.t_)(e.size)}}(u))}function l(e){return"string"==typeof e||"number"==typeof e?(0,N.t_)(e):{type:"size",expression:e.expression,stops:x(e.stops)}}const P=e=>{const u=[],h=[],n=x(e),g=n.length;for(let z=0;z<6;z++){const r=n[Math.min(z,g-1)];u.push(r.value),h.push(null==r.size?c.AI:(0,N.F2)(r.size))}return{values:new Float32Array(u),sizes:new Float32Array(h)}};function b(e){const u=e&&e.length>0?{}:null,h=u?{}:null;if(!u)return{vvFields:u,vvRanges:h};for(const n of e)if(n.field&&(u[n.type]=n.field),"size"===n.type){h.size||(h.size={});const g=n;switch((0,E.a)(g)){case M.X.SIZE_MINMAX_VALUE:h.size.minMaxValue={minDataValue:g.minDataValue,maxDataValue:g.maxDataValue,minSize:l(g.minSize),maxSize:l(g.maxSize)};break;case M.X.SIZE_SCALE_STOPS:h.size.scaleStops={stops:x(g.stops)};break;case M.X.SIZE_FIELD_STOPS:if(g.levels){const z={};for(const r in g.levels)z[r]=P(g.levels[r]);h.size.fieldStops={type:"level-dependent",levels:z}}else h.size.fieldStops=st({type:"static"},P(g.stops));break;case M.X.SIZE_UNIT_VALUE:h.size.unitValue={unit:g.valueUnit,valueRepresentation:g.valueRepresentation}}}else"color"===n.type?h.color=i(n):"opacity"===n.type?h.opacity=I(n):"rotation"===n.type&&(h.rotation={type:n.rotationType});return{vvFields:u,vvRanges:h}}function I(e){const u={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const h=e.stops;for(let n=0;n<8;++n){const g=h[Math.min(n,h.length-1)];u.values[n]=g.value,u.opacities[n]=g.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const h=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let n=0;n<8;n++)u.values[n]=1/0,u.opacities[n]=h}}return u}function T(e,u,h){e[4*u+0]=h.r/255,e[4*u+1]=h.g/255,e[4*u+2]=h.b/255,e[4*u+3]=h.a}function i(e){if((0,F.Wi)(e)||e.normalizationField)return null;const u={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;u.field=e.field;const h=e.stops;for(let n=0;n<8;++n){const g=h[Math.min(n,h.length-1)];u.values[n]=g.value,T(u.colors,n,g.color)}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const h=e.stops&&e.stops.length>=0&&e.stops[0].color;for(let n=0;n<8;n++)u.values[n]=1/0,T(u.colors,n,h)}}for(let h=0;h<32;h+=4)(0,f.pr)(u.colors,h,!0);return u}}}]);